[
  {
    "instruction": "请你接下来一步步思考，写出正确的SQL查询语句以满足用户的需求。",
    "input": "你是一名MySQL专家，现在需要阅读并理解下面的【数据库schema】描述，以及可能用到的【参考信息】，并运用MySQL知识生成sql语句回答【用户问题】。\n【用户问题】\n统计各个玩法上线首周留存情况\n输出：玩法、上线首周首次玩的日期、第几天留存（0,1,2...7)、玩法留存用户数\n\n各玩法首周上线日期：\n\"广域战场\": \"20240723\",\n\"消灭战\": \"20230804\",\n\"幻想混战\": \"20241115\",\n\"荒野传说\": \"20240903\",\n\"策略载具\": \"20241010\",\n\"炎夏混战\": \"20240625\",\n\"单人装备\": \"20240517\",\n\"交叉堡垒\": \"20240412\"\n\n【数据库schema】\nCREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` TEXT COMMENT '统计日期格式YYYYMMDD',\n  `vgameappid` TEXT COMMENT '账号体系：wx:微信，qq：手Q',\n  `platid` BIGINT COMMENT '系统平台：0:IOS,1:Android',\n  `vplayerid` TEXT COMMENT '玩家ID',\n  `mode` BIGINT COMMENT '模式ID',\n  `modename` TEXT COMMENT '模式名称',\n  `submode` BIGINT COMMENT '子模式ID',\n  `submodename` TEXT COMMENT '子模式名称',\n  `map` BIGINT COMMENT '地图ID',\n  `mapname` TEXT COMMENT '地图名称',\n  `seasonid` BIGINT COMMENT '赛季ID',\n  `seasonname` TEXT COMMENT '赛季名称',\n  `roundcnt` BIGINT COMMENT '当日对局数',\n  `roundtime` BIGINT COMMENT '当日对局时长(秒)',\n  `survivaltime` BIGINT COMMENT '当日存活时长(秒)',\n  `firstroundtime` TEXT COMMENT '当日首次对局时间',\n  `device_type` BIGINT COMMENT '设备类型'\n);\n\n【参考信息】\n说明：\n广域战场 （2024/7/23）submodename= '广域战场模式'，\n消灭战（2023/8/4） modename='组队竞技' and submodename like '%消灭战模式%'，\n幻想混战（2024/11/15）modename='创意创作间' and submodename='幻想混战'，\n荒野传说（2024-09-03）modename='休闲模式' and submodename in ('荒野传说','荒野沙漠')，\n策略载具（2024-10-10）modename='休闲模式' and submodename like '%策略载具%'，\n炎夏混战（2024-06-25）modename='创意创作间' and submodename like '%炎夏混战%'，\n单人装备（2024.5.17）modename='组队竞技' and submodename like '%单人装备%'，\n交叉堡垒（2024.4.12） modename='组队竞技' and submodename like '%交叉堡垒%'\n\n第几天留存：0表示当天参与、1表示当天参与在第2天也参与、2表示当天参与在第3天也参与，依此类推\n\n【用户问题】\n统计各个玩法上线首周留存情况\n输出：玩法、上线首周首次玩的日期、第几天留存（0,1,2...7)、玩法留存用户数\n\n各玩法首周上线日期：\n\"广域战场\": \"20240723\",\n\"消灭战\": \"20230804\",\n\"幻想混战\": \"20241115\",\n\"荒野传说\": \"20240903\",\n\"策略载具\": \"20241010\",\n\"炎夏混战\": \"20240625\",\n\"单人装备\": \"20240517\",\n\"交叉堡垒\": \"20240412\"\n\n```sql",
    "output": "select  a.itype,\n        a.dtstatdate,\n        datediff(b.dtstatdate,a.dtstatdate) as idaynum,\n        count(distinct a.vplayerid)           as iusernum\nfrom (                      \n    select\n        itype,\n        min(dtstatdate) as dtstatdate,\n        vplayerid\n    from  (\n        select '广域战场'      as itype,\n                min(dtstatdate) as dtstatdate,\n                vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',6)\n        and submodename = '广域战场模式'\n        group by vplayerid\n\n        union all\n        select '消灭战', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',6)\n        and modename='组队竞技' and submodename like '%消灭战模式%'\n        group by vplayerid\n\n        union all\n        select '幻想混战', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',6)\n        and modename='创意创作间' and submodename='幻想混战'\n        group by vplayerid\n\n        union all\n        select '荒野传说', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',6)\n        and modename='休闲模式' and submodename in ('荒野传说','荒野沙漠')\n        group by vplayerid\n\n        union all\n        select '策略载具', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',6)\n        and modename='休闲模式' and submodename like '%策略载具%'\n        group by vplayerid\n\n        union all\n        select '炎夏混战', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',6)\n        and modename='创意创作间' and submodename like '%炎夏混战%'\n        group by vplayerid\n\n        union all\n        select '单人装备', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',6)\n        and modename='组队竞技' and submodename like '%单人装备%'\n        group by vplayerid\n\n        union all\n        select '交叉堡垒', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',6)\n        and modename='组队竞技' and submodename like '%交叉堡垒%'\n        group by vplayerid\n    ) t\n    group by itype, vplayerid\n) a\nleft join (\n        select '广域战场' as itype, dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',13)\n          and submodename = '广域战场模式'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '消灭战', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',13)\n          and modename='组队竞技' and submodename like '%消灭战模式%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '幻想混战', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',13)\n          and modename='创意创作间' and submodename='幻想混战'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '荒野传说', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',13)\n          and modename='休闲模式' and submodename in ('荒野传说','荒野沙漠')\n        group by dtstatdate, vplayerid\n\n        union all\n        select '策略载具', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',13)\n          and modename='休闲模式' and submodename like '%策略载具%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '炎夏混战', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',13)\n          and modename='创意创作间' and submodename like '%炎夏混战%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '单人装备', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',13)\n          and modename='组队竞技' and submodename like '%单人装备%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '交叉堡垒', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',13)\n          and modename='组队竞技' and submodename like '%交叉堡垒%'\n        group by dtstatdate, vplayerid\n) b\n  on  a.itype      = b.itype\nand  a.vplayerid    = b.vplayerid\nwhere datediff(b.dtstatdate,a.dtstatdate) between 0 and 7\ngroup by a.itype, a.dtstatdate, datediff(b.dtstatdate,a.dtstatdate);"
  },
  {
    "instruction": "请你接下来一步步思考，写出正确的SQL查询语句以满足用户的需求。",
    "input": "你是一名MySQL专家，现在需要阅读并理解下面的【数据库schema】描述，以及可能用到的【参考信息】，并运用MySQL知识生成sql语句回答【用户问题】。\n【用户问题】\n统计2019.5.8至2025.3.30 分月的玩法主玩情况\n输出：月份(201905、201906、...、202503)、主玩玩法、主玩人数、总参与人数\n\n【数据库schema】\nCREATE TABLE `dwd_jordass_playerexitgamerecord_hi` (\n  `tdbank_imp_date` TEXT,\n  `gamesvrid` TEXT COMMENT '登录的游戏服务器编号',\n  `dteventtime` TEXT COMMENT '游戏事件的时间, 格式 YYYY-MM-DD HH:MM:SS',\n  `vgameappid` TEXT COMMENT '游戏APPID',\n  `platid` BIGINT COMMENT 'ios 0/android 1',\n  `izoneareaid` BIGINT COMMENT '针对分区分服的游戏填写分区id，用来唯一标示一个区；非分区分服游戏请填写0',\n  `vplayerid` TEXT COMMENT '用户playerid号',\n  `uid` TEXT COMMENT '角色UID',\n  `gameid` TEXT COMMENT '本局游戏ID',\n  `exitreason` TEXT COMMENT '退出原因',\n  `isallianceforceeescape` BIGINT COMMENT '逃跑时是否安全的 否:0/是:1',\n  `escapebantype` BIGINT COMMENT '本次退出是否触发禁赛限制，0=没有触发；1=触发限制一；2=触发限制二；3=触发限制三',\n  `gamestate` TEXT COMMENT '退出时对局状态：Active是在出生岛之前，Ready是在出生岛，Fighting是包括4人集结、上飞机、跳伞战斗这些阶段，Finish 死亡/胜利结束',\n  `submodegroup` BIGINT COMMENT '模式组ID',\n  `lobbyexitreason` TEXT COMMENT '大厅记录的退出原因',\n  `mode` BIGINT COMMENT '模式ID',\n  `submode` BIGINT COMMENT '子模式ID',\n  `roundtime` BIGINT COMMENT '对局时长'\n);\nCREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` TEXT COMMENT '统计日期格式YYYYMMDD',\n  `vgameappid` TEXT COMMENT '账号体系：wx:微信，qq：手Q',\n  `platid` BIGINT COMMENT '系统平台：0:IOS,1:Android',\n  `vplayerid` TEXT COMMENT '玩家ID',\n  `mode` BIGINT COMMENT '模式ID',\n  `modename` TEXT COMMENT '模式名称',\n  `submode` BIGINT COMMENT '子模式ID',\n  `submodename` TEXT COMMENT '子模式名称',\n  `map` BIGINT COMMENT '地图ID',\n  `mapname` TEXT COMMENT '地图名称',\n  `seasonid` BIGINT COMMENT '赛季ID',\n  `seasonname` TEXT COMMENT '赛季名称',\n  `roundcnt` BIGINT COMMENT '当日对局数',\n  `roundtime` BIGINT COMMENT '当日对局时长(秒)',\n  `survivaltime` BIGINT COMMENT '当日存活时长(秒)',\n  `firstroundtime` TEXT COMMENT '当日首次对局时间',\n  `device_type` BIGINT COMMENT '设备类型'\n);\n\n【参考信息】\n主玩定义：用户累计对局时长最多的玩法；\n\n玩法：从dws_jordass_mode_roundrecord_di取\n从上往下匹配，如果满足以下任一条件，则返回对应的名称，否则返回“其他模式”。\n如果模式为“传统模式”，且子模式名称以“CG”开头，且地图为“群屿”，则返回“主题群屿”；\n如果模式为“传统模式”且地图为“群屿”，则返回“传统群屿”；\n如果模式为“传统模式”且地图为“假日群岛”，则返回“假日群岛”；\n如果模式为“传统模式”且地图为“荣耀之城”，则返回“荣耀之城”；\n如果子模式是“广域战场模式”，则返回“广域战场”；\n如果子模式是“极能形态模式”，则返回“极能形态”；\n如果模式是“组队竞技”，则返回“组竞”；\n如果模式是“休闲模式”，则返回“休闲”；\n如果模式是“乐园”，则返回“乐园”；\n如果模式是“领地”，则返回“领地”；\n如果模式是“广阔天地”，则返回“广阔天地”\n\n注意，参与隧道模式的用户数据从dwd_jordass_playerexitgamerecord_hi取，时间限制 2024.6.18-2025.3.30，mode in (3001, 3002, 3003)\n\n【用户问题】\n统计2019.5.8至2025.3.30 分月的玩法主玩情况\n输出：月份(201905、201906、...、202503)、主玩玩法、主玩人数、总参与人数\n\n```sql",
    "output": "with main_user as (\n    select substr(dtstatdate, 1, 6) mons,\n        case\n            when modename = '传统模式' and submodename like 'CG%' and mapname = '群屿' then '主题群屿'\n            when modename = '传统模式' and mapname = '群屿' then '传统群屿'\n            when modename = '传统模式' and mapname = '假日群岛' then '假日群岛'\n            when modename = '传统模式' and mapname = '荣耀之城' then '荣耀之城'\n            when submodename = '广域战场模式' then '广域战场'\n            when submodename = '极能形态模式' then '极能形态'\n            when modename = '组队竞技' then '组竞'\n            when modename = '乐园' then '乐园'\n            when modename = '领地' then '领地'\n            when modename = '广阔天地' then '广阔天地'\n            else '其他模式'\n        end imodename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        sum(roundcnt) roundcnt\n   from dws_jordass_mode_roundrecord_di\n   where dtstatdate between '20190508' and '20250330'\n   group by vplayerid, substr(dtstatdate, 1, 6),\n        case\n            when modename = '传统模式' and submodename like 'CG%' and mapname = '群屿' then '主题群屿'\n            when modename = '传统模式' and mapname = '群屿' then '传统群屿'\n            when modename = '传统模式' and mapname = '假日群岛' then '假日群岛'\n            when modename = '传统模式' and mapname = '荣耀之城' then '荣耀之城'\n            when submodename = '广域战场模式' then '广域战场'\n            when submodename = '极能形态模式' then '极能形态'\n            when modename = '组队竞技' then '组竞'\n            when modename = '乐园' then '乐园'\n            when modename = '领地' then '领地'\n            when modename = '广阔天地' then '广阔天地'\n            else '其他模式'\n        end\n\n   union all\n   \n   select substr (tdbank_imp_date, 1, 6) mons,\n        '隧道' as modename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        count(distinct gameid) roundcnt\n   from dwd_jordass_playerexitgamerecord_hi\n   where tdbank_imp_date between '2024061800' and '2025033023'\n     and mode in (3001, 3002, 3003)\n   group by substr (tdbank_imp_date, 1, 6), vplayerid\n)\n\nselect a.mons,\n       a.imodename,\n       a.iusernum,\n       b.iusernumall\nfrom (\n    select mons,\n          imodename,\n          count(vplayerid) iusernum\n    from (\n        select mons, vplayerid, imodename\n        from (\n            select mons,\n                vplayerid,\n                imodename,\n                roundtime,\n                row_number() over (partition by mons, vplayerid order by roundtime desc) as rn\n            from main_user\n        )ff1\n        where rn = 1\n    )f1\n   group by mons, imodename\n) a\nleft join (\n    select mons,\n        imodename,\n        count(vplayerid) iusernumall\n   from main_user\n   group by mons, imodename\n) b \non a.imodename = b.imodename and a.mons = b.mons\norder by a.mons, a.imodename\n;"
  },
  {
    "instruction": "请你接下来一步步思考，写出正确的SQL查询语句以满足用户的需求。",
    "input": "你是一名MySQL专家，现在需要阅读并理解下面的【数据库schema】描述，以及可能用到的【参考信息】，并运用MySQL知识生成sql语句回答【用户问题】。\n【用户问题】\n统计2020.5.8至2026.3.30 分月的玩法主玩情况\n\n【数据库schema】\nCREATE TABLE `dwd_jordass_playerexitgamerecord_hi` (\n  `tdbank_imp_date` TEXT,\n  `gamesvrid` TEXT COMMENT '登录的游戏服务器编号',\n  `dteventtime` TEXT COMMENT '游戏事件的时间, 格式 YYYY-MM-DD HH:MM:SS',\n  `vgameappid` TEXT COMMENT '游戏APPID',\n  `platid` BIGINT COMMENT 'ios 0/android 1',\n  `izoneareaid` BIGINT COMMENT '针对分区分服的游戏填写分区id，用来唯一标示一个区；非分区分服游戏请填写0',\n  `vplayerid` TEXT COMMENT '用户playerid号',\n  `uid` TEXT COMMENT '角色UID',\n  `gameid` TEXT COMMENT '本局游戏ID',\n  `exitreason` TEXT COMMENT '退出原因',\n  `isallianceforceeescape` BIGINT COMMENT '逃跑时是否安全的 否:0/是:1',\n  `escapebantype` BIGINT COMMENT '本次退出是否触发禁赛限制，0=没有触发；1=触发限制一；2=触发限制二；3=触发限制三',\n  `gamestate` TEXT COMMENT '退出时对局状态：Active是在出生岛之前，Ready是在出生岛，Fighting是包括4人集结、上飞机、跳伞战斗这些阶段，Finish 死亡/胜利结束',\n  `submodegroup` BIGINT COMMENT '模式组ID',\n  `lobbyexitreason` TEXT COMMENT '大厅记录的退出原因',\n  `mode` BIGINT COMMENT '模式ID',\n  `submode` BIGINT COMMENT '子模式ID',\n  `roundtime` BIGINT COMMENT '对局时长'\n);\nCREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` TEXT COMMENT '统计日期格式YYYYMMDD',\n  `vgameappid` TEXT COMMENT '账号体系：wx:微信，qq：手Q',\n  `platid` BIGINT COMMENT '系统平台：0:IOS,1:Android',\n  `vplayerid` TEXT COMMENT '玩家ID',\n  `mode` BIGINT COMMENT '模式ID',\n  `modename` TEXT COMMENT '模式名称',\n  `submode` BIGINT COMMENT '子模式ID',\n  `submodename` TEXT COMMENT '子模式名称',\n  `map` BIGINT COMMENT '地图ID',\n  `mapname` TEXT COMMENT '地图名称',\n  `seasonid` BIGINT COMMENT '赛季ID',\n  `seasonname` TEXT COMMENT '赛季名称',\n  `roundcnt` BIGINT COMMENT '当日对局数',\n  `roundtime` BIGINT COMMENT '当日对局时长(秒)',\n  `survivaltime` BIGINT COMMENT '当日存活时长(秒)',\n  `firstroundtime` TEXT COMMENT '当日首次对局时间',\n  `device_type` BIGINT COMMENT '设备类型'\n);\n\n【参考信息】\n主玩定义：用户累计对局时长最多的玩法；\n\n玩法：从dws_jordass_mode_roundrecord_di取\n从上往下匹配，如果满足以下任一条件，则返回对应的名称，否则返回“其他模式”。\n如果模式为“传统模式”，且子模式名称以“CG”开头，且地图为“群屿”，则返回“主题群屿”；\n如果模式为“传统模式”且地图为“群屿”，则返回“传统群屿”；\n如果模式为“传统模式”且地图为“假日群岛”，则返回“假日群岛”；\n如果模式为“传统模式”且地图为“荣耀之城”，则返回“荣耀之城”；\n如果子模式是“广域战场模式”，则返回“广域战场”；\n如果子模式是“极能形态模式”，则返回“极能形态”；\n如果模式是“组队竞技”，则返回“组竞”；\n如果模式是“休闲模式”，则返回“休闲”；\n如果模式是“乐园”，则返回“乐园”；\n如果模式是“领地”，则返回“领地”；\n如果模式是“广阔天地”，则返回“广阔天地”\n\n注意，参与隧道模式的用户数据从dwd_jordass_playerexitgamerecord_hi取，时间限制 2024.6.18-2025.3.30，mode in (3001, 3002, 3003)\n\n【用户问题】\n统计2020.5.8至2026.3.30 分月的玩法主玩情况\n\n",
    "output": "with main_user as ( select substr(dtstatdate, 1, 6) mons, case when modename = '传统模式' and submodename like 'CG%' and mapname = '群屿' then '主题群屿' when modename = '传统模式' and mapname = '群屿' then '传统群屿' when modename = '传统模式' and mapname = '假日群岛' then '假日群岛' when modename = '传统模式' and mapname = '荣耀之城' then '荣耀之城' when submodename = '广域战场模式' then '广域战场' when submodename = '极能形态模式' then '极能形态' when modename = '组队竞技' then '组竞' when modename = '乐园' then '乐园' when modename = '领地' then '领地' when modename = '广阔天地' then '广阔天地' else '其他模式' end imodename, vplayerid, sum(roundtime) / 60 roundtime, sum(roundcnt) roundcnt from dws_jordass_mode_roundrecord_di where dtstatdate between '20200508' and '20260330' group by vplayerid, substr(dtstatdate, 1, 6), case when modename = '传统模式' and submodename like 'CG%' and mapname = '群屿' then '主题群屿' when modename = '传统模式' and mapname = '群屿' then '传统群屿' when modename = '传统模式' and mapname = '假日群岛' then '假日群岛' when modename = '传统模式' and mapname = '荣耀之城' then '荣耀之城' when submodename = '广域战场模式' then '广域战场' when submodename = '极能形态模式' then '极能形态' when modename = '组队竞技' then '组竞' when modename = '乐园' then '乐园' when modename = '领地' then '领地' when modename = '广阔天地' then '广阔天地' else '其他模式' end union all select substr (tdbank_imp_date, 1, 6) mons, '隧道' as modename, vplayerid, sum(roundtime) / 60 roundtime, count(distinct gameid) roundcnt from dwd_jordass_playerexitgamerecord_hi where tdbank_imp_date between '2024061800' and '2026033023' and mode in (3001, 3002, 3003) group by substr (tdbank_imp_date, 1, 6), vplayerid ) select a.mons, a.imodename, a.iusernum, b.iusernumall from ( select mons, imodename, count(vplayerid) iusernum from ( select mons, vplayerid, imodename from ( select mons, vplayerid, imodename, roundtime, row_number() over (partition by mons, vplayerid order by roundtime desc) as rn from main_user )ff1 where rn = 1 )f1 group by mons, imodename ) a left join ( select mons, imodename, count(vplayerid) iusernumall from main_user group by mons, imodename ) b on a.imodename = b.imodename and a.mons = b.mons order by a.mons, a.imodename;",
    "meta": {
      "question_id": "aug_idx_1_keyword",
      "db_id": "unknown",
      "original_question": "统计2019.5.8至2025.3.30 分月的玩法主玩情况\n输出：月份(201905、201906、...、202503)、主玩玩法、主玩人数、总参与人数",
      "question_cn": "统计2020.5.8至2026.3.30 分月的玩法主玩情况",
      "evidence_cn": "主玩定义：用户累计对局时长最多的玩法；\n\n玩法：从dws_jordass_mode_roundrecord_di取\n从上往下匹配，如果满足以下任一条件，则返回对应的名称，否则返回“其他模式”。\n如果模式为“传统模式”，且子模式名称以“CG”开头，且地图为“群屿”，则返回“主题群屿”；\n如果模式为“传统模式”且地图为“群屿”，则返回“传统群屿”；\n如果模式为“传统模式”且地图为“假日群岛”，则返回“假日群岛”；\n如果模式为“传统模式”且地图为“荣耀之城”，则返回“荣耀之城”；\n如果子模式是“广域战场模式”，则返回“广域战场”；\n如果子模式是“极能形态模式”，则返回“极能形态”；\n如果模式是“组队竞技”，则返回“组竞”；\n如果模式是“休闲模式”，则返回“休闲”；\n如果模式是“乐园”，则返回“乐园”；\n如果模式是“领地”，则返回“领地”；\n如果模式是“广阔天地”，则返回“广阔天地”\n\n注意，参与隧道模式的用户数据从dwd_jordass_playerexitgamerecord_hi取，时间限制 2024.6.18-2025.3.30，mode in (3001, 3002, 3003)",
      "augmentation_mode": "keyword",
      "parent_id": "aug_idx_1"
    }
  },
  {
    "instruction": "请你接下来一步步思考，写出正确的SQL查询语句以满足用户的需求。",
    "input": "你是一名MySQL专家，现在需要阅读并理解下面的【数据库schema】描述，以及可能用到的【参考信息】，并运用MySQL知识生成sql语句回答【用户问题】。\n【用户问题】\n请统计从2019年5月8日到2025年3月30日的每月玩法主要情况\n\n【数据库schema】\nCREATE TABLE `dwd_jordass_playerexitgamerecord_hi` (\n  `tdbank_imp_date` TEXT,\n  `gamesvrid` TEXT COMMENT '登录的游戏服务器编号',\n  `dteventtime` TEXT COMMENT '游戏事件的时间, 格式 YYYY-MM-DD HH:MM:SS',\n  `vgameappid` TEXT COMMENT '游戏APPID',\n  `platid` BIGINT COMMENT 'ios 0/android 1',\n  `izoneareaid` BIGINT COMMENT '针对分区分服的游戏填写分区id，用来唯一标示一个区；非分区分服游戏请填写0',\n  `vplayerid` TEXT COMMENT '用户playerid号',\n  `uid` TEXT COMMENT '角色UID',\n  `gameid` TEXT COMMENT '本局游戏ID',\n  `exitreason` TEXT COMMENT '退出原因',\n  `isallianceforceeescape` BIGINT COMMENT '逃跑时是否安全的 否:0/是:1',\n  `escapebantype` BIGINT COMMENT '本次退出是否触发禁赛限制，0=没有触发；1=触发限制一；2=触发限制二；3=触发限制三',\n  `gamestate` TEXT COMMENT '退出时对局状态：Active是在出生岛之前，Ready是在出生岛，Fighting是包括4人集结、上飞机、跳伞战斗这些阶段，Finish 死亡/胜利结束',\n  `submodegroup` BIGINT COMMENT '模式组ID',\n  `lobbyexitreason` TEXT COMMENT '大厅记录的退出原因',\n  `mode` BIGINT COMMENT '模式ID',\n  `submode` BIGINT COMMENT '子模式ID',\n  `roundtime` BIGINT COMMENT '对局时长'\n);\nCREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` TEXT COMMENT '统计日期格式YYYYMMDD',\n  `vgameappid` TEXT COMMENT '账号体系：wx:微信，qq：手Q',\n  `platid` BIGINT COMMENT '系统平台：0:IOS,1:Android',\n  `vplayerid` TEXT COMMENT '玩家ID',\n  `mode` BIGINT COMMENT '模式ID',\n  `modename` TEXT COMMENT '模式名称',\n  `submode` BIGINT COMMENT '子模式ID',\n  `submodename` TEXT COMMENT '子模式名称',\n  `map` BIGINT COMMENT '地图ID',\n  `mapname` TEXT COMMENT '地图名称',\n  `seasonid` BIGINT COMMENT '赛季ID',\n  `seasonname` TEXT COMMENT '赛季名称',\n  `roundcnt` BIGINT COMMENT '当日对局数',\n  `roundtime` BIGINT COMMENT '当日对局时长(秒)',\n  `survivaltime` BIGINT COMMENT '当日存活时长(秒)',\n  `firstroundtime` TEXT COMMENT '当日首次对局时间',\n  `device_type` BIGINT COMMENT '设备类型'\n);\n\n【参考信息】\n主玩定义：用户累计对局时长最多的玩法；\n\n玩法：从dws_jordass_mode_roundrecord_di取\n从上往下匹配，如果满足以下任一条件，则返回对应的名称，否则返回“其他模式”。\n如果模式为“传统模式”，且子模式名称以“CG”开头，且地图为“群屿”，则返回“主题群屿”；\n如果模式为“传统模式”且地图为“群屿”，则返回“传统群屿”；\n如果模式为“传统模式”且地图为“假日群岛”，则返回“假日群岛”；\n如果模式为“传统模式”且地图为“荣耀之城”，则返回“荣耀之城”；\n如果子模式是“广域战场模式”，则返回“广域战场”；\n如果子模式是“极能形态模式”，则返回“极能形态”；\n如果模式是“组队竞技”，则返回“组竞”；\n如果模式是“休闲模式”，则返回“休闲”；\n如果模式是“乐园”，则返回“乐园”；\n如果模式是“领地”，则返回“领地”；\n如果模式是“广阔天地”，则返回“广阔天地”\n\n注意，参与隧道模式的用户数据从dwd_jordass_playerexitgamerecord_hi取，时间限制 2024.6.18-2025.3.30，mode in (3001, 3002, 3003)\n\n【用户问题】\n请统计从2019年5月8日到2025年3月30日的每月玩法主要情况\n\n",
    "output": "with main_user as ( select substr(dtstatdate, 1, 6) mons, case when modename = '传统模式' and submodename like 'CG%' and mapname = '群屿' then '主题群屿' when modename = '传统模式' and mapname = '群屿' then '传统群屿' when modename = '传统模式' and mapname = '假日群岛' then '假日群岛' when modename = '传统模式' and mapname = '荣耀之城' then '荣耀之城' when submodename = '广域战场模式' then '广域战场' when submodename = '极能形态模式' then '极能形态' when modename = '组队竞技' then '组竞' when modename = '乐园' then '乐园' when modename = '领地' then '领地' when modename = '广阔天地' then '广阔天地' else '其他模式' end imodename, vplayerid, sum(roundtime) / 60 roundtime, sum(roundcnt) roundcnt from dws_jordass_mode_roundrecord_di where dtstatdate between '20190508' and '20250330' group by vplayerid, substr(dtstatdate, 1, 6), case when modename = '传统模式' and submodename like 'CG%' and mapname = '群屿' then '主题群屿' when modename = '传统模式' and mapname = '群屿' then '传统群屿' when modename = '传统模式' and mapname = '假日群岛' then '假日群岛' when modename = '传统模式' and mapname = '荣耀之城' then '荣耀之城' when submodename = '广域战场模式' then '广域战场' when submodename = '极能形态模式' then '极能形态' when modename = '组队竞技' then '组竞' when modename = '乐园' then '乐园' when modename = '领地' then '领地' when modename = '广阔天地' then '广阔天地' else '其他模式' end union all select substr (tdbank_imp_date, 1, 6) mons, '隧道' as modename, vplayerid, sum(roundtime) / 60 roundtime, count(distinct gameid) roundcnt from dwd_jordass_playerexitgamerecord_hi where tdbank_imp_date between '2024061800' and '2025033023' and mode in (3001, 3002, 3003) group by substr (tdbank_imp_date, 1, 6), vplayerid ) select a.mons, a.imodename, a.iusernum, b.iusernumall from ( select mons, imodename, count(vplayerid) iusernum from ( select mons, vplayerid, imodename from ( select mons, vplayerid, imodename, roundtime, row_number() over (partition by mons, vplayerid order by roundtime desc) as rn from main_user )ff1 where rn = 1 )f1 group by mons, imodename ) a left join ( select mons, imodename, count(vplayerid) iusernumall from main_user group by mons, imodename ) b on a.imodename = b.imodename and a.mons = b.mons order by a.mons, a.imodename;",
    "meta": {
      "question_id": "aug_idx_1_paraphrase",
      "db_id": "unknown",
      "original_question": "统计2019.5.8至2025.3.30 分月的玩法主玩情况\n输出：月份(201905、201906、...、202503)、主玩玩法、主玩人数、总参与人数",
      "question_cn": "请统计从2019年5月8日到2025年3月30日的每月玩法主要情况",
      "evidence_cn": "主玩定义：用户累计对局时长最多的玩法；\n\n玩法：从dws_jordass_mode_roundrecord_di取\n从上往下匹配，如果满足以下任一条件，则返回对应的名称，否则返回“其他模式”。\n如果模式为“传统模式”，且子模式名称以“CG”开头，且地图为“群屿”，则返回“主题群屿”；\n如果模式为“传统模式”且地图为“群屿”，则返回“传统群屿”；\n如果模式为“传统模式”且地图为“假日群岛”，则返回“假日群岛”；\n如果模式为“传统模式”且地图为“荣耀之城”，则返回“荣耀之城”；\n如果子模式是“广域战场模式”，则返回“广域战场”；\n如果子模式是“极能形态模式”，则返回“极能形态”；\n如果模式是“组队竞技”，则返回“组竞”；\n如果模式是“休闲模式”，则返回“休闲”；\n如果模式是“乐园”，则返回“乐园”；\n如果模式是“领地”，则返回“领地”；\n如果模式是“广阔天地”，则返回“广阔天地”\n\n注意，参与隧道模式的用户数据从dwd_jordass_playerexitgamerecord_hi取，时间限制 2024.6.18-2025.3.30，mode in (3001, 3002, 3003)",
      "augmentation_mode": "paraphrase",
      "parent_id": "aug_idx_1"
    }
  },
  {
    "instruction": "请你接下来一步步思考，写出正确的SQL查询语句以满足用户的需求。",
    "input": "你是一名MySQL专家，现在需要阅读并理解下面的【数据库schema】描述，以及可能用到的【参考信息】，并运用MySQL知识生成sql语句回答【用户问题】。\n【用户问题】\n统计分月的玩法主玩情况\n\n【数据库schema】\nCREATE TABLE `dwd_jordass_playerexitgamerecord_hi` (\n  `tdbank_imp_date` TEXT,\n  `gamesvrid` TEXT COMMENT '登录的游戏服务器编号',\n  `dteventtime` TEXT COMMENT '游戏事件的时间, 格式 YYYY-MM-DD HH:MM:SS',\n  `vgameappid` TEXT COMMENT '游戏APPID',\n  `platid` BIGINT COMMENT 'ios 0/android 1',\n  `izoneareaid` BIGINT COMMENT '针对分区分服的游戏填写分区id，用来唯一标示一个区；非分区分服游戏请填写0',\n  `vplayerid` TEXT COMMENT '用户playerid号',\n  `uid` TEXT COMMENT '角色UID',\n  `gameid` TEXT COMMENT '本局游戏ID',\n  `exitreason` TEXT COMMENT '退出原因',\n  `isallianceforceeescape` BIGINT COMMENT '逃跑时是否安全的 否:0/是:1',\n  `escapebantype` BIGINT COMMENT '本次退出是否触发禁赛限制，0=没有触发；1=触发限制一；2=触发限制二；3=触发限制三',\n  `gamestate` TEXT COMMENT '退出时对局状态：Active是在出生岛之前，Ready是在出生岛，Fighting是包括4人集结、上飞机、跳伞战斗这些阶段，Finish 死亡/胜利结束',\n  `submodegroup` BIGINT COMMENT '模式组ID',\n  `lobbyexitreason` TEXT COMMENT '大厅记录的退出原因',\n  `mode` BIGINT COMMENT '模式ID',\n  `submode` BIGINT COMMENT '子模式ID',\n  `roundtime` BIGINT COMMENT '对局时长'\n);\nCREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` TEXT COMMENT '统计日期格式YYYYMMDD',\n  `vgameappid` TEXT COMMENT '账号体系：wx:微信，qq：手Q',\n  `platid` BIGINT COMMENT '系统平台：0:IOS,1:Android',\n  `vplayerid` TEXT COMMENT '玩家ID',\n  `mode` BIGINT COMMENT '模式ID',\n  `modename` TEXT COMMENT '模式名称',\n  `submode` BIGINT COMMENT '子模式ID',\n  `submodename` TEXT COMMENT '子模式名称',\n  `map` BIGINT COMMENT '地图ID',\n  `mapname` TEXT COMMENT '地图名称',\n  `seasonid` BIGINT COMMENT '赛季ID',\n  `seasonname` TEXT COMMENT '赛季名称',\n  `roundcnt` BIGINT COMMENT '当日对局数',\n  `roundtime` BIGINT COMMENT '当日对局时长(秒)',\n  `survivaltime` BIGINT COMMENT '当日存活时长(秒)',\n  `firstroundtime` TEXT COMMENT '当日首次对局时间',\n  `device_type` BIGINT COMMENT '设备类型'\n);\n\n【参考信息】\n主玩定义：用户累计对局时长最多的玩法；\n\n玩法：从dws_jordass_mode_roundrecord_di取\n从上往下匹配，如果满足以下任一条件，则返回对应的名称，否则返回“其他模式”。\n如果模式为“传统模式”，且子模式名称以“CG”开头，且地图为“群屿”，则返回“主题群屿”；\n如果模式为“传统模式”且地图为“群屿”，则返回“传统群屿”；\n如果模式为“传统模式”且地图为“假日群岛”，则返回“假日群岛”；\n如果模式为“传统模式”且地图为“荣耀之城”，则返回“荣耀之城”；\n如果子模式是“广域战场模式”，则返回“广域战场”；\n如果子模式是“极能形态模式”，则返回“极能形态”；\n如果模式是“组队竞技”，则返回“组竞”；\n如果模式是“休闲模式”，则返回“休闲”；\n如果模式是“乐园”，则返回“乐园”；\n如果模式是“领地”，则返回“领地”；\n如果模式是“广阔天地”，则返回“广阔天地”\n\n注意，参与隧道模式的用户数据从dwd_jordass_playerexitgamerecord_hi取，时间限制 2024.6.18-2025.3.30，mode in (3001, 3002, 3003)\n\n【用户问题】\n统计分月的玩法主玩情况\n\n",
    "output": "with main_user as ( select substr(dtstatdate, 1, 6) mons, case when modename = '传统模式' and submodename like 'CG%' and mapname = '群屿' then '主题群屿' when modename = '传统模式' and mapname = '群屿' then '传统群屿' when modename = '传统模式' and mapname = '假日群岛' then '假日群岛' when modename = '传统模式' and mapname = '荣耀之城' then '荣耀之城' when submodename = '广域战场模式' then '广域战场' when submodename = '极能形态模式' then '极能形态' when modename = '组队竞技' then '组竞' when modename = '乐园' then '乐园' when modename = '领地' then '领地' when modename = '广阔天地' then '广阔天地' else '其他模式' end imodename, vplayerid, sum(roundtime) / 60 roundtime, sum(roundcnt) roundcnt from dws_jordass_mode_roundrecord_di where dtstatdate between '20190508' and '20250330' group by vplayerid, substr(dtstatdate, 1, 6), case when modename = '传统模式' and submodename like 'CG%' and mapname = '群屿' then '主题群屿' when modename = '传统模式' and mapname = '群屿' then '传统群屿' when modename = '传统模式' and mapname = '假日群岛' then '假日群岛' when modename = '传统模式' and mapname = '荣耀之城' then '荣耀之城' when submodename = '广域战场模式' then '广域战场' when submodename = '极能形态模式' then '极能形态' when modename = '组队竞技' then '组竞' when modename = '乐园' then '乐园' when modename = '领地' then '领地' when modename = '广阔天地' then '广阔天地' else '其他模式' end union all select substr (tdbank_imp_date, 1, 6) mons, '隧道' as modename, vplayerid, sum(roundtime) / 60 roundtime, count(distinct gameid) roundcnt from dwd_jordass_playerexitgamerecord_hi where tdbank_imp_date between '2024061800' and '2025033023' and mode in (3001, 3002, 3003) group by substr (tdbank_imp_date, 1, 6), vplayerid ) select a.mons, a.imodename, a.iusernum from ( select mons, imodename, count(vplayerid) iusernum from ( select mons, vplayerid, imodename from ( select mons, vplayerid, imodename, roundtime, row_number() over (partition by mons, vplayerid order by roundtime desc) as rn from main_user )ff1 where rn = 1 )f1 group by mons, imodename ) a left join ( select mons, imodename, count(vplayerid) iusernumall from main_user group by mons, imodename ) b on a.imodename = b.imodename and a.mons = b.mons order by a.mons, a.imodename;",
    "meta": {
      "question_id": "aug_idx_1_simplification",
      "db_id": "unknown",
      "original_question": "统计2019.5.8至2025.3.30 分月的玩法主玩情况\n输出：月份(201905、201906、...、202503)、主玩玩法、主玩人数、总参与人数",
      "question_cn": "统计分月的玩法主玩情况",
      "evidence_cn": "主玩定义：用户累计对局时长最多的玩法；\n\n玩法：从dws_jordass_mode_roundrecord_di取\n从上往下匹配，如果满足以下任一条件，则返回对应的名称，否则返回“其他模式”。\n如果模式为“传统模式”，且子模式名称以“CG”开头，且地图为“群屿”，则返回“主题群屿”；\n如果模式为“传统模式”且地图为“群屿”，则返回“传统群屿”；\n如果模式为“传统模式”且地图为“假日群岛”，则返回“假日群岛”；\n如果模式为“传统模式”且地图为“荣耀之城”，则返回“荣耀之城”；\n如果子模式是“广域战场模式”，则返回“广域战场”；\n如果子模式是“极能形态模式”，则返回“极能形态”；\n如果模式是“组队竞技”，则返回“组竞”；\n如果模式是“休闲模式”，则返回“休闲”；\n如果模式是“乐园”，则返回“乐园”；\n如果模式是“领地”，则返回“领地”；\n如果模式是“广阔天地”，则返回“广阔天地”\n\n注意，参与隧道模式的用户数据从dwd_jordass_playerexitgamerecord_hi取，时间限制 2024.6.18-2025.3.30，mode in (3001, 3002, 3003)",
      "augmentation_mode": "simplification",
      "parent_id": "aug_idx_1"
    }
  }
]