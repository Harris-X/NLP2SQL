[
{
  "instruction": "è¯·ä½ æ¥ä¸‹æ¥ä¸€æ­¥æ­¥æ€è€ƒï¼Œå†™å‡ºæ­£ç¡®çš„SQLæŸ¥è¯¢è¯­å¥ä»¥æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚",
  "input": "ä½ æ˜¯ä¸€åMySQLä¸“å®¶ï¼Œç°åœ¨éœ€è¦é˜…è¯»å¹¶ç†è§£ä¸‹é¢çš„ã€æ•°æ®åº“schemaã€‘æè¿°ï¼Œä»¥åŠå¯èƒ½ç”¨åˆ°çš„ã€å‚è€ƒä¿¡æ¯ã€‘ï¼Œå¹¶è¿ç”¨MySQLçŸ¥è¯†ç”Ÿæˆsqlè¯­å¥å›ç­”ã€ç”¨æˆ·é—®é¢˜ã€‘ã€‚\nã€ç”¨æˆ·é—®é¢˜ã€‘\nç»Ÿè®¡å„ä¸ªç©æ³•ä¸Šçº¿é¦–å‘¨ç•™å­˜æƒ…å†µ\nè¾“å‡ºï¼šç©æ³•ã€ä¸Šçº¿é¦–å‘¨é¦–æ¬¡ç©çš„æ—¥æœŸã€ç¬¬å‡ å¤©ç•™å­˜ï¼ˆ0,1,2...7)ã€ç©æ³•ç•™å­˜ç”¨æˆ·æ•°\n\nå„ç©æ³•é¦–å‘¨ä¸Šçº¿æ—¥æœŸï¼š\n\"å¹¿åŸŸæˆ˜åœº\": \"20240723\",\n\"æ¶ˆç­æˆ˜\": \"20230804\",\n\"å¹»æƒ³æ··æˆ˜\": \"20241115\",\n\"è’é‡ä¼ è¯´\": \"20240903\",\n\"ç­–ç•¥è½½å…·\": \"20241010\",\n\"ç‚å¤æ··æˆ˜\": \"20240625\",\n\"å•äººè£…å¤‡\": \"20240517\",\n\"äº¤å‰å ¡å’\": \"20240412\"\n\nã€æ•°æ®åº“schemaã€‘\nCREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` TEXT COMMENT 'ç»Ÿè®¡æ—¥æœŸæ ¼å¼YYYYMMDD',\n  `vgameappid` TEXT COMMENT 'è´¦å·ä½“ç³»ï¼šwx:å¾®ä¿¡ï¼Œqqï¼šæ‰‹Q',\n  `platid` BIGINT COMMENT 'ç³»ç»Ÿå¹³å°ï¼š0:IOS,1:Android',\n  `vplayerid` TEXT COMMENT 'ç©å®¶ID',\n  `mode` BIGINT COMMENT 'æ¨¡å¼ID',\n  `modename` TEXT COMMENT 'æ¨¡å¼åç§°',\n  `submode` BIGINT COMMENT 'å­æ¨¡å¼ID',\n  `submodename` TEXT COMMENT 'å­æ¨¡å¼åç§°',\n  `map` BIGINT COMMENT 'åœ°å›¾ID',\n  `mapname` TEXT COMMENT 'åœ°å›¾åç§°',\n  `seasonid` BIGINT COMMENT 'èµ›å­£ID',\n  `seasonname` TEXT COMMENT 'èµ›å­£åç§°',\n  `roundcnt` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ•°',\n  `roundtime` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ—¶é•¿(ç§’)',\n  `survivaltime` BIGINT COMMENT 'å½“æ—¥å­˜æ´»æ—¶é•¿(ç§’)',\n  `firstroundtime` TEXT COMMENT 'å½“æ—¥é¦–æ¬¡å¯¹å±€æ—¶é—´',\n  `device_type` BIGINT COMMENT 'è®¾å¤‡ç±»å‹'\n);\n\nã€å‚è€ƒä¿¡æ¯ã€‘\nè¯´æ˜ï¼š\nå¹¿åŸŸæˆ˜åœº ï¼ˆ2024/7/23ï¼‰submodename= 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'ï¼Œ\næ¶ˆç­æˆ˜ï¼ˆ2023/8/4ï¼‰ modename='ç»„é˜Ÿç«æŠ€' and submodename like '%æ¶ˆç­æˆ˜æ¨¡å¼%'ï¼Œ\nå¹»æƒ³æ··æˆ˜ï¼ˆ2024/11/15ï¼‰modename='åˆ›æ„åˆ›ä½œé—´' and submodename='å¹»æƒ³æ··æˆ˜'ï¼Œ\nè’é‡ä¼ è¯´ï¼ˆ2024-09-03ï¼‰modename='ä¼‘é—²æ¨¡å¼' and submodename in ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ ')ï¼Œ\nç­–ç•¥è½½å…·ï¼ˆ2024-10-10ï¼‰modename='ä¼‘é—²æ¨¡å¼' and submodename like '%ç­–ç•¥è½½å…·%'ï¼Œ\nç‚å¤æ··æˆ˜ï¼ˆ2024-06-25ï¼‰modename='åˆ›æ„åˆ›ä½œé—´' and submodename like '%ç‚å¤æ··æˆ˜%'ï¼Œ\nå•äººè£…å¤‡ï¼ˆ2024.5.17ï¼‰modename='ç»„é˜Ÿç«æŠ€' and submodename like '%å•äººè£…å¤‡%'ï¼Œ\näº¤å‰å ¡å’ï¼ˆ2024.4.12ï¼‰ modename='ç»„é˜Ÿç«æŠ€' and submodename like '%äº¤å‰å ¡å’%'\n\nç¬¬å‡ å¤©ç•™å­˜ï¼š0è¡¨ç¤ºå½“å¤©å‚ä¸ã€1è¡¨ç¤ºå½“å¤©å‚ä¸åœ¨ç¬¬2å¤©ä¹Ÿå‚ä¸ã€2è¡¨ç¤ºå½“å¤©å‚ä¸åœ¨ç¬¬3å¤©ä¹Ÿå‚ä¸ï¼Œä¾æ­¤ç±»æ¨\n\n",
  "chosen": "select  a.itype,\n        a.dtstatdate,\n        datediff(b.dtstatdate,a.dtstatdate) as idaynum,\n        count(distinct a.vplayerid)           as iusernum\nfrom (                      \n    select\n        itype,\n        min(dtstatdate) as dtstatdate,\n        vplayerid\n    from  (\n        select 'å¹¿åŸŸæˆ˜åœº'      as itype,\n                min(dtstatdate) as dtstatdate,\n                vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',6)\n        and submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'\n        group by vplayerid\n\n        union all\n        select 'æ¶ˆç­æˆ˜', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',6)\n        and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%æ¶ˆç­æˆ˜æ¨¡å¼%'\n        group by vplayerid\n\n        union all\n        select 'å¹»æƒ³æ··æˆ˜', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',6)\n        and modename='åˆ›æ„åˆ›ä½œé—´' and submodename='å¹»æƒ³æ··æˆ˜'\n        group by vplayerid\n\n        union all\n        select 'è’é‡ä¼ è¯´', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',6)\n        and modename='ä¼‘é—²æ¨¡å¼' and submodename in ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ ')\n        group by vplayerid\n\n        union all\n        select 'ç­–ç•¥è½½å…·', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',6)\n        and modename='ä¼‘é—²æ¨¡å¼' and submodename like '%ç­–ç•¥è½½å…·%'\n        group by vplayerid\n\n        union all\n        select 'ç‚å¤æ··æˆ˜', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',6)\n        and modename='åˆ›æ„åˆ›ä½œé—´' and submodename like '%ç‚å¤æ··æˆ˜%'\n        group by vplayerid\n\n        union all\n        select 'å•äººè£…å¤‡', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',6)\n        and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%å•äººè£…å¤‡%'\n        group by vplayerid\n\n        union all\n        select 'äº¤å‰å ¡å’', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',6)\n        and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%äº¤å‰å ¡å’%'\n        group by vplayerid\n    ) t\n    group by itype, vplayerid\n) a\nleft join (\n        select 'å¹¿åŸŸæˆ˜åœº' as itype, dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',13)\n          and submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'æ¶ˆç­æˆ˜', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',13)\n          and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%æ¶ˆç­æˆ˜æ¨¡å¼%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'å¹»æƒ³æ··æˆ˜', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',13)\n          and modename='åˆ›æ„åˆ›ä½œé—´' and submodename='å¹»æƒ³æ··æˆ˜'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'è’é‡ä¼ è¯´', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',13)\n          and modename='ä¼‘é—²æ¨¡å¼' and submodename in ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ ')\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'ç­–ç•¥è½½å…·', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',13)\n          and modename='ä¼‘é—²æ¨¡å¼' and submodename like '%ç­–ç•¥è½½å…·%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'ç‚å¤æ··æˆ˜', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',13)\n          and modename='åˆ›æ„åˆ›ä½œé—´' and submodename like '%ç‚å¤æ··æˆ˜%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'å•äººè£…å¤‡', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',13)\n          and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%å•äººè£…å¤‡%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'äº¤å‰å ¡å’', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',13)\n          and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%äº¤å‰å ¡å’%'\n        group by dtstatdate, vplayerid\n) b\n  on  a.itype      = b.itype\nand  a.vplayerid    = b.vplayerid\nwhere datediff(b.dtstatdate,a.dtstatdate) between 0 and 7\ngroup by a.itype, a.dtstatdate, datediff(b.dtstatdate,a.dtstatdate);",
  "rejected": "æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥åˆ†æè¿™ä¸ªéœ€æ±‚ï¼Œå¹¶æœ€ç»ˆå†™å‡ºæ­£ç¡®çš„ SQL æŸ¥è¯¢è¯­å¥ã€‚\n\n---\n\n## âœ… **ç›®æ ‡**\nç»Ÿè®¡å„ä¸ªç©æ³•ä¸Šçº¿é¦–å‘¨çš„ç•™å­˜æƒ…å†µï¼š\n\nè¾“å‡ºå­—æ®µåŒ…æ‹¬ï¼š\n- ç©æ³•ï¼ˆå³ mode åç§°ï¼‰\n- ä¸Šçº¿é¦–å‘¨é¦–æ¬¡ç©çš„æ—¥æœŸï¼ˆå³è¯¥ç©æ³•çš„ä¸Šçº¿æ—¥æœŸï¼‰\n- ç¬¬å‡ å¤©ç•™å­˜ï¼ˆ0 ~ 7 å¤©ï¼‰\n- ç©æ³•ç•™å­˜ç”¨æˆ·æ•°ï¼ˆåœ¨æŸä¸€å¤©è¿˜ç»§ç»­ç©äº†çš„ç”¨æˆ·æ•°é‡ï¼‰\n\n---\n\n## ğŸ§  **ç¬¬ä¸€æ­¥ï¼šç†è§£æ•°æ®ç»“æ„å’Œå…³é”®ç‚¹**\n\n### æ•°æ®è¡¨ç»“æ„\n```sql\nCREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` TEXT COMMENT 'ç»Ÿè®¡æ—¥æœŸæ ¼å¼YYYYMMDD',\n  `vplayerid` TEXT COMMENT 'ç©å®¶ID',\n  `modename` TEXT COMMENT 'æ¨¡å¼åç§°',\n  `submodename` TEXT COMMENT 'å­æ¨¡å¼åç§°',\n  ...\n);\n```\n\n### å…³é”®å­—æ®µè¯´æ˜\n- `vplayerid`: ç©å®¶å”¯ä¸€æ ‡è¯†\n- `modename`, `submodename`: åˆ¤æ–­ç©æ³•çš„ä¾æ®\n- `dtstatdate`: æ¯å¤©çš„æ•°æ®è®°å½•ï¼Œæ ¼å¼ä¸º `YYYYMMDD`\n- æˆ‘ä»¬éœ€è¦æ ¹æ®ä¸åŒçš„ç©æ³•ï¼Œç­›é€‰å‡ºå…¶å¯¹åº”çš„ `modename` å’Œ `submodename` æ¡ä»¶\n\n---\n\n## ğŸ§­ **ç¬¬äºŒæ­¥ï¼šç¡®å®šå„ç©æ³•å¯¹åº”æ¡ä»¶**\n\n| ç©æ³•åç§°     | ä¸Šçº¿æ—¥æœŸ     | modename            | submodename                     |\n|--------------|--------------|---------------------|----------------------------------|\n| å¹¿åŸŸæˆ˜åœº     | 20240723     | -                   | 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'                  |\n| æ¶ˆç­æˆ˜       | 20230804     | ç»„é˜Ÿç«æŠ€            | '%æ¶ˆç­æˆ˜æ¨¡å¼%'                   |\n| å¹»æƒ³æ··æˆ˜     | 20241115     | åˆ›æ„åˆ›ä½œé—´          | 'å¹»æƒ³æ··æˆ˜'                      |\n| è’é‡ä¼ è¯´     | 20240903     | ä¼‘é—²æ¨¡å¼            | ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ ')        |\n| ç­–ç•¥è½½å…·     | 20241010     | ä¼‘é—²æ¨¡å¼            | '%ç­–ç•¥è½½å…·%'                    |\n| ç‚å¤æ··æˆ˜     | 20240625     | åˆ›æ„åˆ›ä½œé—´          | '%ç‚å¤æ··æˆ˜%'                    |\n| å•äººè£…å¤‡     | 20240517     | ç»„é˜Ÿç«æŠ€            | '%å•äººè£…å¤‡%'                    |\n| äº¤å‰å ¡å’     | 20240412     | ç»„é˜Ÿç«æŠ€            | '%äº¤å‰å ¡å’%'                    |\n\n---\n\n## ğŸ“Œ **ç¬¬ä¸‰æ­¥ï¼šé€»è¾‘æ‹†è§£**\n\næˆ‘ä»¬éœ€è¦åšä»¥ä¸‹å‡ æ­¥ï¼š\n\n### Step 1ï¼šæ‰¾å‡ºæ¯ä¸ªç©æ³•é¦–æ¬¡ä¸Šçº¿é‚£å¤©å¼€å§‹çš„ç”¨æˆ·ï¼ˆå³é¦–æ¬¡å‚ä¸è¯¥ç©æ³•çš„ç”¨æˆ·ï¼‰\n- éœ€è¦æŒ‰ `vplayerid` åˆ†ç»„ï¼Œæ‰¾å‡ºæ¯äººåœ¨è¯¥ç©æ³•ä¸‹çš„æœ€æ—©å‚ä¸æ—¥æœŸï¼ˆmin(dtstatdate)ï¼‰\n\n### Step 2ï¼šå¯¹äºè¿™äº›â€œé¦–æ¬¡å‚ä¸â€çš„ç”¨æˆ·ï¼Œåœ¨ä¹‹åçš„ 0~7 å¤©å†…æ˜¯å¦è¿˜æœ‰å‚ä¸ï¼Ÿ\n- å¯¹äºæ¯ä¸ªé¦–æ¬¡å‚ä¸æ—¥æœŸï¼Œæˆ‘ä»¬æ£€æŸ¥å…¶åç¬¬ 0~7 å¤©æ˜¯å¦æœ‰è®°å½•\n\n### Step 3ï¼šç»Ÿè®¡ç•™å­˜äººæ•°ï¼ˆæ¯å¤©æœ‰å¤šå°‘äººè¿˜åœ¨ç©ï¼‰\n\n---\n\n## ğŸ”¢ **ç¬¬å››æ­¥ï¼šæ„é€  SQL**\n\næˆ‘ä»¬å°†ä½¿ç”¨å¦‚ä¸‹æ€è·¯ï¼š\n\n1. å…ˆå®šä¹‰ä¸€ä¸ª CTE æˆ–ä¸´æ—¶è¡¨ï¼Œç”¨äºè·å–æ¯ä¸ªç©æ³•ä¸‹é¦–æ¬¡å‚ä¸çš„ç”¨æˆ·åŠæ—¥æœŸ\n2. ç„¶åå¯¹è¿™äº›ç”¨æˆ·ï¼Œåˆ†åˆ«ç»Ÿè®¡ä»–ä»¬åœ¨åç»­ç¬¬ 0~7 å¤©æœ‰æ²¡æœ‰ç»§ç»­å‚ä¸\n3. æœ€ç»ˆæ±‡æ€»æˆç»“æœé›†\n\n---\n\n## ğŸ§¾ **å®Œæ•´ SQL æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š**\n\n```sql\nWITH first_play_dates AS (\n    -- è·å–æ¯ä¸ªç©æ³•ä¸­æ¯ä¸ªç”¨æˆ·çš„é¦–æ¬¡å‚ä¸æ—¥æœŸ\n    SELECT \n        CASE\n            WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n            WHEN modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%' THEN 'æ¶ˆç­æˆ˜'\n            WHEN modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename = 'å¹»æƒ³æ··æˆ˜' THEN 'å¹»æƒ³æ··æˆ˜'\n            WHEN modename = 'ä¼‘é—²æ¨¡å¼' AND submodename IN ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ ') THEN 'è’é‡ä¼ è¯´'\n            WHEN modename = 'ä¼‘é—²æ¨¡å¼' AND submodename LIKE '%ç­–ç•¥è½½å…·%' THEN 'ç­–ç•¥è½½å…·'\n            WHEN modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename LIKE '%ç‚å¤æ··æˆ˜%' THEN 'ç‚å¤æ··æˆ˜'\n            WHEN modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%å•äººè£…å¤‡%' THEN 'å•äººè£…å¤‡'\n            WHEN modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%äº¤å‰å ¡å’%' THEN 'äº¤å‰å ¡å’'\n        END AS mode_name,\n        vplayerid,\n        MIN(dtstatdate) AS first_play_date\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE \n        (submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼')\n        OR (modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%')\n        OR (modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename = 'å¹»æƒ³æ··æˆ˜')\n        OR (modename = 'ä¼‘é—²æ¨¡å¼' AND submodename IN ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ '))\n        OR (modename = 'ä¼‘é—²æ¨¡å¼' AND submodename LIKE '%ç­–ç•¥è½½å…·%')\n        OR (modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename LIKE '%ç‚å¤æ··æˆ˜%')\n        OR (modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%å•äººè£…å¤‡%')\n        OR (modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%äº¤å‰å ¡å’%')\n    GROUP BY mode_name, vplayerid\n),\n\n-- è®¡ç®—ç•™å­˜æƒ…å†µï¼šæ¯ä¸€å¤©æ˜¯å¦æ´»è·ƒ\nretention_data AS (\n    SELECT \n        fp.mode_name,\n        fp.first_play_date,\n        DATEDIFF(d.dtstatdate, fp.first_play_date) AS day_diff,\n        COUNT(DISTINCT fp.vplayerid) AS retained_users\n    FROM first_play_dates fp\n    JOIN dws_jordass_mode_roundrecord_di d\n        ON fp.vplayerid = d.vplayerid\n        AND d.dtstatdate BETWEEN fp.first_play_date AND DATE_ADD(fp.first_play_date, INTERVAL 7 DAY)\n    GROUP BY fp.mode_name, fp.first_play_date, day_diff\n)\n\n-- æœ€ç»ˆè¾“å‡ºï¼šç©æ³•ã€ä¸Šçº¿é¦–å‘¨é¦–æ¬¡ç©çš„æ—¥æœŸã€ç¬¬å‡ å¤©ç•™å­˜ã€ç•™å­˜ç”¨æˆ·æ•°\nSELECT \n    mode_name AS ç©æ³•,\n    first_play_date AS ä¸Šçº¿é¦–å‘¨é¦–æ¬¡ç©çš„æ—¥æœŸ,\n    day_diff AS ç¬¬å‡ å¤©ç•™å­˜,\n    retained_users AS ç©æ³•ç•™å­˜ç”¨æˆ·æ•°\nFROM retention_data\nORDER BY mode_name, day_diff;\n```\n\n---\n\n## ğŸ“ **è§£é‡Šè¯´æ˜**\n\n### ç¬¬ä¸€æ­¥ï¼šfirst_play_dates\n- ä½¿ç”¨ `CASE WHEN` åŒ¹é…æ‰€æœ‰ç©æ³•åç§°ä¸å¯¹åº”æ¡ä»¶\n- æŒ‰ç…§ `vplayerid` å’Œ `mode_name` åˆ†ç»„ï¼Œæ‰¾åˆ°æ¯ä¸ªäººé¦–æ¬¡å‚ä¸çš„æ—¥æœŸ\n\n### ç¬¬äºŒæ­¥ï¼šretention_data\n- å°†é¦–æ¬¡å‚ä¸ç”¨æˆ·ä¸å…¨é‡æ•°æ®è¿æ¥ï¼Œé™å®šæ—¶é—´èŒƒå›´æ˜¯é¦–æ—¥åˆ°ç¬¬ä¸ƒå¤©\n- ä½¿ç”¨ `DATEDIFF()` å¾—åˆ°ä»é¦–æ¬¡å‚ä¸èµ·çš„ç¬¬å‡ å¤©\n- ç»Ÿè®¡æ¯ä¸€å¤©æœ‰å¤šå°‘ç”¨æˆ·è¿˜æ´»è·ƒï¼ˆå»é‡ï¼‰\n\n### ç¬¬ä¸‰æ­¥ï¼šæœ€ç»ˆè¾“å‡º\n- è¾“å‡ºæ‰€éœ€å­—æ®µï¼šç©æ³•ã€é¦–æ¬¡å‚ä¸æ—¥æœŸã€ç¬¬å‡ å¤©ç•™å­˜ã€ç•™å­˜äººæ•°\n- æ’åºæ¸…æ™°ä¾¿äºæŸ¥çœ‹\n\n---\n\n## ğŸ§ª ç¤ºä¾‹è¾“å‡ºæ ¼å¼ï¼ˆå‡è®¾ï¼‰ï¼š\n\n| ç©æ³•         | ä¸Šçº¿é¦–å‘¨é¦–æ¬¡ç©çš„æ—¥æœŸ | ç¬¬å‡ å¤©ç•™å­˜ | ç©æ³•ç•™å­˜ç”¨æˆ·æ•° |\n|--------------|----------------------|------------|----------------|\n| å¹¿åŸŸæˆ˜åœº     | 20240723             | 0          | 1000           |\n| å¹¿åŸŸæˆ˜åœº     | 20240723             | 1          | 800            |\n| å¹¿åŸŸæˆ˜åœº     | 20240723             | 2          | 600            |\n| ...          | ...                  | ...        | ...            |\n\n---\n\nå¦‚éœ€è¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½æˆ–æ”¯æŒæ›´å¤šç©æ³•æ‰©å±•ï¼Œè¯·å‘ŠçŸ¥ï¼"
},
{
  "instruction": "è¯·ä½ æ¥ä¸‹æ¥ä¸€æ­¥æ­¥æ€è€ƒï¼Œå†™å‡ºæ­£ç¡®çš„SQLæŸ¥è¯¢è¯­å¥ä»¥æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚",
  "input": "ä½ æ˜¯ä¸€åMySQLä¸“å®¶ï¼Œç°åœ¨éœ€è¦é˜…è¯»å¹¶ç†è§£ä¸‹é¢çš„ã€æ•°æ®åº“schemaã€‘æè¿°ï¼Œä»¥åŠå¯èƒ½ç”¨åˆ°çš„ã€å‚è€ƒä¿¡æ¯ã€‘ï¼Œå¹¶è¿ç”¨MySQLçŸ¥è¯†ç”Ÿæˆsqlè¯­å¥å›ç­”ã€ç”¨æˆ·é—®é¢˜ã€‘ã€‚\nã€ç”¨æˆ·é—®é¢˜ã€‘\nç»Ÿè®¡å„ä¸ªç©æ³•ä¸Šçº¿é¦–å‘¨ç•™å­˜æƒ…å†µ\nè¾“å‡ºï¼šç©æ³•ã€ä¸Šçº¿é¦–å‘¨é¦–æ¬¡ç©çš„æ—¥æœŸã€ç¬¬å‡ å¤©ç•™å­˜ï¼ˆ0,1,2...7)ã€ç©æ³•ç•™å­˜ç”¨æˆ·æ•°\n\nå„ç©æ³•é¦–å‘¨ä¸Šçº¿æ—¥æœŸï¼š\n\"å¹¿åŸŸæˆ˜åœº\": \"20240723\",\n\"æ¶ˆç­æˆ˜\": \"20230804\",\n\"å¹»æƒ³æ··æˆ˜\": \"20241115\",\n\"è’é‡ä¼ è¯´\": \"20240903\",\n\"ç­–ç•¥è½½å…·\": \"20241010\",\n\"ç‚å¤æ··æˆ˜\": \"20240625\",\n\"å•äººè£…å¤‡\": \"20240517\",\n\"äº¤å‰å ¡å’\": \"20240412\"\n\nã€æ•°æ®åº“schemaã€‘\nCREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` TEXT COMMENT 'ç»Ÿè®¡æ—¥æœŸæ ¼å¼YYYYMMDD',\n  `vgameappid` TEXT COMMENT 'è´¦å·ä½“ç³»ï¼šwx:å¾®ä¿¡ï¼Œqqï¼šæ‰‹Q',\n  `platid` BIGINT COMMENT 'ç³»ç»Ÿå¹³å°ï¼š0:IOS,1:Android',\n  `vplayerid` TEXT COMMENT 'ç©å®¶ID',\n  `mode` BIGINT COMMENT 'æ¨¡å¼ID',\n  `modename` TEXT COMMENT 'æ¨¡å¼åç§°',\n  `submode` BIGINT COMMENT 'å­æ¨¡å¼ID',\n  `submodename` TEXT COMMENT 'å­æ¨¡å¼åç§°',\n  `map` BIGINT COMMENT 'åœ°å›¾ID',\n  `mapname` TEXT COMMENT 'åœ°å›¾åç§°',\n  `seasonid` BIGINT COMMENT 'èµ›å­£ID',\n  `seasonname` TEXT COMMENT 'èµ›å­£åç§°',\n  `roundcnt` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ•°',\n  `roundtime` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ—¶é•¿(ç§’)',\n  `survivaltime` BIGINT COMMENT 'å½“æ—¥å­˜æ´»æ—¶é•¿(ç§’)',\n  `firstroundtime` TEXT COMMENT 'å½“æ—¥é¦–æ¬¡å¯¹å±€æ—¶é—´',\n  `device_type` BIGINT COMMENT 'è®¾å¤‡ç±»å‹'\n);\n\nã€å‚è€ƒä¿¡æ¯ã€‘\nè¯´æ˜ï¼š\nå¹¿åŸŸæˆ˜åœº ï¼ˆ2024/7/23ï¼‰submodename= 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'ï¼Œ\næ¶ˆç­æˆ˜ï¼ˆ2023/8/4ï¼‰ modename='ç»„é˜Ÿç«æŠ€' and submodename like '%æ¶ˆç­æˆ˜æ¨¡å¼%'ï¼Œ\nå¹»æƒ³æ··æˆ˜ï¼ˆ2024/11/15ï¼‰modename='åˆ›æ„åˆ›ä½œé—´' and submodename='å¹»æƒ³æ··æˆ˜'ï¼Œ\nè’é‡ä¼ è¯´ï¼ˆ2024-09-03ï¼‰modename='ä¼‘é—²æ¨¡å¼' and submodename in ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ ')ï¼Œ\nç­–ç•¥è½½å…·ï¼ˆ2024-10-10ï¼‰modename='ä¼‘é—²æ¨¡å¼' and submodename like '%ç­–ç•¥è½½å…·%'ï¼Œ\nç‚å¤æ··æˆ˜ï¼ˆ2024-06-25ï¼‰modename='åˆ›æ„åˆ›ä½œé—´' and submodename like '%ç‚å¤æ··æˆ˜%'ï¼Œ\nå•äººè£…å¤‡ï¼ˆ2024.5.17ï¼‰modename='ç»„é˜Ÿç«æŠ€' and submodename like '%å•äººè£…å¤‡%'ï¼Œ\näº¤å‰å ¡å’ï¼ˆ2024.4.12ï¼‰ modename='ç»„é˜Ÿç«æŠ€' and submodename like '%äº¤å‰å ¡å’%'\n\nç¬¬å‡ å¤©ç•™å­˜ï¼š0è¡¨ç¤ºå½“å¤©å‚ä¸ã€1è¡¨ç¤ºå½“å¤©å‚ä¸åœ¨ç¬¬2å¤©ä¹Ÿå‚ä¸ã€2è¡¨ç¤ºå½“å¤©å‚ä¸åœ¨ç¬¬3å¤©ä¹Ÿå‚ä¸ï¼Œä¾æ­¤ç±»æ¨\n\n",
  "chosen": "select  a.itype,\n        a.dtstatdate,\n        datediff(b.dtstatdate,a.dtstatdate) as idaynum,\n        count(distinct a.vplayerid)           as iusernum\nfrom (                      \n    select\n        itype,\n        min(dtstatdate) as dtstatdate,\n        vplayerid\n    from  (\n        select 'å¹¿åŸŸæˆ˜åœº'      as itype,\n                min(dtstatdate) as dtstatdate,\n                vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',6)\n        and submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'\n        group by vplayerid\n\n        union all\n        select 'æ¶ˆç­æˆ˜', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',6)\n        and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%æ¶ˆç­æˆ˜æ¨¡å¼%'\n        group by vplayerid\n\n        union all\n        select 'å¹»æƒ³æ··æˆ˜', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',6)\n        and modename='åˆ›æ„åˆ›ä½œé—´' and submodename='å¹»æƒ³æ··æˆ˜'\n        group by vplayerid\n\n        union all\n        select 'è’é‡ä¼ è¯´', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',6)\n        and modename='ä¼‘é—²æ¨¡å¼' and submodename in ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ ')\n        group by vplayerid\n\n        union all\n        select 'ç­–ç•¥è½½å…·', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',6)\n        and modename='ä¼‘é—²æ¨¡å¼' and submodename like '%ç­–ç•¥è½½å…·%'\n        group by vplayerid\n\n        union all\n        select 'ç‚å¤æ··æˆ˜', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',6)\n        and modename='åˆ›æ„åˆ›ä½œé—´' and submodename like '%ç‚å¤æ··æˆ˜%'\n        group by vplayerid\n\n        union all\n        select 'å•äººè£…å¤‡', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',6)\n        and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%å•äººè£…å¤‡%'\n        group by vplayerid\n\n        union all\n        select 'äº¤å‰å ¡å’', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',6)\n        and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%äº¤å‰å ¡å’%'\n        group by vplayerid\n    ) t\n    group by itype, vplayerid\n) a\nleft join (\n        select 'å¹¿åŸŸæˆ˜åœº' as itype, dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',13)\n          and submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'æ¶ˆç­æˆ˜', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',13)\n          and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%æ¶ˆç­æˆ˜æ¨¡å¼%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'å¹»æƒ³æ··æˆ˜', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',13)\n          and modename='åˆ›æ„åˆ›ä½œé—´' and submodename='å¹»æƒ³æ··æˆ˜'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'è’é‡ä¼ è¯´', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',13)\n          and modename='ä¼‘é—²æ¨¡å¼' and submodename in ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ ')\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'ç­–ç•¥è½½å…·', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',13)\n          and modename='ä¼‘é—²æ¨¡å¼' and submodename like '%ç­–ç•¥è½½å…·%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'ç‚å¤æ··æˆ˜', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',13)\n          and modename='åˆ›æ„åˆ›ä½œé—´' and submodename like '%ç‚å¤æ··æˆ˜%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'å•äººè£…å¤‡', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',13)\n          and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%å•äººè£…å¤‡%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'äº¤å‰å ¡å’', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',13)\n          and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%äº¤å‰å ¡å’%'\n        group by dtstatdate, vplayerid\n) b\n  on  a.itype      = b.itype\nand  a.vplayerid    = b.vplayerid\nwhere datediff(b.dtstatdate,a.dtstatdate) between 0 and 7\ngroup by a.itype, a.dtstatdate, datediff(b.dtstatdate,a.dtstatdate);",
  "rejected": "æˆ‘ä»¬æ¥ä¸€æ­¥ä¸€æ­¥åˆ†æè¿™ä¸ªé—®é¢˜ï¼Œå¹¶æœ€ç»ˆå†™å‡ºç¬¦åˆè¦æ±‚çš„ SQL æŸ¥è¯¢è¯­å¥ã€‚\n\n---\n\n## ğŸ§  **ç›®æ ‡è§£æ**\n\næˆ‘ä»¬è¦ç»Ÿè®¡çš„æ˜¯**æ¯ä¸ªç©æ³•ï¼ˆmodeï¼‰ä¸Šçº¿é¦–å‘¨çš„ç•™å­˜æƒ…å†µ**ï¼š\n\n### è¾“å‡ºå­—æ®µåŒ…æ‹¬ï¼š\n- ç©æ³•åç§°ï¼ˆ`modename` æˆ– `submodename`ï¼‰\n- ä¸Šçº¿é¦–æ—¥ï¼ˆå³é¦–æ¬¡ä¸Šçº¿æ—¥æœŸï¼‰\n- ç¬¬å‡ å¤©ç•™å­˜ï¼ˆ0~7 å¤©ï¼‰\n- ç•™å­˜ç”¨æˆ·æ•°ï¼ˆæœ‰å¤šå°‘äººåœ¨æŸä¸€å¤©ä¹‹åä»ç„¶å‚ä¸æ¸¸æˆï¼‰\n\n---\n\n## ğŸ” **å…³é”®ä¿¡æ¯æå–**\n\n### 1. å„ç©æ³•ä¸Šçº¿æ—¥æœŸï¼š\n| ç©æ³•åç§° | ä¸Šçº¿æ—¥æœŸ |\n|----------|-----------|\n| å¹¿åŸŸæˆ˜åœº | 20240723 |\n| æ¶ˆç­æˆ˜   | 20230804 |\n| å¹»æƒ³æ··æˆ˜ | 20241115 |\n| è’é‡ä¼ è¯´ | 20240903 |\n| ç­–ç•¥è½½å…· | 20241010 |\n| ç‚å¤æ··æˆ˜ | 20240625 |\n| å•äººè£…å¤‡ | 20240517 |\n| äº¤å‰å ¡å’ | 20240412 |\n\n> æ³¨æ„ï¼šè¿™äº›æ˜¯ä¸Šçº¿æ—¶é—´ï¼Œä¸æ˜¯ç»Ÿè®¡æ—¶é—´ã€‚æˆ‘ä»¬è¦æ‰¾çš„æ˜¯è¿™äº›ç©æ³•ä¸­ï¼Œ**é¦–æ¬¡ä¸Šçº¿é‚£å¤©å¼€å§‹è®¡ç®—çš„é¦–å‘¨ç•™å­˜æ•°æ®**ã€‚\n\n---\n\n## ğŸ“Š **æ€è·¯æ‹†è§£**\n\næˆ‘ä»¬éœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š\n\n### Step 1ï¼šè¯†åˆ«æ¯ä¸ªç©æ³•å¯¹åº”çš„è®°å½•è¡¨ä¸­çš„å­—æ®µ\næ ¹æ®æä¾›çš„â€œå‚è€ƒä¿¡æ¯â€ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ä¸åŒç©æ³•å¦‚ä½•åŒ¹é…åˆ° `modename` å’Œ `submodename` å­—æ®µã€‚\n\nä¾‹å¦‚ï¼š\n```sql\nmodename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%'\n```\n\n### Step 2ï¼šç¡®å®šå“ªäº›ç©å®¶æ˜¯åœ¨å¯¹åº”ç©æ³•ä¸Šçº¿é¦–æ—¥é¦–æ¬¡å‚ä¸æ¸¸æˆçš„\næˆ‘ä»¬éœ€è¦ç­›é€‰å‡ºåœ¨è¯¥ç©æ³•ä¸Šçº¿é¦–æ—¥ï¼ˆå¦‚ 20240723ï¼‰ç¬¬ä¸€æ¬¡è¿›å…¥è¯¥ç©æ³•çš„ç©å®¶ã€‚\n\n### Step 3ï¼šåˆ¤æ–­è¿™äº›ç©å®¶åœ¨åç»­çš„æ¯ä¸€å¤©æ˜¯å¦è¿˜ç»§ç»­å‚ä¸äº†æ¸¸æˆ\nè¿™éœ€è¦æˆ‘ä»¬æŒ‰ç©å®¶åˆ†ç»„ï¼Œç„¶åæŸ¥çœ‹ä»–ä»¬åœ¨ä¸Šçº¿åçš„ç¬¬ 0 ~ 7 å¤©æ˜¯å¦æœ‰å‚ä¸è®°å½•ã€‚\n\n### Step 4ï¼šç»Ÿè®¡æ¯å¤©çš„ç•™å­˜äººæ•°\nå°†æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ç©å®¶æŒ‰â€œç¬¬å‡ å¤©ç•™å­˜â€è¿›è¡Œåˆ†ç»„ç»Ÿè®¡ã€‚\n\n---\n\n## âœ… **å®ç°é€»è¾‘ï¼ˆMySQL SQLï¼‰**\n\næˆ‘ä»¬å°†ä½¿ç”¨å¦‚ä¸‹æ–¹å¼å®Œæˆä»»åŠ¡ï¼š\n\n1. æ„å»ºä¸€ä¸ªåŒ…å«ç©æ³•ä¸ä¸Šçº¿æ—¥æœŸæ˜ å°„å…³ç³»çš„ä¸´æ—¶è¡¨æˆ– CTEï¼›\n2. ä½¿ç”¨ `JOIN` è¿æ¥åŸå§‹è¡¨è·å–æŒ‡å®šç©æ³•çš„æ•°æ®ï¼›\n3. åˆ¤æ–­ç©å®¶é¦–æ¬¡å‚ä¸æ—¶é—´æ˜¯å¦ç­‰äºä¸Šçº¿æ—¥æœŸï¼›\n4. å¯¹äºæ¯ä¸ªé¦–æ¬¡å‚ä¸è¯¥ç©æ³•çš„ç©å®¶ï¼Œæ£€æŸ¥å…¶ä¹‹å 7 å¤©å†…çš„å‚ä¸æƒ…å†µï¼›\n5. æœ€ç»ˆç»Ÿè®¡æ¯å¤©çš„ç•™å­˜äººæ•°ã€‚\n\n---\n\n## ğŸ§¾ **å®Œæ•´ SQL æŸ¥è¯¢è¯­å¥**\n\n```sql\nWITH mode_launch_dates AS (\n    SELECT 'å¹¿åŸŸæˆ˜åœº' AS mode_name, '20240723' AS launch_date\n    UNION ALL\n    SELECT 'æ¶ˆç­æˆ˜', '20230804'\n    UNION ALL\n    SELECT 'å¹»æƒ³æ··æˆ˜', '20241115'\n    UNION ALL\n    SELECT 'è’é‡ä¼ è¯´', '20240903'\n    UNION ALL\n    SELECT 'ç­–ç•¥è½½å…·', '20241010'\n    UNION ALL\n    SELECT 'ç‚å¤æ··æˆ˜', '20240625'\n    UNION ALL\n    SELECT 'å•äººè£…å¤‡', '20240517'\n    UNION ALL\n    SELECT 'äº¤å‰å ¡å’', '20240412'\n),\nfirst_players AS (\n    SELECT \n        d.modename,\n        d.submodename,\n        d.vplayerid,\n        MIN(d.dtstatdate) AS first_play_date\n    FROM dws_jordass_mode_roundrecord_di d\n    JOIN mode_launch_dates mld\n        ON (\n            (mld.mode_name = 'å¹¿åŸŸæˆ˜åœº' AND d.submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼')\n            OR (mld.mode_name = 'æ¶ˆç­æˆ˜' AND d.modename = 'ç»„é˜Ÿç«æŠ€' AND d.submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%')\n            OR (mld.mode_name = 'å¹»æƒ³æ··æˆ˜' AND d.modename = 'åˆ›æ„åˆ›ä½œé—´' AND d.submodename = 'å¹»æƒ³æ··æˆ˜')\n            OR (mld.mode_name = 'è’é‡ä¼ è¯´' AND d.modename = 'ä¼‘é—²æ¨¡å¼' AND d.submodename IN ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ '))\n            OR (mld.mode_name = 'ç­–ç•¥è½½å…·' AND d.modename = 'ä¼‘é—²æ¨¡å¼' AND d.submodename LIKE '%ç­–ç•¥è½½å…·%')\n            OR (mld.mode_name = 'ç‚å¤æ··æˆ˜' AND d.modename = 'åˆ›æ„åˆ›ä½œé—´' AND d.submodename LIKE '%ç‚å¤æ··æˆ˜%')\n            OR (mld.mode_name = 'å•äººè£…å¤‡' AND d.modename = 'ç»„é˜Ÿç«æŠ€' AND d.submodename LIKE '%å•äººè£…å¤‡%')\n            OR (mld.mode_name = 'äº¤å‰å ¡å’' AND d.modename = 'ç»„é˜Ÿç«æŠ€' AND d.submodename LIKE '%äº¤å‰å ¡å’%')\n        )\n    GROUP BY d.modename, d.submodename, d.vplayerid\n    HAVING MIN(d.dtstatdate) = mld.launch_date\n),\nretention_days AS (\n    SELECT \n        f.modename,\n        f.submodename,\n        f.first_play_date,\n        DATEDIFF(d.dtstatdate, f.first_play_date) AS retention_day,\n        COUNT(DISTINCT f.vplayerid) AS user_count\n    FROM first_players f\n    JOIN dws_jordass_mode_roundrecord_di d\n        ON f.vplayerid = d.vplayerid\n        AND d.dtstatdate >= f.first_play_date\n        AND d.dtstatdate <= DATE_ADD(f.first_play_date, INTERVAL 7 DAY)\n    GROUP BY f.modename, f.submodename, f.first_play_date, retention_day\n)\nSELECT \n    CASE \n        WHEN mld.mode_name = 'å¹¿åŸŸæˆ˜åœº' THEN 'å¹¿åŸŸæˆ˜åœº'\n        WHEN mld.mode_name = 'æ¶ˆç­æˆ˜' THEN 'æ¶ˆç­æˆ˜'\n        WHEN mld.mode_name = 'å¹»æƒ³æ··æˆ˜' THEN 'å¹»æƒ³æ··æˆ˜'\n        WHEN mld.mode_name = 'è’é‡ä¼ è¯´' THEN 'è’é‡ä¼ è¯´'\n        WHEN mld.mode_name = 'ç­–ç•¥è½½å…·' THEN 'ç­–ç•¥è½½å…·'\n        WHEN mld.mode_name = 'ç‚å¤æ··æˆ˜' THEN 'ç‚å¤æ··æˆ˜'\n        WHEN mld.mode_name = 'å•äººè£…å¤‡' THEN 'å•äººè£…å¤‡'\n        WHEN mld.mode_name = 'äº¤å‰å ¡å’' THEN 'äº¤å‰å ¡å’'\n    END AS mode,\n    r.first_play_date AS first_play_date,\n    r.retention_day AS day_retained,\n    r.user_count AS retained_users\nFROM retention_days r\nJOIN mode_launch_dates mld\n    ON (\n        (mld.mode_name = 'å¹¿åŸŸæˆ˜åœº' AND r.submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼')\n        OR (mld.mode_name = 'æ¶ˆç­æˆ˜' AND r.modename = 'ç»„é˜Ÿç«æŠ€' AND r.submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%')\n        OR (mld.mode_name = 'å¹»æƒ³æ··æˆ˜' AND r.modename = 'åˆ›æ„åˆ›ä½œé—´' AND r.submodename = 'å¹»æƒ³æ··æˆ˜')\n        OR (mld.mode_name = 'è’é‡ä¼ è¯´' AND r.modename = 'ä¼‘é—²æ¨¡å¼' AND r.submodename IN ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ '))\n        OR (mld.mode_name = 'ç­–ç•¥è½½å…·' AND r.modename = 'ä¼‘é—²æ¨¡å¼' AND r.submodename LIKE '%ç­–ç•¥è½½å…·%')\n        OR (mld.mode_name = 'ç‚å¤æ··æˆ˜' AND r.modename = 'åˆ›æ„åˆ›ä½œé—´' AND r.submodename LIKE '%ç‚å¤æ··æˆ˜%')\n        OR (mld.mode_name = 'å•äººè£…å¤‡' AND r.modename = 'ç»„é˜Ÿç«æŠ€' AND r.submodename LIKE '%å•äººè£…å¤‡%')\n        OR (mld.mode_name = 'äº¤å‰å ¡å’' AND r.modename = 'ç»„é˜Ÿç«æŠ€' AND r.submodename LIKE '%äº¤å‰å ¡å’%')\n    )\nORDER BY mode, day_retained;\n```\n\n---\n\n## ğŸ§¾ **è¯´æ˜**\n\n- ä½¿ç”¨äº† `WITH` å­å¥å®šä¹‰ç©æ³•ä¸Šçº¿æ—¥æœŸå’Œé¦–æ¬¡å‚ä¸ç©å®¶ï¼›\n- åˆ©ç”¨äº† `MIN(dtstatdate)` æ¥æ‰¾å‡ºæ¯ä½ç©å®¶çš„é¦–æ¬¡å‚ä¸æ—¥æœŸï¼›\n- ç„¶åé€šè¿‡ `DATEDIFF()` è®¡ç®—å‡ºä»ä¸Šçº¿ç¬¬ä¸€å¤©èµ·çš„ç¬¬å‡ å¤©ï¼›\n- æœ€ç»ˆæŒ‰ç©æ³•ã€ç•™å­˜å¤©æ•°ã€ç”¨æˆ·æ•°é‡è¿›è¡Œè¾“å‡ºï¼›\n- æ”¯æŒæ‰€æœ‰ç©æ³•çš„ç•™å­˜åˆ†æã€‚\n\n---\n\n## ğŸ§ª ç¤ºä¾‹è¾“å‡ºç»“æ„å¦‚ä¸‹ï¼š\n\n| mode       | first_play_date | day_retained | retained_users |\n|------------|------------------|---------------|----------------|\n| å¹¿åŸŸæˆ˜åœº   | 20240723         | 0             | 1200           |\n| å¹¿åŸŸæˆ˜åœº   | 20240723         | 1             | 900            |\n| å¹¿åŸŸæˆ˜åœº   | 20240723         | 2             | 700            |\n| ...        | ...              | ...           | ...            |\n\n---\n\nå¦‚æœä½ å¸Œæœ›æˆ‘å¸®ä½ æŠŠè¿™ä¸ªç»“æœå¯¼å‡ºä¸º CSV æˆ–è¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼"
},
{
  "instruction": "è¯·ä½ æ¥ä¸‹æ¥ä¸€æ­¥æ­¥æ€è€ƒï¼Œå†™å‡ºæ­£ç¡®çš„SQLæŸ¥è¯¢è¯­å¥ä»¥æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚",
  "input": "ä½ æ˜¯ä¸€åMySQLä¸“å®¶ï¼Œç°åœ¨éœ€è¦é˜…è¯»å¹¶ç†è§£ä¸‹é¢çš„ã€æ•°æ®åº“schemaã€‘æè¿°ï¼Œä»¥åŠå¯èƒ½ç”¨åˆ°çš„ã€å‚è€ƒä¿¡æ¯ã€‘ï¼Œå¹¶è¿ç”¨MySQLçŸ¥è¯†ç”Ÿæˆsqlè¯­å¥å›ç­”ã€ç”¨æˆ·é—®é¢˜ã€‘ã€‚\nã€ç”¨æˆ·é—®é¢˜ã€‘\nç»Ÿè®¡å„ä¸ªç©æ³•ä¸Šçº¿é¦–å‘¨ç•™å­˜æƒ…å†µ\nè¾“å‡ºï¼šç©æ³•ã€ä¸Šçº¿é¦–å‘¨é¦–æ¬¡ç©çš„æ—¥æœŸã€ç¬¬å‡ å¤©ç•™å­˜ï¼ˆ0,1,2...7)ã€ç©æ³•ç•™å­˜ç”¨æˆ·æ•°\n\nå„ç©æ³•é¦–å‘¨ä¸Šçº¿æ—¥æœŸï¼š\n\"å¹¿åŸŸæˆ˜åœº\": \"20240723\",\n\"æ¶ˆç­æˆ˜\": \"20230804\",\n\"å¹»æƒ³æ··æˆ˜\": \"20241115\",\n\"è’é‡ä¼ è¯´\": \"20240903\",\n\"ç­–ç•¥è½½å…·\": \"20241010\",\n\"ç‚å¤æ··æˆ˜\": \"20240625\",\n\"å•äººè£…å¤‡\": \"20240517\",\n\"äº¤å‰å ¡å’\": \"20240412\"\n\nã€æ•°æ®åº“schemaã€‘\nCREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` TEXT COMMENT 'ç»Ÿè®¡æ—¥æœŸæ ¼å¼YYYYMMDD',\n  `vgameappid` TEXT COMMENT 'è´¦å·ä½“ç³»ï¼šwx:å¾®ä¿¡ï¼Œqqï¼šæ‰‹Q',\n  `platid` BIGINT COMMENT 'ç³»ç»Ÿå¹³å°ï¼š0:IOS,1:Android',\n  `vplayerid` TEXT COMMENT 'ç©å®¶ID',\n  `mode` BIGINT COMMENT 'æ¨¡å¼ID',\n  `modename` TEXT COMMENT 'æ¨¡å¼åç§°',\n  `submode` BIGINT COMMENT 'å­æ¨¡å¼ID',\n  `submodename` TEXT COMMENT 'å­æ¨¡å¼åç§°',\n  `map` BIGINT COMMENT 'åœ°å›¾ID',\n  `mapname` TEXT COMMENT 'åœ°å›¾åç§°',\n  `seasonid` BIGINT COMMENT 'èµ›å­£ID',\n  `seasonname` TEXT COMMENT 'èµ›å­£åç§°',\n  `roundcnt` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ•°',\n  `roundtime` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ—¶é•¿(ç§’)',\n  `survivaltime` BIGINT COMMENT 'å½“æ—¥å­˜æ´»æ—¶é•¿(ç§’)',\n  `firstroundtime` TEXT COMMENT 'å½“æ—¥é¦–æ¬¡å¯¹å±€æ—¶é—´',\n  `device_type` BIGINT COMMENT 'è®¾å¤‡ç±»å‹'\n);\n\nã€å‚è€ƒä¿¡æ¯ã€‘\nè¯´æ˜ï¼š\nå¹¿åŸŸæˆ˜åœº ï¼ˆ2024/7/23ï¼‰submodename= 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'ï¼Œ\næ¶ˆç­æˆ˜ï¼ˆ2023/8/4ï¼‰ modename='ç»„é˜Ÿç«æŠ€' and submodename like '%æ¶ˆç­æˆ˜æ¨¡å¼%'ï¼Œ\nå¹»æƒ³æ··æˆ˜ï¼ˆ2024/11/15ï¼‰modename='åˆ›æ„åˆ›ä½œé—´' and submodename='å¹»æƒ³æ··æˆ˜'ï¼Œ\nè’é‡ä¼ è¯´ï¼ˆ2024-09-03ï¼‰modename='ä¼‘é—²æ¨¡å¼' and submodename in ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ ')ï¼Œ\nç­–ç•¥è½½å…·ï¼ˆ2024-10-10ï¼‰modename='ä¼‘é—²æ¨¡å¼' and submodename like '%ç­–ç•¥è½½å…·%'ï¼Œ\nç‚å¤æ··æˆ˜ï¼ˆ2024-06-25ï¼‰modename='åˆ›æ„åˆ›ä½œé—´' and submodename like '%ç‚å¤æ··æˆ˜%'ï¼Œ\nå•äººè£…å¤‡ï¼ˆ2024.5.17ï¼‰modename='ç»„é˜Ÿç«æŠ€' and submodename like '%å•äººè£…å¤‡%'ï¼Œ\näº¤å‰å ¡å’ï¼ˆ2024.4.12ï¼‰ modename='ç»„é˜Ÿç«æŠ€' and submodename like '%äº¤å‰å ¡å’%'\n\nç¬¬å‡ å¤©ç•™å­˜ï¼š0è¡¨ç¤ºå½“å¤©å‚ä¸ã€1è¡¨ç¤ºå½“å¤©å‚ä¸åœ¨ç¬¬2å¤©ä¹Ÿå‚ä¸ã€2è¡¨ç¤ºå½“å¤©å‚ä¸åœ¨ç¬¬3å¤©ä¹Ÿå‚ä¸ï¼Œä¾æ­¤ç±»æ¨\n\n",
  "chosen": "select  a.itype,\n        a.dtstatdate,\n        datediff(b.dtstatdate,a.dtstatdate) as idaynum,\n        count(distinct a.vplayerid)           as iusernum\nfrom (                      \n    select\n        itype,\n        min(dtstatdate) as dtstatdate,\n        vplayerid\n    from  (\n        select 'å¹¿åŸŸæˆ˜åœº'      as itype,\n                min(dtstatdate) as dtstatdate,\n                vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',6)\n        and submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'\n        group by vplayerid\n\n        union all\n        select 'æ¶ˆç­æˆ˜', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',6)\n        and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%æ¶ˆç­æˆ˜æ¨¡å¼%'\n        group by vplayerid\n\n        union all\n        select 'å¹»æƒ³æ··æˆ˜', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',6)\n        and modename='åˆ›æ„åˆ›ä½œé—´' and submodename='å¹»æƒ³æ··æˆ˜'\n        group by vplayerid\n\n        union all\n        select 'è’é‡ä¼ è¯´', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',6)\n        and modename='ä¼‘é—²æ¨¡å¼' and submodename in ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ ')\n        group by vplayerid\n\n        union all\n        select 'ç­–ç•¥è½½å…·', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',6)\n        and modename='ä¼‘é—²æ¨¡å¼' and submodename like '%ç­–ç•¥è½½å…·%'\n        group by vplayerid\n\n        union all\n        select 'ç‚å¤æ··æˆ˜', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',6)\n        and modename='åˆ›æ„åˆ›ä½œé—´' and submodename like '%ç‚å¤æ··æˆ˜%'\n        group by vplayerid\n\n        union all\n        select 'å•äººè£…å¤‡', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',6)\n        and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%å•äººè£…å¤‡%'\n        group by vplayerid\n\n        union all\n        select 'äº¤å‰å ¡å’', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',6)\n        and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%äº¤å‰å ¡å’%'\n        group by vplayerid\n    ) t\n    group by itype, vplayerid\n) a\nleft join (\n        select 'å¹¿åŸŸæˆ˜åœº' as itype, dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',13)\n          and submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'æ¶ˆç­æˆ˜', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',13)\n          and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%æ¶ˆç­æˆ˜æ¨¡å¼%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'å¹»æƒ³æ··æˆ˜', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',13)\n          and modename='åˆ›æ„åˆ›ä½œé—´' and submodename='å¹»æƒ³æ··æˆ˜'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'è’é‡ä¼ è¯´', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',13)\n          and modename='ä¼‘é—²æ¨¡å¼' and submodename in ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ ')\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'ç­–ç•¥è½½å…·', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',13)\n          and modename='ä¼‘é—²æ¨¡å¼' and submodename like '%ç­–ç•¥è½½å…·%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'ç‚å¤æ··æˆ˜', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',13)\n          and modename='åˆ›æ„åˆ›ä½œé—´' and submodename like '%ç‚å¤æ··æˆ˜%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'å•äººè£…å¤‡', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',13)\n          and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%å•äººè£…å¤‡%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'äº¤å‰å ¡å’', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',13)\n          and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%äº¤å‰å ¡å’%'\n        group by dtstatdate, vplayerid\n) b\n  on  a.itype      = b.itype\nand  a.vplayerid    = b.vplayerid\nwhere datediff(b.dtstatdate,a.dtstatdate) between 0 and 7\ngroup by a.itype, a.dtstatdate, datediff(b.dtstatdate,a.dtstatdate);",
  "rejected": "ä¸ºäº†ç»Ÿè®¡å„ä¸ªç©æ³•ä¸Šçº¿é¦–å‘¨ç•™å­˜æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦åˆ†æ­¥éª¤è¿›è¡Œåˆ†æå’Œç¼–å†™ SQL æŸ¥è¯¢è¯­å¥ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†æ€è€ƒè¿‡ç¨‹ï¼š\n\n---\n\n## âœ… ç¬¬ä¸€æ­¥ï¼šç†è§£éœ€æ±‚\n\næˆ‘ä»¬è¦ç»Ÿè®¡çš„æ˜¯æ¯ä¸ªç©æ³•åœ¨**ä¸Šçº¿é¦–å‘¨å†…é¦–æ¬¡å‚ä¸æ¸¸æˆçš„ç”¨æˆ·**ï¼Œç„¶åè®¡ç®—è¿™äº›ç”¨æˆ·åœ¨ä¹‹åçš„ **ç¬¬0~7å¤©** çš„ç•™å­˜æƒ…å†µã€‚\n\nå…·ä½“è¾“å‡ºå­—æ®µåŒ…æ‹¬ï¼š\n- ç©æ³•åç§° (`modename` æˆ– `submodename`)\n- é¦–æ¬¡å‚ä¸æ—¥æœŸï¼ˆå³ä¸Šçº¿æ—¥ï¼‰\n- ç¬¬å‡ å¤©ç•™å­˜ï¼ˆ0 ~ 7ï¼‰\n- ç•™å­˜ç”¨æˆ·æ•°\n\n---\n\n## âœ… ç¬¬äºŒæ­¥ï¼šç¡®å®šæ•°æ®æ¥æºä¸å…³é”®é€»è¾‘\n\næˆ‘ä»¬ä½¿ç”¨è¡¨ï¼š\n```sql\ndws_jordass_mode_roundrecord_di\n```\n\n### å…³é”®ç‚¹ï¼š\n\n1. **è¯†åˆ«ä¸åŒç©æ³•çš„ä¸Šçº¿æ—¥æœŸ**\n   - å·²çŸ¥æ¯ç§ç©æ³•çš„ä¸Šçº¿æ—¥æœŸï¼Œå¦‚â€œå¹¿åŸŸæˆ˜åœºâ€æ˜¯ 20240723ã€‚\n2. **æ‰¾å‡ºæ¯ä¸ªç©æ³•é¦–æ¬¡å‚ä¸è¯¥ç©æ³•çš„ç”¨æˆ·**\n   - æ¯ä¸ªç”¨æˆ·ç¬¬ä¸€æ¬¡è¿›å…¥æŸä¸ªæ¨¡å¼çš„æ—¶é—´ä¸ºé¦–æ¬¡å‚ä¸æ—¶é—´ã€‚\n3. **åŸºäºé¦–æ¬¡å‚ä¸æ—¶é—´ï¼Œåˆ¤æ–­å…¶åç»­æ¯ä¸€å¤©æ˜¯å¦ç»§ç»­å‚ä¸**\n   - ä½¿ç”¨ `dtstatdate` å­—æ®µè¡¨ç¤ºç»Ÿè®¡æ—¥æœŸã€‚\n4. **æ ¹æ®ä¸Šçº¿æ—¥æœŸè®¡ç®—â€œç¬¬å‡ å¤©ç•™å­˜â€**\n   - å¦‚æœæŸç”¨æˆ·åœ¨ä¸Šçº¿å½“å¤©å‚ä¸ï¼Œåˆ™ç¬¬0å¤©ç•™å­˜ï¼›ç¬¬äºŒå¤©å‚ä¸åˆ™ç¬¬1å¤©ç•™å­˜ï¼Œä»¥æ­¤ç±»æ¨ã€‚\n\n---\n\n## âœ… ç¬¬ä¸‰æ­¥ï¼šæ„å»ºæŸ¥è¯¢ç»“æ„\n\næˆ‘ä»¬å°†åˆ†ä»¥ä¸‹å‡ æ­¥æ¥æ„é€  SQLï¼š\n\n### æ­¥éª¤ä¸€ï¼šç­›é€‰å‡ºæ‰€æœ‰ç©æ³•å¯¹åº”çš„è®°å½•ï¼Œå¹¶æ ‡è®°å…¶ä¸Šçº¿æ—¥æœŸ\n\næˆ‘ä»¬å¯ä»¥ç”¨ CASE WHEN æ¥æ˜ å°„ä¸åŒçš„ç©æ³•åŠå…¶ä¸Šçº¿æ—¥æœŸã€‚\n\n```sql\nWITH mode_launch_dates AS (\n    SELECT \n        CASE \n            WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n            WHEN modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%' THEN 'æ¶ˆç­æˆ˜'\n            WHEN modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename = 'å¹»æƒ³æ··æˆ˜' THEN 'å¹»æƒ³æ··æˆ˜'\n            WHEN modename = 'ä¼‘é—²æ¨¡å¼' AND submodename IN ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ ') THEN 'è’é‡ä¼ è¯´'\n            WHEN modename = 'ä¼‘é—²æ¨¡å¼' AND submodename LIKE '%ç­–ç•¥è½½å…·%' THEN 'ç­–ç•¥è½½å…·'\n            WHEN modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename LIKE '%ç‚å¤æ··æˆ˜%' THEN 'ç‚å¤æ··æˆ˜'\n            WHEN modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%å•äººè£…å¤‡%' THEN 'å•äººè£…å¤‡'\n            WHEN modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%äº¤å‰å ¡å’%' THEN 'äº¤å‰å ¡å’'\n        END AS mode_name,\n        CASE \n            WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN '20240723'\n            WHEN modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%' THEN '20230804'\n            WHEN modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename = 'å¹»æƒ³æ··æˆ˜' THEN '20241115'\n            WHEN modename = 'ä¼‘é—²æ¨¡å¼' AND submodename IN ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ ') THEN '20240903'\n            WHEN modename = 'ä¼‘é—²æ¨¡å¼' AND submodename LIKE '%ç­–ç•¥è½½å…·%' THEN '20241010'\n            WHEN modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename LIKE '%ç‚å¤æ··æˆ˜%' THEN '20240625'\n            WHEN modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%å•äººè£…å¤‡%' THEN '20240517'\n            WHEN modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%äº¤å‰å ¡å’%' THEN '20240412'\n        END AS launch_date\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE \n        (submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼') OR\n        (modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%') OR\n        (modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename = 'å¹»æƒ³æ··æˆ˜') OR\n        (modename = 'ä¼‘é—²æ¨¡å¼' AND submodename IN ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ ')) OR\n        (modename = 'ä¼‘é—²æ¨¡å¼' AND submodename LIKE '%ç­–ç•¥è½½å…·%') OR\n        (modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename LIKE '%ç‚å¤æ··æˆ˜%') OR\n        (modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%å•äººè£…å¤‡%') OR\n        (modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%äº¤å‰å ¡å’%')\n    GROUP BY mode_name, launch_date\n)\n```\n\n> ä¸Šé¢è¿™ä¸ª CTE ç”¨äºå°†æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ç©æ³•æ˜ å°„ä¸ºç»Ÿä¸€åç§°åŠä¸Šçº¿æ—¥æœŸã€‚\n\n---\n\n### æ­¥éª¤äºŒï¼šè·å–æ¯ä¸ªç©æ³•ä¸­é¦–æ¬¡å‚ä¸ç”¨æˆ·çš„é¦–æ¬¡å‚ä¸æ—¶é—´\n\næˆ‘ä»¬éœ€è¦æ‰¾å‡ºæ¯ä¸ªç”¨æˆ·åœ¨è¯¥ç©æ³•ä¸­çš„é¦–æ¬¡å‚ä¸æ—¶é—´ï¼ˆå³æœ€æ—©çš„ä¸€æ¡è®°å½•ï¼‰ã€‚\n\n```sql\nWITH first_play_times AS (\n    SELECT \n        vplayerid,\n        mode_name,\n        MIN(dtstatdate) AS first_play_date\n    FROM dws_jordass_mode_roundrecord_di di\n    JOIN mode_launch_dates mld\n        ON (\n            (di.submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' AND mld.mode_name = 'å¹¿åŸŸæˆ˜åœº') OR\n            (di.modename = 'ç»„é˜Ÿç«æŠ€' AND di.submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%' AND mld.mode_name = 'æ¶ˆç­æˆ˜') OR\n            (di.modename = 'åˆ›æ„åˆ›ä½œé—´' AND di.submodename = 'å¹»æƒ³æ··æˆ˜' AND mld.mode_name = 'å¹»æƒ³æ··æˆ˜') OR\n            (di.modename = 'ä¼‘é—²æ¨¡å¼' AND di.submodename IN ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ ') AND mld.mode_name = 'è’é‡ä¼ è¯´') OR\n            (di.modename = 'ä¼‘é—²æ¨¡å¼' AND di.submodename LIKE '%ç­–ç•¥è½½å…·%' AND mld.mode_name = 'ç­–ç•¥è½½å…·') OR\n            (di.modename = 'åˆ›æ„åˆ›ä½œé—´' AND di.submodename LIKE '%ç‚å¤æ··æˆ˜%' AND mld.mode_name = 'ç‚å¤æ··æˆ˜') OR\n            (di.modename = 'ç»„é˜Ÿç«æŠ€' AND di.submodename LIKE '%å•äººè£…å¤‡%' AND mld.mode_name = 'å•äººè£…å¤‡') OR\n            (di.modename = 'ç»„é˜Ÿç«æŠ€' AND di.submodename LIKE '%äº¤å‰å ¡å’%' AND mld.mode_name = 'äº¤å‰å ¡å’')\n        )\n    GROUP BY vplayerid, mode_name\n)\n```\n\n---\n\n### æ­¥éª¤ä¸‰ï¼šè®¡ç®—æ¯å¤©çš„ç•™å­˜äººæ•°\n\næˆ‘ä»¬éœ€è¦éå†ä»ä¸Šçº¿æ—¥èµ·çš„ä¸ƒå¤©ï¼Œåˆ¤æ–­å“ªäº›ç”¨æˆ·åœ¨è¿™æ®µæ—¶é—´å†…è¿˜æ´»è·ƒã€‚\n\nå¯ä»¥å…ˆå®šä¹‰ä¸€ä¸ªè¾…åŠ©å‡½æ•°æˆ–ç›´æ¥é€šè¿‡ JOIN æ„å»ºæ—¥æœŸèŒƒå›´ã€‚\n\n#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ `generate_series()` + å­æŸ¥è¯¢æ¨¡æ‹Ÿæ—¥æœŸåºåˆ—ï¼ˆMySQL ä¸æ”¯æŒæ­¤è¯­æ³•ï¼‰\n\næˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ„é€ ä¸€ä¸ªä¸´æ—¶è¡¨æˆ–è€…ä½¿ç”¨é€’å½’ CTEï¼ˆå¦‚æœ MySQL ç‰ˆæœ¬ >= 8.0ï¼‰æ¥ç”Ÿæˆæ—¥æœŸåˆ—ã€‚\n\nä¸è¿‡ä¸ºäº†ç®€åŒ–èµ·è§ï¼Œè¿™é‡Œé‡‡ç”¨æ›´é€šç”¨çš„æ–¹æ³•ï¼š\n\n#### åˆ©ç”¨ä¸€å¼ é¢„è®¾çš„æ—¥æœŸè¡¨ï¼ˆå¯åˆ›å»ºä¸€ä¸ªåŒ…å« 0~7 å¤©çš„è¾…åŠ©è¡¨ï¼‰ï¼š\n\n```sql\n-- åˆ›å»ºè¾…åŠ©è¡¨ï¼ˆå‡è®¾å·²å­˜åœ¨ï¼‰\nCREATE TEMPORARY TABLE days_table (\n    day_num INT PRIMARY KEY\n);\nINSERT INTO days_table VALUES (0),(1),(2),(3),(4),(5),(6),(7);\n```\n\nç„¶åç»“åˆå‰é¢çš„ç»“æœè¿›è¡Œå…³è”ï¼š\n\n```sql\nSELECT \n    fpt.mode_name,\n    fpt.first_play_date,\n    dt.day_num AS day_retention,\n    COUNT(DISTINCT fpt.vplayerid) AS user_count\nFROM first_play_times fpt\nJOIN days_table dt\n    ON TRUE -- è¿™é‡Œæ˜¯ä¸ºäº†è®©æ¯ä¸€å¤©éƒ½åŒ¹é…ä¸Š\nWHERE \n    dt.day_num BETWEEN 0 AND 7\n    AND DATE_ADD(fpt.first_play_date, INTERVAL dt.day_num DAY) = fpt.first_play_date\n    OR EXISTS (\n        SELECT 1\n        FROM dws_jordass_mode_roundrecord_di di\n        WHERE di.vplayerid = fpt.vplayerid\n          AND di.dtstatdate = DATE_ADD(fpt.first_play_date, INTERVAL dt.day_num DAY)\n          AND (\n              (di.submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' AND fpt.mode_name = 'å¹¿åŸŸæˆ˜åœº') OR\n              (di.modename = 'ç»„é˜Ÿç«æŠ€' AND di.submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%' AND fpt.mode_name = 'æ¶ˆç­æˆ˜') OR\n              (di.modename = 'åˆ›æ„åˆ›ä½œé—´' AND di.submodename = 'å¹»æƒ³æ··æˆ˜' AND fpt.mode_name = 'å¹»æƒ³æ··æˆ˜') OR\n              (di.modename = 'ä¼‘é—²æ¨¡å¼' AND di.submodename IN ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ ') AND fpt.mode_name = 'è’é‡ä¼ è¯´') OR\n              (di.modename = 'ä¼‘é—²æ¨¡å¼' AND di.submodename LIKE '%ç­–ç•¥è½½å…·%' AND fpt.mode_name = 'ç­–ç•¥è½½å…·') OR\n              (di.modename = 'åˆ›æ„åˆ›ä½œé—´' AND di.submodename LIKE '%ç‚å¤æ··æˆ˜%' AND fpt.mode_name = 'ç‚å¤æ··æˆ˜') OR\n              (di.modename = 'ç»„é˜Ÿç«æŠ€' AND di.submodename LIKE '%å•äººè£…å¤‡%' AND fpt.mode_name = 'å•äººè£…å¤‡') OR\n              (di.modename = 'ç»„é˜Ÿç«æŠ€' AND di.submodename LIKE '%äº¤å‰å ¡å’%' AND fpt.mode_name = 'äº¤å‰å ¡å’')\n          )\n    )\nGROUP BY fpt.mode_name, fpt.first_play_date, dt.day_num\nORDER BY fpt.mode_name, dt.day_num;\n```\n\n---\n\n## âœ… æœ€ç»ˆå®Œæ•´ SQL æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š\n\n```sql\nWITH mode_launch_dates AS (\n    SELECT \n        CASE \n            WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n            WHEN modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%' THEN 'æ¶ˆç­æˆ˜'\n            WHEN modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename = 'å¹»æƒ³æ··æˆ˜' THEN 'å¹»æƒ³æ··æˆ˜'\n            WHEN modename = 'ä¼‘é—²æ¨¡å¼' AND submodename IN ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ ') THEN 'è’é‡ä¼ è¯´'\n            WHEN modename = 'ä¼‘é—²æ¨¡å¼' AND submodename LIKE '%ç­–ç•¥è½½å…·%' THEN 'ç­–ç•¥è½½å…·'\n            WHEN modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename LIKE '%ç‚å¤æ··æˆ˜%' THEN 'ç‚å¤æ··æˆ˜'\n            WHEN modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%å•äººè£…å¤‡%' THEN 'å•äººè£…å¤‡'\n            WHEN modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%äº¤å‰å ¡å’%' THEN 'äº¤å‰å ¡å’'\n        END AS mode_name,\n        CASE \n            WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN '20240723'\n            WHEN modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%' THEN '20230804'\n            WHEN modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename = 'å¹»æƒ³æ··æˆ˜' THEN '20241115'\n            WHEN modename = 'ä¼‘é—²æ¨¡å¼' AND submodename IN ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ ') THEN '20240903'\n            WHEN modename = 'ä¼‘é—²æ¨¡å¼' AND submodename LIKE '%ç­–ç•¥è½½å…·%' THEN '20241010'\n            WHEN modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename LIKE '%ç‚å¤æ··æˆ˜%' THEN '20240625'\n            WHEN modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%å•äººè£…å¤‡%' THEN '20240517'\n            WHEN modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%äº¤å‰å ¡å’%' THEN '20240412'\n        END AS launch_date\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE \n        (submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼') OR\n        (modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%') OR\n        (modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename = 'å¹»æƒ³æ··æˆ˜') OR\n        (modename = 'ä¼‘é—²æ¨¡å¼' AND submodename IN ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ ')) OR\n        (modename = 'ä¼‘é—²æ¨¡å¼' AND submodename LIKE '%ç­–ç•¥è½½å…·%') OR\n        (modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename LIKE '%ç‚å¤æ··æˆ˜%') OR\n        (modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%å•äººè£…å¤‡%') OR\n        (modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%äº¤å‰å ¡å’%')\n    GROUP BY mode_name, launch_date\n),\nfirst_play_times AS (\n    SELECT \n        vplayerid,\n        mode_name,\n        MIN(dtstatdate) AS first_play_date\n    FROM dws_jordass_mode_roundrecord_di di\n    JOIN mode_launch_dates mld\n        ON (\n            (di.submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' AND mld.mode_name = 'å¹¿åŸŸæˆ˜åœº') OR\n            (di.modename = 'ç»„é˜Ÿç«æŠ€' AND di.submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%' AND mld.mode_name = 'æ¶ˆç­æˆ˜') OR\n            (di.modename = 'åˆ›æ„åˆ›ä½œé—´' AND di.submodename = 'å¹»æƒ³æ··æˆ˜' AND mld.mode_name = 'å¹»æƒ³æ··æˆ˜') OR\n            (di.modename = 'ä¼‘é—²æ¨¡å¼' AND di.submodename IN ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ ') AND mld.mode_name = 'è’é‡ä¼ è¯´') OR\n            (di.modename = 'ä¼‘é—²æ¨¡å¼' AND di.submodename LIKE '%ç­–ç•¥è½½å…·%' AND mld.mode_name = 'ç­–ç•¥è½½å…·') OR\n            (di.modename = 'åˆ›æ„åˆ›ä½œé—´' AND di.submodename LIKE '%ç‚å¤æ··æˆ˜%' AND mld.mode_name = 'ç‚å¤æ··æˆ˜') OR\n            (di.modename = 'ç»„é˜Ÿç«æŠ€' AND di.submodename LIKE '%å•äººè£…å¤‡%' AND mld.mode_name = 'å•äººè£…å¤‡') OR\n            (di.modename = 'ç»„é˜Ÿç«æŠ€' AND di.submodename LIKE '%äº¤å‰å ¡å’%' AND mld.mode_name = 'äº¤å‰å ¡å’')\n        )\n    GROUP BY vplayerid, mode_name\n),\ndays_table AS (\n    SELECT 0 AS day_num UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL\n    SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7\n)\nSELECT \n    fpt.mode_name,\n    fpt.first_play_date,\n    dt.day_num AS day_retention,\n    COUNT(DISTINCT fpt.vplayerid) AS user_count\nFROM first_play_times fpt\nJOIN days_table dt\n    ON TRUE\nWHERE \n    dt.day_num BETWEEN 0 AND 7\n    AND EXISTS (\n        SELECT 1\n        FROM dws_jordass_mode_roundrecord_di di\n        WHERE di.vplayerid = fpt.vplayerid\n          AND di.dtstatdate = DATE_FORMAT(DATE_ADD(STR_TO_DATE(fpt.first_play_date, '%Y%m%d'), INTERVAL dt.day_num DAY), '%Y%m%d')\n          AND (\n              (di.submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' AND fpt.mode_name = 'å¹¿åŸŸæˆ˜åœº') OR\n              (di.modename = 'ç»„é˜Ÿç«æŠ€' AND di.submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%' AND fpt.mode_name = 'æ¶ˆç­æˆ˜') OR\n              (di.modename = 'åˆ›æ„åˆ›ä½œé—´' AND di.submodename = 'å¹»æƒ³æ··æˆ˜' AND fpt.mode_name = 'å¹»æƒ³æ··æˆ˜') OR\n              (di.modename = 'ä¼‘é—²æ¨¡å¼' AND di.submodename IN ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ ') AND fpt.mode_name = 'è’é‡ä¼ è¯´') OR\n              (di.modename = 'ä¼‘é—²æ¨¡å¼' AND di.submodename LIKE '%ç­–ç•¥è½½å…·%' AND fpt.mode_name = 'ç­–ç•¥è½½å…·') OR\n              (di.modename = 'åˆ›æ„åˆ›ä½œé—´' AND di.submodename LIKE '%ç‚å¤æ··æˆ˜%' AND fpt.mode_name = 'ç‚å¤æ··æˆ˜') OR\n              (di.modename = 'ç»„é˜Ÿç«æŠ€' AND di.submodename LIKE '%å•äººè£…å¤‡%' AND fpt.mode_name = 'å•äººè£…å¤‡') OR\n              (di.modename = 'ç»„é˜Ÿç«æŠ€' AND di.submodename LIKE '%äº¤å‰å ¡å’%' AND fpt.mode_name = 'äº¤å‰å ¡å’')\n          )\n    )\nGROUP BY fpt.mode_name, fpt.first_play_date, dt.day_num\nORDER BY fpt.mode_name, dt.day_num;\n```\n\n---\n\n## ğŸ“Œ æ€»ç»“\n\nä»¥ä¸Š SQL å®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š\n\n- æ˜ å°„ä¸åŒç©æ³•ä¸å…¶ä¸Šçº¿æ—¥æœŸï¼›\n- æ‰¾å‡ºæ¯ä¸ªç©æ³•ä¸­é¦–æ¬¡å‚ä¸çš„ç”¨æˆ·ï¼›\n- è®¡ç®—ä»–ä»¬åœ¨ä¸Šçº¿åç¬¬ 0 ~ 7 å¤©æ˜¯å¦ä»ç„¶å‚ä¸ï¼›\n- è¾“å‡ºç»“æœä¸ºï¼šç©æ³•åã€é¦–æ¬¡å‚ä¸æ—¥æœŸã€ç¬¬å‡ å¤©ç•™å­˜ã€å¯¹åº”ç•™å­˜äººæ•°ã€‚\n\nå¦‚æœä½ æœ‰æ›´å¤šä¸šåŠ¡è§„åˆ™æˆ–æƒ³ä¼˜åŒ–æ€§èƒ½ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼"
},
{
  "instruction": "è¯·ä½ æ¥ä¸‹æ¥ä¸€æ­¥æ­¥æ€è€ƒï¼Œå†™å‡ºæ­£ç¡®çš„SQLæŸ¥è¯¢è¯­å¥ä»¥æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚",
  "input": "ä½ æ˜¯ä¸€åMySQLä¸“å®¶ï¼Œç°åœ¨éœ€è¦é˜…è¯»å¹¶ç†è§£ä¸‹é¢çš„ã€æ•°æ®åº“schemaã€‘æè¿°ï¼Œä»¥åŠå¯èƒ½ç”¨åˆ°çš„ã€å‚è€ƒä¿¡æ¯ã€‘ï¼Œå¹¶è¿ç”¨MySQLçŸ¥è¯†ç”Ÿæˆsqlè¯­å¥å›ç­”ã€ç”¨æˆ·é—®é¢˜ã€‘ã€‚\nã€ç”¨æˆ·é—®é¢˜ã€‘\nç»Ÿè®¡å„ä¸ªç©æ³•ä¸Šçº¿é¦–å‘¨ç•™å­˜æƒ…å†µ\nè¾“å‡ºï¼šç©æ³•ã€ä¸Šçº¿é¦–å‘¨é¦–æ¬¡ç©çš„æ—¥æœŸã€ç¬¬å‡ å¤©ç•™å­˜ï¼ˆ0,1,2...7)ã€ç©æ³•ç•™å­˜ç”¨æˆ·æ•°\n\nå„ç©æ³•é¦–å‘¨ä¸Šçº¿æ—¥æœŸï¼š\n\"å¹¿åŸŸæˆ˜åœº\": \"20240723\",\n\"æ¶ˆç­æˆ˜\": \"20230804\",\n\"å¹»æƒ³æ··æˆ˜\": \"20241115\",\n\"è’é‡ä¼ è¯´\": \"20240903\",\n\"ç­–ç•¥è½½å…·\": \"20241010\",\n\"ç‚å¤æ··æˆ˜\": \"20240625\",\n\"å•äººè£…å¤‡\": \"20240517\",\n\"äº¤å‰å ¡å’\": \"20240412\"\n\nã€æ•°æ®åº“schemaã€‘\nCREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` TEXT COMMENT 'ç»Ÿè®¡æ—¥æœŸæ ¼å¼YYYYMMDD',\n  `vgameappid` TEXT COMMENT 'è´¦å·ä½“ç³»ï¼šwx:å¾®ä¿¡ï¼Œqqï¼šæ‰‹Q',\n  `platid` BIGINT COMMENT 'ç³»ç»Ÿå¹³å°ï¼š0:IOS,1:Android',\n  `vplayerid` TEXT COMMENT 'ç©å®¶ID',\n  `mode` BIGINT COMMENT 'æ¨¡å¼ID',\n  `modename` TEXT COMMENT 'æ¨¡å¼åç§°',\n  `submode` BIGINT COMMENT 'å­æ¨¡å¼ID',\n  `submodename` TEXT COMMENT 'å­æ¨¡å¼åç§°',\n  `map` BIGINT COMMENT 'åœ°å›¾ID',\n  `mapname` TEXT COMMENT 'åœ°å›¾åç§°',\n  `seasonid` BIGINT COMMENT 'èµ›å­£ID',\n  `seasonname` TEXT COMMENT 'èµ›å­£åç§°',\n  `roundcnt` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ•°',\n  `roundtime` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ—¶é•¿(ç§’)',\n  `survivaltime` BIGINT COMMENT 'å½“æ—¥å­˜æ´»æ—¶é•¿(ç§’)',\n  `firstroundtime` TEXT COMMENT 'å½“æ—¥é¦–æ¬¡å¯¹å±€æ—¶é—´',\n  `device_type` BIGINT COMMENT 'è®¾å¤‡ç±»å‹'\n);\n\nã€å‚è€ƒä¿¡æ¯ã€‘\nè¯´æ˜ï¼š\nå¹¿åŸŸæˆ˜åœº ï¼ˆ2024/7/23ï¼‰submodename= 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'ï¼Œ\næ¶ˆç­æˆ˜ï¼ˆ2023/8/4ï¼‰ modename='ç»„é˜Ÿç«æŠ€' and submodename like '%æ¶ˆç­æˆ˜æ¨¡å¼%'ï¼Œ\nå¹»æƒ³æ··æˆ˜ï¼ˆ2024/11/15ï¼‰modename='åˆ›æ„åˆ›ä½œé—´' and submodename='å¹»æƒ³æ··æˆ˜'ï¼Œ\nè’é‡ä¼ è¯´ï¼ˆ2024-09-03ï¼‰modename='ä¼‘é—²æ¨¡å¼' and submodename in ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ ')ï¼Œ\nç­–ç•¥è½½å…·ï¼ˆ2024-10-10ï¼‰modename='ä¼‘é—²æ¨¡å¼' and submodename like '%ç­–ç•¥è½½å…·%'ï¼Œ\nç‚å¤æ··æˆ˜ï¼ˆ2024-06-25ï¼‰modename='åˆ›æ„åˆ›ä½œé—´' and submodename like '%ç‚å¤æ··æˆ˜%'ï¼Œ\nå•äººè£…å¤‡ï¼ˆ2024.5.17ï¼‰modename='ç»„é˜Ÿç«æŠ€' and submodename like '%å•äººè£…å¤‡%'ï¼Œ\näº¤å‰å ¡å’ï¼ˆ2024.4.12ï¼‰ modename='ç»„é˜Ÿç«æŠ€' and submodename like '%äº¤å‰å ¡å’%'\n\nç¬¬å‡ å¤©ç•™å­˜ï¼š0è¡¨ç¤ºå½“å¤©å‚ä¸ã€1è¡¨ç¤ºå½“å¤©å‚ä¸åœ¨ç¬¬2å¤©ä¹Ÿå‚ä¸ã€2è¡¨ç¤ºå½“å¤©å‚ä¸åœ¨ç¬¬3å¤©ä¹Ÿå‚ä¸ï¼Œä¾æ­¤ç±»æ¨\n\n",
  "chosen": "select  a.itype,\n        a.dtstatdate,\n        datediff(b.dtstatdate,a.dtstatdate) as idaynum,\n        count(distinct a.vplayerid)           as iusernum\nfrom (                      \n    select\n        itype,\n        min(dtstatdate) as dtstatdate,\n        vplayerid\n    from  (\n        select 'å¹¿åŸŸæˆ˜åœº'      as itype,\n                min(dtstatdate) as dtstatdate,\n                vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',6)\n        and submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'\n        group by vplayerid\n\n        union all\n        select 'æ¶ˆç­æˆ˜', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',6)\n        and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%æ¶ˆç­æˆ˜æ¨¡å¼%'\n        group by vplayerid\n\n        union all\n        select 'å¹»æƒ³æ··æˆ˜', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',6)\n        and modename='åˆ›æ„åˆ›ä½œé—´' and submodename='å¹»æƒ³æ··æˆ˜'\n        group by vplayerid\n\n        union all\n        select 'è’é‡ä¼ è¯´', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',6)\n        and modename='ä¼‘é—²æ¨¡å¼' and submodename in ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ ')\n        group by vplayerid\n\n        union all\n        select 'ç­–ç•¥è½½å…·', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',6)\n        and modename='ä¼‘é—²æ¨¡å¼' and submodename like '%ç­–ç•¥è½½å…·%'\n        group by vplayerid\n\n        union all\n        select 'ç‚å¤æ··æˆ˜', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',6)\n        and modename='åˆ›æ„åˆ›ä½œé—´' and submodename like '%ç‚å¤æ··æˆ˜%'\n        group by vplayerid\n\n        union all\n        select 'å•äººè£…å¤‡', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',6)\n        and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%å•äººè£…å¤‡%'\n        group by vplayerid\n\n        union all\n        select 'äº¤å‰å ¡å’', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',6)\n        and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%äº¤å‰å ¡å’%'\n        group by vplayerid\n    ) t\n    group by itype, vplayerid\n) a\nleft join (\n        select 'å¹¿åŸŸæˆ˜åœº' as itype, dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',13)\n          and submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'æ¶ˆç­æˆ˜', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',13)\n          and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%æ¶ˆç­æˆ˜æ¨¡å¼%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'å¹»æƒ³æ··æˆ˜', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',13)\n          and modename='åˆ›æ„åˆ›ä½œé—´' and submodename='å¹»æƒ³æ··æˆ˜'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'è’é‡ä¼ è¯´', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',13)\n          and modename='ä¼‘é—²æ¨¡å¼' and submodename in ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ ')\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'ç­–ç•¥è½½å…·', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',13)\n          and modename='ä¼‘é—²æ¨¡å¼' and submodename like '%ç­–ç•¥è½½å…·%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'ç‚å¤æ··æˆ˜', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',13)\n          and modename='åˆ›æ„åˆ›ä½œé—´' and submodename like '%ç‚å¤æ··æˆ˜%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'å•äººè£…å¤‡', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',13)\n          and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%å•äººè£…å¤‡%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'äº¤å‰å ¡å’', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',13)\n          and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%äº¤å‰å ¡å’%'\n        group by dtstatdate, vplayerid\n) b\n  on  a.itype      = b.itype\nand  a.vplayerid    = b.vplayerid\nwhere datediff(b.dtstatdate,a.dtstatdate) between 0 and 7\ngroup by a.itype, a.dtstatdate, datediff(b.dtstatdate,a.dtstatdate);",
  "rejected": "æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥åˆ†æå¹¶æ„å»º SQL æŸ¥è¯¢è¯­å¥ï¼Œä»¥å®ç°â€œç»Ÿè®¡å„ä¸ªç©æ³•ä¸Šçº¿é¦–å‘¨ç•™å­˜æƒ…å†µâ€çš„éœ€æ±‚ã€‚\n\n---\n\n## ğŸ” ä¸€ã€ç†è§£éœ€æ±‚\n\næˆ‘ä»¬è¦ç»Ÿè®¡çš„æ˜¯ï¼š\n\n- æ¯ä¸ªç©æ³•ï¼ˆå¦‚â€œå¹¿åŸŸæˆ˜åœºâ€ã€â€œæ¶ˆç­æˆ˜â€ç­‰ï¼‰\n- åœ¨å…¶ä¸Šçº¿é¦–æ—¥é¦–æ¬¡å‚ä¸æ¸¸æˆçš„ç”¨æˆ·\n- è¿™äº›ç”¨æˆ·çš„**ç•™å­˜æƒ…å†µ**ï¼šä»ç¬¬0å¤©ï¼ˆå½“å¤©ï¼‰åˆ°ç¬¬7å¤©ï¼ˆå³é¦–å‘¨å†…ï¼‰ï¼Œæ¯å¤©æœ‰å¤šå°‘äººç»§ç»­å‚ä¸äº†æ¸¸æˆ\n- è¾“å‡ºå­—æ®µåŒ…æ‹¬ï¼š\n  - ç©æ³•åç§°ï¼ˆmodename + submodename ç»„åˆï¼‰\n  - é¦–æ¬¡å‚ä¸æ—¥æœŸï¼ˆä¸Šçº¿é¦–æ—¥ï¼‰\n  - ç¬¬å‡ å¤©ç•™å­˜ï¼ˆ0~7ï¼‰\n  - ç•™å­˜ç”¨æˆ·æ•°\n\n---\n\n## ğŸ§  äºŒã€å…³é”®ç‚¹è§£æ\n\n### âœ… 1. å„ç©æ³•ä¸Šçº¿é¦–æ—¥\n\n| ç©æ³•åç§° | ä¸Šçº¿æ—¥æœŸ |\n|----------|-----------|\n| å¹¿åŸŸæˆ˜åœº | 20240723 |\n| æ¶ˆç­æˆ˜   | 20230804 |\n| å¹»æƒ³æ··æˆ˜ | 20241115 |\n| è’é‡ä¼ è¯´ | 20240903 |\n| ç­–ç•¥è½½å…· | 20241010 |\n| ç‚å¤æ··æˆ˜ | 20240625 |\n| å•äººè£…å¤‡ | 20240517 |\n| äº¤å‰å ¡å’ | 20240412 |\n\næˆ‘ä»¬éœ€è¦æ ¹æ®è¿™äº›ä¸Šçº¿æ—¥æœŸç­›é€‰å‡ºæ¯ä¸ªç©æ³•é¦–æ¬¡å‚ä¸çš„ç”¨æˆ·ï¼Œå¹¶è®¡ç®—ä»–ä»¬ä¹‹åæ¯å¤©æ˜¯å¦è¿˜å‚ä¸äº†æ¸¸æˆã€‚\n\n---\n\n### âœ… 2. æ•°æ®è¡¨ç»“æ„è¯´æ˜\n\n```sql\nCREATE TABLE dws_jordass_mode_roundrecord_di (\n  dtstatdate TEXT,\n  vplayerid TEXT,\n  modename TEXT,\n  submodename TEXT,\n  ...\n);\n```\n\nå…¶ä¸­ï¼š\n- `dtstatdate`: ç»Ÿè®¡æ—¥æœŸï¼ˆæ ¼å¼ä¸º YYYYMMDDï¼‰\n- `vplayerid`: ç”¨æˆ· ID\n- `modename`, `submodename`: è¡¨ç¤ºç©æ³•ç±»å‹\n- æˆ‘ä»¬éœ€è¦é€šè¿‡ `modename` å’Œ `submodename` åŒ¹é…ä¸åŒç©æ³•\n\n---\n\n### âœ… 3. å¦‚ä½•åˆ¤æ–­â€œé¦–æ¬¡å‚ä¸â€ï¼Ÿ\n\næˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ¤æ–­æŸç”¨æˆ·æ˜¯å¦æ˜¯è¯¥ç©æ³•çš„â€œé¦–æ—¥å‚ä¸è€…â€ï¼š\n\n- å¯¹äºæŸä¸ªç©æ³•ï¼Œæ‰¾å‡ºå®ƒçš„ä¸Šçº¿æ—¥æœŸï¼ˆæ¯”å¦‚ 20240723ï¼‰\n- æ‰¾å‡ºæ‰€æœ‰åœ¨è¯¥æ—¥æœŸé¦–æ¬¡å‚ä¸è¯¥æ¸¸æˆçš„ç”¨æˆ·ï¼ˆå³ä»–ä»¬åœ¨è¯¥æ—¥æœŸç¬¬ä¸€æ¬¡è¿›å…¥è¯¥ç©æ³•ï¼‰\n\n---\n\n### âœ… 4. å¦‚ä½•è®¡ç®—ç•™å­˜ï¼Ÿ\n\n- å¯¹äºæ¯ä¸ªç”¨æˆ·é¦–æ¬¡å‚ä¸çš„é‚£å¤©ä½œä¸ºåŸºå‡†æ—¥ï¼ˆday 0ï¼‰\n- ç„¶åæŸ¥çœ‹ä»–ä»¬åœ¨æ¥ä¸‹æ¥çš„ 7 å¤©ä¸­æ˜¯å¦è¿˜åœ¨è¯¥ç©æ³•ä¸­å‡ºç°è¿‡\n- æ¯”å¦‚ï¼š\n  - å¦‚æœç”¨æˆ·åœ¨ 20240723 å‚ä¸äº†ä¸€æ¬¡ï¼Œé‚£ä¹ˆç¬¬äºŒå¤©ï¼ˆ20240724ï¼‰è¿˜æœ‰è®°å½• â†’ ç•™å­˜ç¬¬1å¤©ï¼ˆday 1ï¼‰\n  - ç¬¬ä¸‰å¤©ä¹Ÿæœ‰è®°å½• â†’ day 2\n  - ä»¥æ­¤ç±»æ¨\n\n---\n\n## ğŸ› ï¸ ä¸‰ã€å®ç°æ­¥éª¤\n\n### Step 1ï¼šå®šä¹‰å„ç©æ³•åŠå…¶ä¸Šçº¿æ—¥æœŸ\n\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªä¸´æ—¶è¡¨æˆ– CTE æ¥å­˜å‚¨ç©æ³•ä¸ä¸Šçº¿æ—¥æœŸçš„æ˜ å°„å…³ç³»ã€‚\n\n```sql\nWITH mode_launch_dates AS (\n  SELECT 'å¹¿åŸŸæˆ˜åœº' AS mode_name, '20240723' AS launch_date\n  UNION ALL\n  SELECT 'æ¶ˆç­æˆ˜', '20230804'\n  UNION ALL\n  SELECT 'å¹»æƒ³æ··æˆ˜', '20241115'\n  UNION ALL\n  SELECT 'è’é‡ä¼ è¯´', '20240903'\n  UNION ALL\n  SELECT 'ç­–ç•¥è½½å…·', '20241010'\n  UNION ALL\n  SELECT 'ç‚å¤æ··æˆ˜', '20240625'\n  UNION ALL\n  SELECT 'å•äººè£…å¤‡', '20240517'\n  UNION ALL\n  SELECT 'äº¤å‰å ¡å’', '20240412'\n),\n```\n\n---\n\n### Step 2ï¼šç¡®å®šæ¯ä¸ªç©æ³•å¯¹åº”çš„ modename å’Œ submodename\n\næˆ‘ä»¬æ ¹æ®é¢˜ç›®ä¸­çš„è§„åˆ™æ„é€ æ¡ä»¶ï¼š\n\n```sql\nmode_filter AS (\n  SELECT \n    mode_name,\n    CASE \n      WHEN mode_name = 'å¹¿åŸŸæˆ˜åœº' THEN 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'\n      WHEN mode_name = 'æ¶ˆç­æˆ˜' THEN '%æ¶ˆç­æˆ˜æ¨¡å¼%'\n      WHEN mode_name = 'å¹»æƒ³æ··æˆ˜' THEN 'å¹»æƒ³æ··æˆ˜'\n      WHEN mode_name IN ('è’é‡ä¼ è¯´') THEN 'è’é‡ä¼ è¯´'\n      WHEN mode_name = 'ç­–ç•¥è½½å…·' THEN '%ç­–ç•¥è½½å…·%'\n      WHEN mode_name = 'ç‚å¤æ··æˆ˜' THEN '%ç‚å¤æ··æˆ˜%'\n      WHEN mode_name = 'å•äººè£…å¤‡' THEN '%å•äººè£…å¤‡%'\n      WHEN mode_name = 'äº¤å‰å ¡å’' THEN '%äº¤å‰å ¡å’%'\n    END AS submode_like_pattern,\n\n    CASE \n      WHEN mode_name IN ('å¹¿åŸŸæˆ˜åœº', 'å¹»æƒ³æ··æˆ˜', 'ç‚å¤æ··æˆ˜') THEN 'åˆ›æ„åˆ›ä½œé—´'\n      WHEN mode_name IN ('æ¶ˆç­æˆ˜', 'å•äººè£…å¤‡', 'äº¤å‰å ¡å’') THEN 'ç»„é˜Ÿç«æŠ€'\n      WHEN mode_name IN ('è’é‡ä¼ è¯´', 'ç­–ç•¥è½½å…·') THEN 'ä¼‘é—²æ¨¡å¼'\n    END AS modename_pattern,\n\n    launch_date\n  FROM mode_launch_dates\n)\n```\n\n---\n\n### Step 3ï¼šè·å–æ¯ä¸ªç©æ³•ä¸Šçº¿é¦–æ—¥é¦–æ¬¡å‚ä¸çš„ç”¨æˆ·\n\n```sql\nfirst_players AS (\n  SELECT DISTINCT\n    f.mode_name,\n    r.vplayerid,\n    r.dtstatdate AS first_play_date\n  FROM mode_filter f\n  JOIN dws_jordass_mode_roundrecord_di r\n    ON r.modename = f.modename_pattern\n    AND r.submodename LIKE f.submode_like_pattern\n    AND r.dtstatdate = f.launch_date\n)\n```\n\n> æ³¨æ„ï¼šè¿™é‡Œåªå–äº†ä¸Šçº¿å½“å¤©é¦–æ¬¡å‚ä¸çš„ç”¨æˆ·ï¼Œä¹Ÿå°±æ˜¯ `dtstatdate = launch_date` çš„è®°å½•ã€‚\n\n---\n\n### Step 4ï¼šè·å–è¿™äº›ç”¨æˆ·åœ¨ä¹‹åä¸ƒå¤©å†…çš„æ´»è·ƒæƒ…å†µ\n\næˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸ªç”¨æˆ·ï¼Œåœ¨å…¶é¦–æ¬¡å‚ä¸åçš„ 0~7 å¤©å†…æ˜¯å¦è¿˜æœ‰è®°å½•è¿›è¡Œç»Ÿè®¡ã€‚\n\n#### æ„é€ ä¸€ä¸ªåŒ…å« 0~7 çš„å¤©æ•°åˆ—è¡¨ï¼š\n\n```sql\ndays_range AS (\n  SELECT 0 AS day_diff\n  UNION ALL SELECT 1\n  UNION ALL SELECT 2\n  UNION ALL SELECT 3\n  UNION ALL SELECT 4\n  UNION ALL SELECT 5\n  UNION ALL SELECT 6\n  UNION ALL SELECT 7\n)\n```\n\nç„¶åå°†æ¯ä¸ªç”¨æˆ·çš„é¦–æ¬¡å‚ä¸æ—¥æœŸåŠ ä¸Šä¸åŒçš„ day_diff å¾—åˆ°åç»­æ—¥æœŸï¼Œå†æ£€æŸ¥è¯¥æ—¥æœŸæ˜¯å¦æœ‰è¯¥ç”¨æˆ·çš„æ¸¸æˆè®°å½•ã€‚\n\n---\n\n### Step 5ï¼šæœ€ç»ˆç»Ÿè®¡ç•™å­˜äººæ•°\n\n```sql\nfinal_result AS (\n  SELECT \n    fp.mode_name,\n    fp.first_play_date,\n    dr.day_diff,\n    COUNT(DISTINCT fp.vplayerid) AS retained_users\n  FROM first_players fp\n  CROSS JOIN days_range dr\n  LEFT JOIN dws_jordass_mode_roundrecord_di r\n    ON r.vplayerid = fp.vplayerid\n    AND r.dtstatdate = DATE_FORMAT(\n        DATE_ADD(STR_TO_DATE(fp.first_play_date, '%Y%m%d'), INTERVAL dr.day_diff DAY),\n        '%Y%m%d'\n      )\n    AND r.modename = (\n      SELECT modename_pattern FROM mode_filter WHERE mode_name = fp.mode_name\n    )\n    AND r.submodename LIKE (\n      SELECT submode_like_pattern FROM mode_filter WHERE mode_name = fp.mode_name\n    )\n  GROUP BY fp.mode_name, fp.first_play_date, dr.day_diff\n)\n```\n\n---\n\n## ğŸ“Œ å››ã€å®Œæ•´ SQL æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š\n\n```sql\nWITH mode_launch_dates AS (\n  SELECT 'å¹¿åŸŸæˆ˜åœº' AS mode_name, '20240723' AS launch_date\n  UNION ALL\n  SELECT 'æ¶ˆç­æˆ˜', '20230804'\n  UNION ALL\n  SELECT 'å¹»æƒ³æ··æˆ˜', '20241115'\n  UNION ALL\n  SELECT 'è’é‡ä¼ è¯´', '20240903'\n  UNION ALL\n  SELECT 'ç­–ç•¥è½½å…·', '20241010'\n  UNION ALL\n  SELECT 'ç‚å¤æ··æˆ˜', '20240625'\n  UNION ALL\n  SELECT 'å•äººè£…å¤‡', '20240517'\n  UNION ALL\n  SELECT 'äº¤å‰å ¡å’', '20240412'\n),\n\nmode_filter AS (\n  SELECT \n    mode_name,\n    CASE \n      WHEN mode_name = 'å¹¿åŸŸæˆ˜åœº' THEN 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'\n      WHEN mode_name = 'æ¶ˆç­æˆ˜' THEN '%æ¶ˆç­æˆ˜æ¨¡å¼%'\n      WHEN mode_name = 'å¹»æƒ³æ··æˆ˜' THEN 'å¹»æƒ³æ··æˆ˜'\n      WHEN mode_name IN ('è’é‡ä¼ è¯´') THEN 'è’é‡ä¼ è¯´'\n      WHEN mode_name = 'ç­–ç•¥è½½å…·' THEN '%ç­–ç•¥è½½å…·%'\n      WHEN mode_name = 'ç‚å¤æ··æˆ˜' THEN '%ç‚å¤æ··æˆ˜%'\n      WHEN mode_name = 'å•äººè£…å¤‡' THEN '%å•äººè£…å¤‡%'\n      WHEN mode_name = 'äº¤å‰å ¡å’' THEN '%äº¤å‰å ¡å’%'\n    END AS submode_like_pattern,\n\n    CASE \n      WHEN mode_name IN ('å¹¿åŸŸæˆ˜åœº', 'å¹»æƒ³æ··æˆ˜', 'ç‚å¤æ··æˆ˜') THEN 'åˆ›æ„åˆ›ä½œé—´'\n      WHEN mode_name IN ('æ¶ˆç­æˆ˜', 'å•äººè£…å¤‡', 'äº¤å‰å ¡å’') THEN 'ç»„é˜Ÿç«æŠ€'\n      WHEN mode_name IN ('è’é‡ä¼ è¯´', 'ç­–ç•¥è½½å…·') THEN 'ä¼‘é—²æ¨¡å¼'\n    END AS modename_pattern,\n\n    launch_date\n  FROM mode_launch_dates\n),\n\nfirst_players AS (\n  SELECT DISTINCT\n    f.mode_name,\n    r.vplayerid,\n    r.dtstatdate AS first_play_date\n  FROM mode_filter f\n  JOIN dws_jordass_mode_roundrecord_di r\n    ON r.modename = f.modename_pattern\n    AND r.submodename LIKE f.submode_like_pattern\n    AND r.dtstatdate = f.launch_date\n),\n\ndays_range AS (\n  SELECT 0 AS day_diff\n  UNION ALL SELECT 1\n  UNION ALL SELECT 2\n  UNION ALL SELECT 3\n  UNION ALL SELECT 4\n  UNION ALL SELECT 5\n  UNION ALL SELECT 6\n  UNION ALL SELECT 7\n),\n\nfinal_result AS (\n  SELECT \n    fp.mode_name,\n    fp.first_play_date,\n    dr.day_diff,\n    COUNT(DISTINCT fp.vplayerid) AS retained_users\n  FROM first_players fp\n  CROSS JOIN days_range dr\n  LEFT JOIN dws_jordass_mode_roundrecord_di r\n    ON r.vplayerid = fp.vplayerid\n    AND r.dtstatdate = DATE_FORMAT(\n        DATE_ADD(STR_TO_DATE(fp.first_play_date, '%Y%m%d'), INTERVAL dr.day_diff DAY),\n        '%Y%m%d'\n      )\n    AND r.modename = (\n      SELECT modename_pattern FROM mode_filter WHERE mode_name = fp.mode_name\n    )\n    AND r.submodename LIKE (\n      SELECT submode_like_pattern FROM mode_filter WHERE mode_name = fp.mode_name\n    )\n  GROUP BY fp.mode_name, fp.first_play_date, dr.day_diff\n)\n\nSELECT \n  mode_name AS ç©æ³•,\n  first_play_date AS ä¸Šçº¿é¦–å‘¨é¦–æ¬¡ç©çš„æ—¥æœŸ,\n  day_diff AS ç¬¬å‡ å¤©ç•™å­˜,\n  retained_users AS ç©æ³•ç•™å­˜ç”¨æˆ·æ•°\nFROM final_result\nORDER BY mode_name, day_diff;\n```\n\n---\n\n## âœ… äº”ã€è¾“å‡ºæ ·ä¾‹ï¼ˆç¤ºæ„ï¼‰\n\n| ç©æ³•       | ä¸Šçº¿é¦–å‘¨é¦–æ¬¡ç©çš„æ—¥æœŸ | ç¬¬å‡ å¤©ç•™å­˜ | ç©æ³•ç•™å­˜ç”¨æˆ·æ•° |\n|------------|-----------------------|-------------|----------------|\n| å¹¿åŸŸæˆ˜åœº   | 20240723              | 0           | 1200           |\n| å¹¿åŸŸæˆ˜åœº   | 20240723              | 1           | 900            |\n| å¹¿åŸŸæˆ˜åœº   | 20240723              | 2           | 700            |\n| ...        | ...                   | ...         | ...            |\n\n---\n\nå¦‚æœ‰æ›´å¤šæ•°æ®é‡æˆ–æ€§èƒ½ä¼˜åŒ–éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘æ·»åŠ ç´¢å¼•ã€åˆ†è¡¨ã€åˆ†åŒºç­‰æ‰‹æ®µã€‚æ¬¢è¿ç»§ç»­æé—®ï¼"
},
{
  "instruction": "è¯·ä½ æ¥ä¸‹æ¥ä¸€æ­¥æ­¥æ€è€ƒï¼Œå†™å‡ºæ­£ç¡®çš„SQLæŸ¥è¯¢è¯­å¥ä»¥æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚",
  "input": "ä½ æ˜¯ä¸€åMySQLä¸“å®¶ï¼Œç°åœ¨éœ€è¦é˜…è¯»å¹¶ç†è§£ä¸‹é¢çš„ã€æ•°æ®åº“schemaã€‘æè¿°ï¼Œä»¥åŠå¯èƒ½ç”¨åˆ°çš„ã€å‚è€ƒä¿¡æ¯ã€‘ï¼Œå¹¶è¿ç”¨MySQLçŸ¥è¯†ç”Ÿæˆsqlè¯­å¥å›ç­”ã€ç”¨æˆ·é—®é¢˜ã€‘ã€‚\nã€ç”¨æˆ·é—®é¢˜ã€‘\nç»Ÿè®¡å„ä¸ªç©æ³•ä¸Šçº¿é¦–å‘¨ç•™å­˜æƒ…å†µ\nè¾“å‡ºï¼šç©æ³•ã€ä¸Šçº¿é¦–å‘¨é¦–æ¬¡ç©çš„æ—¥æœŸã€ç¬¬å‡ å¤©ç•™å­˜ï¼ˆ0,1,2...7)ã€ç©æ³•ç•™å­˜ç”¨æˆ·æ•°\n\nå„ç©æ³•é¦–å‘¨ä¸Šçº¿æ—¥æœŸï¼š\n\"å¹¿åŸŸæˆ˜åœº\": \"20240723\",\n\"æ¶ˆç­æˆ˜\": \"20230804\",\n\"å¹»æƒ³æ··æˆ˜\": \"20241115\",\n\"è’é‡ä¼ è¯´\": \"20240903\",\n\"ç­–ç•¥è½½å…·\": \"20241010\",\n\"ç‚å¤æ··æˆ˜\": \"20240625\",\n\"å•äººè£…å¤‡\": \"20240517\",\n\"äº¤å‰å ¡å’\": \"20240412\"\n\nã€æ•°æ®åº“schemaã€‘\nCREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` TEXT COMMENT 'ç»Ÿè®¡æ—¥æœŸæ ¼å¼YYYYMMDD',\n  `vgameappid` TEXT COMMENT 'è´¦å·ä½“ç³»ï¼šwx:å¾®ä¿¡ï¼Œqqï¼šæ‰‹Q',\n  `platid` BIGINT COMMENT 'ç³»ç»Ÿå¹³å°ï¼š0:IOS,1:Android',\n  `vplayerid` TEXT COMMENT 'ç©å®¶ID',\n  `mode` BIGINT COMMENT 'æ¨¡å¼ID',\n  `modename` TEXT COMMENT 'æ¨¡å¼åç§°',\n  `submode` BIGINT COMMENT 'å­æ¨¡å¼ID',\n  `submodename` TEXT COMMENT 'å­æ¨¡å¼åç§°',\n  `map` BIGINT COMMENT 'åœ°å›¾ID',\n  `mapname` TEXT COMMENT 'åœ°å›¾åç§°',\n  `seasonid` BIGINT COMMENT 'èµ›å­£ID',\n  `seasonname` TEXT COMMENT 'èµ›å­£åç§°',\n  `roundcnt` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ•°',\n  `roundtime` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ—¶é•¿(ç§’)',\n  `survivaltime` BIGINT COMMENT 'å½“æ—¥å­˜æ´»æ—¶é•¿(ç§’)',\n  `firstroundtime` TEXT COMMENT 'å½“æ—¥é¦–æ¬¡å¯¹å±€æ—¶é—´',\n  `device_type` BIGINT COMMENT 'è®¾å¤‡ç±»å‹'\n);\n\nã€å‚è€ƒä¿¡æ¯ã€‘\nè¯´æ˜ï¼š\nå¹¿åŸŸæˆ˜åœº ï¼ˆ2024/7/23ï¼‰submodename= 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'ï¼Œ\næ¶ˆç­æˆ˜ï¼ˆ2023/8/4ï¼‰ modename='ç»„é˜Ÿç«æŠ€' and submodename like '%æ¶ˆç­æˆ˜æ¨¡å¼%'ï¼Œ\nå¹»æƒ³æ··æˆ˜ï¼ˆ2024/11/15ï¼‰modename='åˆ›æ„åˆ›ä½œé—´' and submodename='å¹»æƒ³æ··æˆ˜'ï¼Œ\nè’é‡ä¼ è¯´ï¼ˆ2024-09-03ï¼‰modename='ä¼‘é—²æ¨¡å¼' and submodename in ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ ')ï¼Œ\nç­–ç•¥è½½å…·ï¼ˆ2024-10-10ï¼‰modename='ä¼‘é—²æ¨¡å¼' and submodename like '%ç­–ç•¥è½½å…·%'ï¼Œ\nç‚å¤æ··æˆ˜ï¼ˆ2024-06-25ï¼‰modename='åˆ›æ„åˆ›ä½œé—´' and submodename like '%ç‚å¤æ··æˆ˜%'ï¼Œ\nå•äººè£…å¤‡ï¼ˆ2024.5.17ï¼‰modename='ç»„é˜Ÿç«æŠ€' and submodename like '%å•äººè£…å¤‡%'ï¼Œ\näº¤å‰å ¡å’ï¼ˆ2024.4.12ï¼‰ modename='ç»„é˜Ÿç«æŠ€' and submodename like '%äº¤å‰å ¡å’%'\n\nç¬¬å‡ å¤©ç•™å­˜ï¼š0è¡¨ç¤ºå½“å¤©å‚ä¸ã€1è¡¨ç¤ºå½“å¤©å‚ä¸åœ¨ç¬¬2å¤©ä¹Ÿå‚ä¸ã€2è¡¨ç¤ºå½“å¤©å‚ä¸åœ¨ç¬¬3å¤©ä¹Ÿå‚ä¸ï¼Œä¾æ­¤ç±»æ¨\n\n",
  "chosen": "select  a.itype,\n        a.dtstatdate,\n        datediff(b.dtstatdate,a.dtstatdate) as idaynum,\n        count(distinct a.vplayerid)           as iusernum\nfrom (                      \n    select\n        itype,\n        min(dtstatdate) as dtstatdate,\n        vplayerid\n    from  (\n        select 'å¹¿åŸŸæˆ˜åœº'      as itype,\n                min(dtstatdate) as dtstatdate,\n                vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',6)\n        and submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'\n        group by vplayerid\n\n        union all\n        select 'æ¶ˆç­æˆ˜', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',6)\n        and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%æ¶ˆç­æˆ˜æ¨¡å¼%'\n        group by vplayerid\n\n        union all\n        select 'å¹»æƒ³æ··æˆ˜', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',6)\n        and modename='åˆ›æ„åˆ›ä½œé—´' and submodename='å¹»æƒ³æ··æˆ˜'\n        group by vplayerid\n\n        union all\n        select 'è’é‡ä¼ è¯´', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',6)\n        and modename='ä¼‘é—²æ¨¡å¼' and submodename in ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ ')\n        group by vplayerid\n\n        union all\n        select 'ç­–ç•¥è½½å…·', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',6)\n        and modename='ä¼‘é—²æ¨¡å¼' and submodename like '%ç­–ç•¥è½½å…·%'\n        group by vplayerid\n\n        union all\n        select 'ç‚å¤æ··æˆ˜', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',6)\n        and modename='åˆ›æ„åˆ›ä½œé—´' and submodename like '%ç‚å¤æ··æˆ˜%'\n        group by vplayerid\n\n        union all\n        select 'å•äººè£…å¤‡', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',6)\n        and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%å•äººè£…å¤‡%'\n        group by vplayerid\n\n        union all\n        select 'äº¤å‰å ¡å’', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',6)\n        and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%äº¤å‰å ¡å’%'\n        group by vplayerid\n    ) t\n    group by itype, vplayerid\n) a\nleft join (\n        select 'å¹¿åŸŸæˆ˜åœº' as itype, dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',13)\n          and submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'æ¶ˆç­æˆ˜', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',13)\n          and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%æ¶ˆç­æˆ˜æ¨¡å¼%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'å¹»æƒ³æ··æˆ˜', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',13)\n          and modename='åˆ›æ„åˆ›ä½œé—´' and submodename='å¹»æƒ³æ··æˆ˜'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'è’é‡ä¼ è¯´', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',13)\n          and modename='ä¼‘é—²æ¨¡å¼' and submodename in ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ ')\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'ç­–ç•¥è½½å…·', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',13)\n          and modename='ä¼‘é—²æ¨¡å¼' and submodename like '%ç­–ç•¥è½½å…·%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'ç‚å¤æ··æˆ˜', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',13)\n          and modename='åˆ›æ„åˆ›ä½œé—´' and submodename like '%ç‚å¤æ··æˆ˜%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'å•äººè£…å¤‡', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',13)\n          and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%å•äººè£…å¤‡%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'äº¤å‰å ¡å’', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',13)\n          and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%äº¤å‰å ¡å’%'\n        group by dtstatdate, vplayerid\n) b\n  on  a.itype      = b.itype\nand  a.vplayerid    = b.vplayerid\nwhere datediff(b.dtstatdate,a.dtstatdate) between 0 and 7\ngroup by a.itype, a.dtstatdate, datediff(b.dtstatdate,a.dtstatdate);",
  "rejected": "ä¸ºäº†æ»¡è¶³ç”¨æˆ·éœ€æ±‚ï¼š**ç»Ÿè®¡å„ä¸ªç©æ³•ä¸Šçº¿é¦–å‘¨ç•™å­˜æƒ…å†µ**ï¼Œæˆ‘ä»¬éœ€è¦åˆ†æ­¥éª¤è¿›è¡Œåˆ†æå’Œæ„å»º SQL æŸ¥è¯¢ã€‚\n\n---\n\n## âœ… ä¸€ã€æ˜ç¡®ç›®æ ‡\n\næˆ‘ä»¬è¦è¾“å‡ºä»¥ä¸‹å­—æ®µï¼š\n\n| å­—æ®µå | å«ä¹‰ |\n|--------|------|\n| ç©æ³• | æ¨¡å¼åç§°ï¼ˆå¦‚â€œå¹¿åŸŸæˆ˜åœºâ€ç­‰ï¼‰ |\n| ä¸Šçº¿é¦–å‘¨é¦–æ¬¡ç©çš„æ—¥æœŸ | å¯¹åº”ç©æ³•çš„ä¸Šçº¿æ—¥æœŸ |\n| ç¬¬å‡ å¤©ç•™å­˜ | ä»0å¼€å§‹ï¼Œè¡¨ç¤ºå½“å¤©å‚ä¸ã€ç¬¬1å¤©å‚ä¸ã€ç¬¬2å¤©å‚ä¸â€¦â€¦ |\n| ç©æ³•ç•™å­˜ç”¨æˆ·æ•° | åœ¨è¯¥ç•™å­˜å¤©æ•°ä¸‹çš„æ´»è·ƒç”¨æˆ·æ•°é‡ |\n\n---\n\n## âœ… äºŒã€ç†è§£æ•°æ®ç»“æ„ä¸é€»è¾‘\n\n### 1. æ•°æ®è¡¨\næˆ‘ä»¬ä½¿ç”¨çš„æ˜¯è¡¨ï¼š\n```sql\ndws_jordass_mode_roundrecord_di\n```\n\n### 2. ç©æ³•å¯¹åº”å…³ç³»ï¼ˆæ ¹æ®é¢˜ç›®ä¸­ç»™å‡ºçš„ä¿¡æ¯ï¼‰\n| ç©æ³•       | æ¡ä»¶è¡¨è¾¾å¼ |\n|------------|-------------|\n| å¹¿åŸŸæˆ˜åœº   | submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' |\n| æ¶ˆç­æˆ˜     | modename='ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%' |\n| å¹»æƒ³æ··æˆ˜   | modename='åˆ›æ„åˆ›ä½œé—´' AND submodename='å¹»æƒ³æ··æˆ˜' |\n| è’é‡ä¼ è¯´   | modename='ä¼‘é—²æ¨¡å¼' AND submodename IN ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ ') |\n| ç­–ç•¥è½½å…·   | modename='ä¼‘é—²æ¨¡å¼' AND submodename LIKE '%ç­–ç•¥è½½å…·%' |\n| ç‚å¤æ··æˆ˜   | modename='åˆ›æ„åˆ›ä½œé—´' AND submodename LIKE '%ç‚å¤æ··æˆ˜%' |\n| å•äººè£…å¤‡   | modename='ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%å•äººè£…å¤‡%' |\n| äº¤å‰å ¡å’   | modename='ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%äº¤å‰å ¡å’%' |\n\n### 3. é¦–æ¬¡å‚ä¸æ—¶é—´åˆ¤æ–­\n- æˆ‘ä»¬éœ€è¦æ‰¾å‡ºæ¯ä¸ªç©å®¶åœ¨æŸç©æ³•ä¸‹**ç¬¬ä¸€æ¬¡å‚ä¸çš„æ—¶é—´**\n- ç„¶åè®¡ç®—è¿™ä¸ªç©å®¶ä¹‹åæ¯å¤©æ˜¯å¦ç»§ç»­å‚ä¸æ¸¸æˆ\n- ç”¨ `firstroundtime` å¯èƒ½æ˜¯é¦–æ¬¡å¯¹å±€æ—¶é—´ï¼ˆæ³¨æ„æ ¼å¼ï¼‰\n\n> æ³¨æ„ï¼š`firstroundtime` æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ ¼å¼ä¸º `\"YYYY-MM-DD HH:MM:SS\"`ï¼Œæ‰€ä»¥è¦è½¬æˆæ—¥æœŸç”¨äºæ¯”è¾ƒã€‚\n\n---\n\n## âœ… ä¸‰ã€è®¾è®¡æ€è·¯\n\n### Step 1: è·å–æ¯ç§ç©æ³•å¯¹åº”çš„ä¸Šçº¿æ—¥æœŸï¼Œå¹¶æ ‡è®°å…¶é¦–æ¬¡å‚ä¸çš„ç”¨æˆ·åŠæ—¥æœŸ\n\næˆ‘ä»¬å¯ä»¥å…ˆå°†æ¯ç§ç©æ³•çš„è§„åˆ™æ˜ å°„ä¸ºä¸€ä¸ªå­æŸ¥è¯¢ï¼Œè·å–è¯¥ç©æ³•çš„æ‰€æœ‰é¦–æ¬¡å‚ä¸è®°å½•ï¼ˆå³æ¯ä¸ªç”¨æˆ·çš„é¦–æ¬¡å¯¹å±€æ—¶é—´ï¼‰ã€‚\n\n### Step 2: è®¡ç®—ç•™å­˜å¤©æ•°ï¼ˆ0~7ï¼‰\n\n- å‡è®¾æŸç”¨æˆ·åœ¨æŸæ—¥é¦–æ¬¡å‚ä¸æŸç©æ³•ï¼Œåˆ™ä»–å½“å¤©ä¸ºç¬¬0å¤©ï¼›\n- è‹¥ä»–åœ¨ç¬¬äºŒå¤©ä¹Ÿå‚ä¸äº†ï¼Œåˆ™ç¬¬1å¤©ç•™å­˜äººæ•°+1ï¼›\n- å¦‚æ­¤é€’æ¨è‡³ç¬¬7å¤©ã€‚\n\n### Step 3: ä½¿ç”¨çª—å£å‡½æ•°æˆ–è‡ªè¿æ¥æ–¹å¼ç»Ÿè®¡æ¯å¤©çš„ç•™å­˜äººæ•°\n\n---\n\n## âœ… å››ã€ç¼–å†™ SQL æŸ¥è¯¢è¯­å¥\n\næˆ‘ä»¬å°†æŒ‰å¦‚ä¸‹ç»“æ„æ¥å†™ SQLï¼š\n\n1. **ç¬¬ä¸€æ­¥ï¼šå®šä¹‰å„ç©æ³•åŠå…¶ä¸Šçº¿æ—¥æœŸ**\n2. **ç¬¬äºŒæ­¥ï¼šæå–æ¯ä¸ªç©æ³•ä¸‹ç”¨æˆ·çš„é¦–æ¬¡å‚ä¸æ—¶é—´**\n3. **ç¬¬ä¸‰æ­¥ï¼šè®¡ç®—æ¯ä¸ªç”¨æˆ·åœ¨åç»­æ¯ä¸€å¤©æ˜¯å¦è¿˜å‚ä¸**\n4. **ç¬¬å››æ­¥ï¼šæ±‡æ€»æ¯æ—¥ç•™å­˜äººæ•°**\n\n---\n\n### ğŸ”§ æœ€ç»ˆ SQL æŸ¥è¯¢å¦‚ä¸‹ï¼š\n\n```sql\nWITH mode_launch_dates AS (\n    SELECT 'å¹¿åŸŸæˆ˜åœº' AS mode_name, '20240723' AS launch_date\n    UNION ALL\n    SELECT 'æ¶ˆç­æˆ˜', '20230804'\n    UNION ALL\n    SELECT 'å¹»æƒ³æ··æˆ˜', '20241115'\n    UNION ALL\n    SELECT 'è’é‡ä¼ è¯´', '20240903'\n    UNION ALL\n    SELECT 'ç­–ç•¥è½½å…·', '20241010'\n    UNION ALL\n    SELECT 'ç‚å¤æ··æˆ˜', '20240625'\n    UNION ALL\n    SELECT 'å•äººè£…å¤‡', '20240517'\n    UNION ALL\n    SELECT 'äº¤å‰å ¡å’', '20240412'\n),\nfirst_play_dates AS (\n    SELECT \n        CASE\n            WHEN d.submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n            WHEN d.modename = 'ç»„é˜Ÿç«æŠ€' AND d.submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%' THEN 'æ¶ˆç­æˆ˜'\n            WHEN d.modename = 'åˆ›æ„åˆ›ä½œé—´' AND d.submodename = 'å¹»æƒ³æ··æˆ˜' THEN 'å¹»æƒ³æ··æˆ˜'\n            WHEN d.modename = 'ä¼‘é—²æ¨¡å¼' AND d.submodename IN ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ ') THEN 'è’é‡ä¼ è¯´'\n            WHEN d.modename = 'ä¼‘é—²æ¨¡å¼' AND d.submodename LIKE '%ç­–ç•¥è½½å…·%' THEN 'ç­–ç•¥è½½å…·'\n            WHEN d.modename = 'åˆ›æ„åˆ›ä½œé—´' AND d.submodename LIKE '%ç‚å¤æ··æˆ˜%' THEN 'ç‚å¤æ··æˆ˜'\n            WHEN d.modename = 'ç»„é˜Ÿç«æŠ€' AND d.submodename LIKE '%å•äººè£…å¤‡%' THEN 'å•äººè£…å¤‡'\n            WHEN d.modename = 'ç»„é˜Ÿç«æŠ€' AND d.submodename LIKE '%äº¤å‰å ¡å’%' THEN 'äº¤å‰å ¡å’'\n        END AS mode_name,\n        d.vplayerid,\n        DATE(d.firstroundtime) AS first_play_date\n    FROM dws_jordass_mode_roundrecord_di d\n    WHERE \n        (d.submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼')\n        OR (d.modename = 'ç»„é˜Ÿç«æŠ€' AND d.submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%')\n        OR (d.modename = 'åˆ›æ„åˆ›ä½œé—´' AND d.submodename = 'å¹»æƒ³æ··æˆ˜')\n        OR (d.modename = 'ä¼‘é—²æ¨¡å¼' AND d.submodename IN ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ '))\n        OR (d.modename = 'ä¼‘é—²æ¨¡å¼' AND d.submodename LIKE '%ç­–ç•¥è½½å…·%')\n        OR (d.modename = 'åˆ›æ„åˆ›ä½œé—´' AND d.submodename LIKE '%ç‚å¤æ··æˆ˜%')\n        OR (d.modename = 'ç»„é˜Ÿç«æŠ€' AND d.submodename LIKE '%å•äººè£…å¤‡%')\n        OR (d.modename = 'ç»„é˜Ÿç«æŠ€' AND d.submodename LIKE '%äº¤å‰å ¡å’%')\n),\nuser_retention AS (\n    SELECT \n        f.mode_name,\n        f.first_play_date,\n        DATEDIFF(DATE(r.dtstatdate), f.first_play_date) AS day_diff,\n        COUNT(DISTINCT f.vplayerid) AS retained_users\n    FROM first_play_dates f\n    JOIN dws_jordass_mode_roundrecord_di r\n        ON f.vplayerid = r.vplayerid\n        AND DATE(r.dtstatdate) BETWEEN f.first_play_date AND DATE_ADD(f.first_play_date, INTERVAL 7 DAY)\n        AND (\n            (r.submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' AND f.mode_name = 'å¹¿åŸŸæˆ˜åœº')\n            OR (r.modename = 'ç»„é˜Ÿç«æŠ€' AND r.submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%' AND f.mode_name = 'æ¶ˆç­æˆ˜')\n            OR (r.modename = 'åˆ›æ„åˆ›ä½œé—´' AND r.submodename = 'å¹»æƒ³æ··æˆ˜' AND f.mode_name = 'å¹»æƒ³æ··æˆ˜')\n            OR (r.modename = 'ä¼‘é—²æ¨¡å¼' AND r.submodename IN ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ ') AND f.mode_name = 'è’é‡ä¼ è¯´')\n            OR (r.modename = 'ä¼‘é—²æ¨¡å¼' AND r.submodename LIKE '%ç­–ç•¥è½½å…·%' AND f.mode_name = 'ç­–ç•¥è½½å…·')\n            OR (r.modename = 'åˆ›æ„åˆ›ä½œé—´' AND r.submodename LIKE '%ç‚å¤æ··æˆ˜%' AND f.mode_name = 'ç‚å¤æ··æˆ˜')\n            OR (r.modename = 'ç»„é˜Ÿç«æŠ€' AND r.submodename LIKE '%å•äººè£…å¤‡%' AND f.mode_name = 'å•äººè£…å¤‡')\n            OR (r.modename = 'ç»„é˜Ÿç«æŠ€' AND r.submodename LIKE '%äº¤å‰å ¡å’%' AND f.mode_name = 'äº¤å‰å ¡å’')\n        )\n    GROUP BY f.mode_name, f.first_play_date, DATEDIFF(DATE(r.dtstatdate), f.first_play_date)\n)\nSELECT \n    m.mode_name,\n    m.launch_date,\n    ur.day_diff AS day_retained,\n    COALESCE(ur.retained_users, 0) AS retained_user_count\nFROM mode_launch_dates m\nLEFT JOIN user_retention ur ON m.mode_name = ur.mode_name\nORDER BY m.mode_name, ur.day_diff;\n```\n\n---\n\n## âœ… äº”ã€è§£é‡Šè¯´æ˜\n\n### ğŸ“Œ ä¸»è¦é€»è¾‘è§£é‡Šï¼š\n\n- `mode_launch_dates`: å®šä¹‰æ‰€æœ‰ç©æ³•çš„ä¸Šçº¿æ—¥æœŸã€‚\n- `first_play_dates`: æå–æ¯ä½ç©å®¶åœ¨æŸä¸ªç©æ³•ä¸­çš„é¦–æ¬¡å‚ä¸æ—¶é—´ã€‚\n- `user_retention`: æ ¹æ®é¦–æ¬¡å‚ä¸æ—¥æœŸï¼ŒæŸ¥æ‰¾ä¹‹å7å¤©å†…æ˜¯å¦æœ‰å‚ä¸è®°å½•ï¼Œå¹¶ç»Ÿè®¡æ¯æ—¥ç•™å­˜äººæ•°ã€‚\n- æœ€ç»ˆé€šè¿‡å·¦è¿æ¥å±•ç¤ºæ‰€æœ‰ç©æ³•çš„æ‰€æœ‰ç•™å­˜å¤©æ•°ï¼ˆåŒ…æ‹¬0~7ï¼‰ï¼Œç¼ºå¤±å€¼å¡«å……ä¸º0ã€‚\n\n---\n\n## âœ… å…­ã€è¾“å‡ºæ ·ä¾‹ï¼ˆç¤ºæ„ï¼‰\n\n| mode_name   | launch_date | day_retained | retained_user_count |\n|-------------|-------------|--------------|---------------------|\n| å¹¿åŸŸæˆ˜åœº    | 20240723    | 0            | 1200                |\n| å¹¿åŸŸæˆ˜åœº    | 20240723    | 1            | 800                 |\n| å¹¿åŸŸæˆ˜åœº    | 20240723    | 2            | 600                 |\n| ...         | ...         | ...          | ...                 |\n\n---\n\nå¦‚æœä½ æœ‰æ›´å¤šå…·ä½“è¦æ±‚ï¼Œæ¯”å¦‚åªä¿ç•™å‰Nä¸ªç©æ³•ã€æ·»åŠ è¿‡æ»¤æ¡ä»¶ã€æ”¯æŒå¤šå¹³å°ç­‰ï¼Œä¹Ÿå¯ä»¥è¿›ä¸€æ­¥æ‰©å±•ã€‚æ¬¢è¿ç»§ç»­æé—®ï¼"
},
{
  "instruction": "è¯·ä½ æ¥ä¸‹æ¥ä¸€æ­¥æ­¥æ€è€ƒï¼Œå†™å‡ºæ­£ç¡®çš„SQLæŸ¥è¯¢è¯­å¥ä»¥æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚",
  "input": "ä½ æ˜¯ä¸€åMySQLä¸“å®¶ï¼Œç°åœ¨éœ€è¦é˜…è¯»å¹¶ç†è§£ä¸‹é¢çš„ã€æ•°æ®åº“schemaã€‘æè¿°ï¼Œä»¥åŠå¯èƒ½ç”¨åˆ°çš„ã€å‚è€ƒä¿¡æ¯ã€‘ï¼Œå¹¶è¿ç”¨MySQLçŸ¥è¯†ç”Ÿæˆsqlè¯­å¥å›ç­”ã€ç”¨æˆ·é—®é¢˜ã€‘ã€‚\nã€ç”¨æˆ·é—®é¢˜ã€‘\nç»Ÿè®¡å„ä¸ªç©æ³•ä¸Šçº¿é¦–å‘¨ç•™å­˜æƒ…å†µ\nè¾“å‡ºï¼šç©æ³•ã€ä¸Šçº¿é¦–å‘¨é¦–æ¬¡ç©çš„æ—¥æœŸã€ç¬¬å‡ å¤©ç•™å­˜ï¼ˆ0,1,2...7)ã€ç©æ³•ç•™å­˜ç”¨æˆ·æ•°\n\nå„ç©æ³•é¦–å‘¨ä¸Šçº¿æ—¥æœŸï¼š\n\"å¹¿åŸŸæˆ˜åœº\": \"20240723\",\n\"æ¶ˆç­æˆ˜\": \"20230804\",\n\"å¹»æƒ³æ··æˆ˜\": \"20241115\",\n\"è’é‡ä¼ è¯´\": \"20240903\",\n\"ç­–ç•¥è½½å…·\": \"20241010\",\n\"ç‚å¤æ··æˆ˜\": \"20240625\",\n\"å•äººè£…å¤‡\": \"20240517\",\n\"äº¤å‰å ¡å’\": \"20240412\"\n\nã€æ•°æ®åº“schemaã€‘\nCREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` TEXT COMMENT 'ç»Ÿè®¡æ—¥æœŸæ ¼å¼YYYYMMDD',\n  `vgameappid` TEXT COMMENT 'è´¦å·ä½“ç³»ï¼šwx:å¾®ä¿¡ï¼Œqqï¼šæ‰‹Q',\n  `platid` BIGINT COMMENT 'ç³»ç»Ÿå¹³å°ï¼š0:IOS,1:Android',\n  `vplayerid` TEXT COMMENT 'ç©å®¶ID',\n  `mode` BIGINT COMMENT 'æ¨¡å¼ID',\n  `modename` TEXT COMMENT 'æ¨¡å¼åç§°',\n  `submode` BIGINT COMMENT 'å­æ¨¡å¼ID',\n  `submodename` TEXT COMMENT 'å­æ¨¡å¼åç§°',\n  `map` BIGINT COMMENT 'åœ°å›¾ID',\n  `mapname` TEXT COMMENT 'åœ°å›¾åç§°',\n  `seasonid` BIGINT COMMENT 'èµ›å­£ID',\n  `seasonname` TEXT COMMENT 'èµ›å­£åç§°',\n  `roundcnt` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ•°',\n  `roundtime` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ—¶é•¿(ç§’)',\n  `survivaltime` BIGINT COMMENT 'å½“æ—¥å­˜æ´»æ—¶é•¿(ç§’)',\n  `firstroundtime` TEXT COMMENT 'å½“æ—¥é¦–æ¬¡å¯¹å±€æ—¶é—´',\n  `device_type` BIGINT COMMENT 'è®¾å¤‡ç±»å‹'\n);\n\nã€å‚è€ƒä¿¡æ¯ã€‘\nè¯´æ˜ï¼š\nå¹¿åŸŸæˆ˜åœº ï¼ˆ2024/7/23ï¼‰submodename= 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'ï¼Œ\næ¶ˆç­æˆ˜ï¼ˆ2023/8/4ï¼‰ modename='ç»„é˜Ÿç«æŠ€' and submodename like '%æ¶ˆç­æˆ˜æ¨¡å¼%'ï¼Œ\nå¹»æƒ³æ··æˆ˜ï¼ˆ2024/11/15ï¼‰modename='åˆ›æ„åˆ›ä½œé—´' and submodename='å¹»æƒ³æ··æˆ˜'ï¼Œ\nè’é‡ä¼ è¯´ï¼ˆ2024-09-03ï¼‰modename='ä¼‘é—²æ¨¡å¼' and submodename in ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ ')ï¼Œ\nç­–ç•¥è½½å…·ï¼ˆ2024-10-10ï¼‰modename='ä¼‘é—²æ¨¡å¼' and submodename like '%ç­–ç•¥è½½å…·%'ï¼Œ\nç‚å¤æ··æˆ˜ï¼ˆ2024-06-25ï¼‰modename='åˆ›æ„åˆ›ä½œé—´' and submodename like '%ç‚å¤æ··æˆ˜%'ï¼Œ\nå•äººè£…å¤‡ï¼ˆ2024.5.17ï¼‰modename='ç»„é˜Ÿç«æŠ€' and submodename like '%å•äººè£…å¤‡%'ï¼Œ\näº¤å‰å ¡å’ï¼ˆ2024.4.12ï¼‰ modename='ç»„é˜Ÿç«æŠ€' and submodename like '%äº¤å‰å ¡å’%'\n\nç¬¬å‡ å¤©ç•™å­˜ï¼š0è¡¨ç¤ºå½“å¤©å‚ä¸ã€1è¡¨ç¤ºå½“å¤©å‚ä¸åœ¨ç¬¬2å¤©ä¹Ÿå‚ä¸ã€2è¡¨ç¤ºå½“å¤©å‚ä¸åœ¨ç¬¬3å¤©ä¹Ÿå‚ä¸ï¼Œä¾æ­¤ç±»æ¨\n\n",
  "chosen": "select  a.itype,\n        a.dtstatdate,\n        datediff(b.dtstatdate,a.dtstatdate) as idaynum,\n        count(distinct a.vplayerid)           as iusernum\nfrom (                      \n    select\n        itype,\n        min(dtstatdate) as dtstatdate,\n        vplayerid\n    from  (\n        select 'å¹¿åŸŸæˆ˜åœº'      as itype,\n                min(dtstatdate) as dtstatdate,\n                vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',6)\n        and submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'\n        group by vplayerid\n\n        union all\n        select 'æ¶ˆç­æˆ˜', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',6)\n        and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%æ¶ˆç­æˆ˜æ¨¡å¼%'\n        group by vplayerid\n\n        union all\n        select 'å¹»æƒ³æ··æˆ˜', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',6)\n        and modename='åˆ›æ„åˆ›ä½œé—´' and submodename='å¹»æƒ³æ··æˆ˜'\n        group by vplayerid\n\n        union all\n        select 'è’é‡ä¼ è¯´', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',6)\n        and modename='ä¼‘é—²æ¨¡å¼' and submodename in ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ ')\n        group by vplayerid\n\n        union all\n        select 'ç­–ç•¥è½½å…·', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',6)\n        and modename='ä¼‘é—²æ¨¡å¼' and submodename like '%ç­–ç•¥è½½å…·%'\n        group by vplayerid\n\n        union all\n        select 'ç‚å¤æ··æˆ˜', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',6)\n        and modename='åˆ›æ„åˆ›ä½œé—´' and submodename like '%ç‚å¤æ··æˆ˜%'\n        group by vplayerid\n\n        union all\n        select 'å•äººè£…å¤‡', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',6)\n        and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%å•äººè£…å¤‡%'\n        group by vplayerid\n\n        union all\n        select 'äº¤å‰å ¡å’', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',6)\n        and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%äº¤å‰å ¡å’%'\n        group by vplayerid\n    ) t\n    group by itype, vplayerid\n) a\nleft join (\n        select 'å¹¿åŸŸæˆ˜åœº' as itype, dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',13)\n          and submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'æ¶ˆç­æˆ˜', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',13)\n          and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%æ¶ˆç­æˆ˜æ¨¡å¼%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'å¹»æƒ³æ··æˆ˜', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',13)\n          and modename='åˆ›æ„åˆ›ä½œé—´' and submodename='å¹»æƒ³æ··æˆ˜'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'è’é‡ä¼ è¯´', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',13)\n          and modename='ä¼‘é—²æ¨¡å¼' and submodename in ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ ')\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'ç­–ç•¥è½½å…·', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',13)\n          and modename='ä¼‘é—²æ¨¡å¼' and submodename like '%ç­–ç•¥è½½å…·%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'ç‚å¤æ··æˆ˜', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',13)\n          and modename='åˆ›æ„åˆ›ä½œé—´' and submodename like '%ç‚å¤æ··æˆ˜%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'å•äººè£…å¤‡', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',13)\n          and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%å•äººè£…å¤‡%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select 'äº¤å‰å ¡å’', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',13)\n          and modename='ç»„é˜Ÿç«æŠ€' and submodename like '%äº¤å‰å ¡å’%'\n        group by dtstatdate, vplayerid\n) b\n  on  a.itype      = b.itype\nand  a.vplayerid    = b.vplayerid\nwhere datediff(b.dtstatdate,a.dtstatdate) between 0 and 7\ngroup by a.itype, a.dtstatdate, datediff(b.dtstatdate,a.dtstatdate);",
  "rejected": "æˆ‘ä»¬æ¥ä¸€æ­¥ä¸€æ­¥åˆ†æå’Œæ„å»º SQL æŸ¥è¯¢è¯­å¥ï¼Œä»¥æ»¡è¶³â€œç»Ÿè®¡å„ä¸ªç©æ³•ä¸Šçº¿é¦–å‘¨ç•™å­˜æƒ…å†µâ€çš„éœ€æ±‚ã€‚\n\n---\n\n## âœ… **ä¸€ã€æ˜ç¡®ç›®æ ‡**\n\næˆ‘ä»¬è¦è¾“å‡ºä»¥ä¸‹å­—æ®µï¼š\n\n| å­—æ®µå | å«ä¹‰ |\n|--------|------|\n| ç©æ³• | æ¨¡å¼åç§° |\n| ä¸Šçº¿é¦–å‘¨é¦–æ¬¡ç©çš„æ—¥æœŸ | è¯¥ç©æ³•é¦–æ¬¡ä¸Šçº¿çš„æ—¶é—´ |\n| ç¬¬å‡ å¤©ç•™å­˜ | ä»é¦–æ¬¡å‚ä¸åçš„ç¬¬0å¤©åˆ°ç¬¬7å¤©ï¼ˆå³0~7ï¼‰ |\n| ç©æ³•ç•™å­˜ç”¨æˆ·æ•° | åœ¨æŸä¸€å¤©ç•™å­˜çš„ç”¨æˆ·æ•°é‡ |\n\n---\n\n## âœ… **äºŒã€æ•°æ®ç»“æ„ä¸å…³é”®ç‚¹**\n\n### æ•°æ®è¡¨ï¼š\n```sql\ndws_jordass_mode_roundrecord_di\n```\n\nåŒ…å«å­—æ®µï¼š\n- `modename`: æ¨¡å¼åç§°\n- `submodename`: å­æ¨¡å¼åç§°\n- `vplayerid`: ç©å®¶ID\n- `dtstatdate`: ç»Ÿè®¡æ—¥æœŸï¼ˆæ ¼å¼ä¸º YYYYMMDDï¼‰\n\n### éœ€è¦è¯†åˆ«çš„ç©æ³•åŠå…¶ä¸Šçº¿æ—¥æœŸï¼š\n| ç©æ³•       | ä¸Šçº¿æ—¥æœŸ   | æ¡ä»¶ç­›é€‰ |\n|------------|------------|----------|\n| å¹¿åŸŸæˆ˜åœº   | 20240723   | submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' |\n| æ¶ˆç­æˆ˜     | 20230804   | modename='ç»„é˜Ÿç«æŠ€' and submodename like '%æ¶ˆç­æˆ˜æ¨¡å¼%' |\n| å¹»æƒ³æ··æˆ˜   | 20241115   | modename='åˆ›æ„åˆ›ä½œé—´' and submodename='å¹»æƒ³æ··æˆ˜' |\n| è’é‡ä¼ è¯´   | 20240903   | modename='ä¼‘é—²æ¨¡å¼' and submodename in ('è’é‡ä¼ è¯´','è’é‡æ²™æ¼ ') |\n| ç­–ç•¥è½½å…·   | 20241010   | modename='ä¼‘é—²æ¨¡å¼' and submodename like '%ç­–ç•¥è½½å…·%' |\n| ç‚å¤æ··æˆ˜   | 20240625   | modename='åˆ›æ„åˆ›ä½œé—´' and submodename like '%ç‚å¤æ··æˆ˜%' |\n| å•äººè£…å¤‡   | 20240517   | modename='ç»„é˜Ÿç«æŠ€' and submodename like '%å•äººè£…å¤‡%' |\n| äº¤å‰å ¡å’   | 20240412   | modename='ç»„é˜Ÿç«æŠ€' and submodename like '%äº¤å‰å ¡å’%' |\n\n---\n\n## âœ… **ä¸‰ã€é€»è¾‘æ‹†è§£**\n\n### æ­¥éª¤ä¸€ï¼šæ‰¾å‡ºæ¯ä¸ªç©æ³•çš„**é¦–æ¬¡å‚ä¸ç”¨æˆ·**\næˆ‘ä»¬éœ€è¦æ‰¾å‡ºæ¯ç§ç©æ³•ä¸­ï¼Œ**é¦–æ¬¡å‚ä¸è¯¥ç©æ³•çš„ç©å®¶**ï¼Œå¹¶è®°å½•å…¶é¦–æ¬¡å‚ä¸æ—¥æœŸã€‚\n\n```sql\nWITH first_play_dates AS (\n    SELECT \n        modename,\n        submodename,\n        vplayerid,\n        MIN(dtstatdate) AS first_date\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE \n        (modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%')\n        OR (modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename = 'å¹»æƒ³æ··æˆ˜')\n        OR (modename = 'ä¼‘é—²æ¨¡å¼' AND submodename IN ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ '))\n        OR (modename = 'ä¼‘é—²æ¨¡å¼' AND submodename LIKE '%ç­–ç•¥è½½å…·%')\n        OR (modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename LIKE '%ç‚å¤æ··æˆ˜%')\n        OR (modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%å•äººè£…å¤‡%')\n        OR (modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%äº¤å‰å ¡å’%')\n        OR submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼'\n    GROUP BY modename, submodename, vplayerid\n)\n```\n\n### æ­¥éª¤äºŒï¼šè®¡ç®—æ¯ä¸ªç”¨æˆ·çš„**ç•™å­˜æƒ…å†µ**\næˆ‘ä»¬éœ€è¦å°†è¿™äº›é¦–æ¬¡å‚ä¸ç”¨æˆ·ï¼Œåœ¨ä¹‹åçš„æ¯ä¸€å¤©æ˜¯å¦æœ‰å‚ä¸æ¸¸æˆã€‚ä¾‹å¦‚ï¼š\n- ç”¨æˆ·åœ¨ `first_date` å‚ä¸äº†æ¸¸æˆ â†’ ç•™å­˜å¤©æ•°ä¸º 0\n- å¦‚æœä»–åœ¨ `first_date + 1` ä¹Ÿå‚ä¸äº† â†’ ç•™å­˜å¤©æ•°ä¸º 1\n- â€¦ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°ç¬¬7å¤©\n\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `JOIN` æˆ–çª—å£å‡½æ•°å®ç°è¿™ä¸ªé€»è¾‘ã€‚\n\n### æ­¥éª¤ä¸‰ï¼šæ ¹æ®ä¸Šçº¿æ—¥æœŸåˆ†ç±»ï¼Œç»Ÿè®¡ç•™å­˜æƒ…å†µ\n\n---\n\n## âœ… **å››ã€å®Œæ•´ SQL å®ç°**\n\n```sql\nWITH first_play_dates AS (\n    SELECT \n        CASE \n            WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n            WHEN modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%' THEN 'æ¶ˆç­æˆ˜'\n            WHEN modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename = 'å¹»æƒ³æ··æˆ˜' THEN 'å¹»æƒ³æ··æˆ˜'\n            WHEN modename = 'ä¼‘é—²æ¨¡å¼' AND submodename IN ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ ') THEN 'è’é‡ä¼ è¯´'\n            WHEN modename = 'ä¼‘é—²æ¨¡å¼' AND submodename LIKE '%ç­–ç•¥è½½å…·%' THEN 'ç­–ç•¥è½½å…·'\n            WHEN modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename LIKE '%ç‚å¤æ··æˆ˜%' THEN 'ç‚å¤æ··æˆ˜'\n            WHEN modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%å•äººè£…å¤‡%' THEN 'å•äººè£…å¤‡'\n            WHEN modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%äº¤å‰å ¡å’%' THEN 'äº¤å‰å ¡å’'\n        END AS mode_name,\n        vplayerid,\n        MIN(dtstatdate) AS first_date\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE \n        (submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼')\n        OR (modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%æ¶ˆç­æˆ˜æ¨¡å¼%')\n        OR (modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename = 'å¹»æƒ³æ··æˆ˜')\n        OR (modename = 'ä¼‘é—²æ¨¡å¼' AND submodename IN ('è’é‡ä¼ è¯´', 'è’é‡æ²™æ¼ '))\n        OR (modename = 'ä¼‘é—²æ¨¡å¼' AND submodename LIKE '%ç­–ç•¥è½½å…·%')\n        OR (modename = 'åˆ›æ„åˆ›ä½œé—´' AND submodename LIKE '%ç‚å¤æ··æˆ˜%')\n        OR (modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%å•äººè£…å¤‡%')\n        OR (modename = 'ç»„é˜Ÿç«æŠ€' AND submodename LIKE '%äº¤å‰å ¡å’%')\n    GROUP BY mode_name, vplayerid\n),\n\n-- è®¡ç®—æ¯ä¸ªç©å®¶åœ¨ä¸åŒæ—¥æœŸæ˜¯å¦å‚ä¸\ndaily_play AS (\n    SELECT \n        f.mode_name,\n        f.vplayerid,\n        f.first_date,\n        d.dtstatdate,\n        DATEDIFF(d.dtstatdate, f.first_date) AS day_diff\n    FROM first_play_dates f\n    JOIN dws_jordass_mode_roundrecord_di d\n        ON f.vplayerid = d.vplayerid\n        AND d.dtstatdate >= f.first_date\n        AND d.dtstatdate <= DATE_ADD(f.first_date, INTERVAL 7 DAY)\n),\n\n-- ç»Ÿè®¡æ¯å¤©çš„ç•™å­˜äººæ•°\nretention_stats AS (\n    SELECT \n        mode_name,\n        first_date,\n        day_diff,\n        COUNT(DISTINCT vplayerid) AS retained_users\n    FROM daily_play\n    GROUP BY mode_name, first_date, day_diff\n)\n\n-- æœ€ç»ˆè¾“å‡ºç»“æœ\nSELECT \n    mode_name AS ç©æ³•,\n    first_date AS ä¸Šçº¿é¦–å‘¨é¦–æ¬¡ç©çš„æ—¥æœŸ,\n    day_diff AS ç¬¬å‡ å¤©ç•™å­˜,\n    retained_users AS ç©æ³•ç•™å­˜ç”¨æˆ·æ•°\nFROM retention_stats\nORDER BY mode_name, day_diff;\n```\n\n---\n\n## âœ… **äº”ã€è¯´æ˜**\n\n- ä½¿ç”¨ `WITH` å­å¥åˆ†æ­¥å¤„ç†ï¼š\n  - å…ˆè·å–æ¯ç§ç©æ³•ä¸‹é¦–æ¬¡å‚ä¸çš„ç”¨æˆ·åŠæ—¥æœŸï¼›\n  - å†åˆ¤æ–­è¿™äº›ç”¨æˆ·åœ¨ä¹‹åçš„ 0~7 å¤©å†…æ˜¯å¦ç»§ç»­å‚ä¸ï¼›\n  - æœ€åç»Ÿè®¡æ¯å¤©çš„ç•™å­˜äººæ•°ã€‚\n- è¾“å‡ºå­—æ®µå¯¹åº”è¦æ±‚ï¼š\n  - ç©æ³•ï¼ˆé€šè¿‡ CASE åŒ¹é…ï¼‰\n  - é¦–æ¬¡å‚ä¸æ—¥æœŸ\n  - ç¬¬å‡ å¤©ç•™å­˜ï¼ˆ0~7ï¼‰\n  - ç•™å­˜ç”¨æˆ·æ•°\n\n---\n\n## âœ… **å…­ã€é¢„æœŸè¾“å‡ºç¤ºä¾‹**\n\n| ç©æ³•       | ä¸Šçº¿é¦–å‘¨é¦–æ¬¡ç©çš„æ—¥æœŸ | ç¬¬å‡ å¤©ç•™å­˜ | ç©æ³•ç•™å­˜ç”¨æˆ·æ•° |\n|------------|----------------------|-------------|----------------|\n| å¹¿åŸŸæˆ˜åœº   | 20240723             | 0           | 1200           |\n| å¹¿åŸŸæˆ˜åœº   | 20240723             | 1           | 800            |\n| å¹¿åŸŸæˆ˜åœº   | 20240723             | 2           | 600            |\n| ...        | ...                  | ...         | ...            |\n\n---\n\nå¦‚éœ€è¿›ä¸€æ­¥ä¼˜åŒ–æˆ–æ·»åŠ å…¶ä»–ç»´åº¦ï¼ˆæ¯”å¦‚æŒ‰å¹³å°ã€è®¾å¤‡ç­‰ï¼‰ï¼Œå¯åœ¨æ­¤åŸºç¡€ä¸Šæ‰©å±•ã€‚"
},
{
  "instruction": "è¯·ä½ æ¥ä¸‹æ¥ä¸€æ­¥æ­¥æ€è€ƒï¼Œå†™å‡ºæ­£ç¡®çš„SQLæŸ¥è¯¢è¯­å¥ä»¥æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚",
  "input": "ä½ æ˜¯ä¸€åMySQLä¸“å®¶ï¼Œç°åœ¨éœ€è¦é˜…è¯»å¹¶ç†è§£ä¸‹é¢çš„ã€æ•°æ®åº“schemaã€‘æè¿°ï¼Œä»¥åŠå¯èƒ½ç”¨åˆ°çš„ã€å‚è€ƒä¿¡æ¯ã€‘ï¼Œå¹¶è¿ç”¨MySQLçŸ¥è¯†ç”Ÿæˆsqlè¯­å¥å›ç­”ã€ç”¨æˆ·é—®é¢˜ã€‘ã€‚\nã€ç”¨æˆ·é—®é¢˜ã€‘\nç»Ÿè®¡2019.5.8è‡³2025.3.30 åˆ†æœˆçš„ç©æ³•ä¸»ç©æƒ…å†µ\nè¾“å‡ºï¼šæœˆä»½(201905ã€201906ã€...ã€202503)ã€ä¸»ç©ç©æ³•ã€ä¸»ç©äººæ•°ã€æ€»å‚ä¸äººæ•°\n\nã€æ•°æ®åº“schemaã€‘\nCREATE TABLE `dwd_jordass_playerexitgamerecord_hi` (\n  `tdbank_imp_date` TEXT,\n  `gamesvrid` TEXT COMMENT 'ç™»å½•çš„æ¸¸æˆæœåŠ¡å™¨ç¼–å·',\n  `dteventtime` TEXT COMMENT 'æ¸¸æˆäº‹ä»¶çš„æ—¶é—´, æ ¼å¼ YYYY-MM-DD HH:MM:SS',\n  `vgameappid` TEXT COMMENT 'æ¸¸æˆAPPID',\n  `platid` BIGINT COMMENT 'ios 0/android 1',\n  `izoneareaid` BIGINT COMMENT 'é’ˆå¯¹åˆ†åŒºåˆ†æœçš„æ¸¸æˆå¡«å†™åˆ†åŒºidï¼Œç”¨æ¥å”¯ä¸€æ ‡ç¤ºä¸€ä¸ªåŒºï¼›éåˆ†åŒºåˆ†æœæ¸¸æˆè¯·å¡«å†™0',\n  `vplayerid` TEXT COMMENT 'ç”¨æˆ·playeridå·',\n  `uid` TEXT COMMENT 'è§’è‰²UID',\n  `gameid` TEXT COMMENT 'æœ¬å±€æ¸¸æˆID',\n  `exitreason` TEXT COMMENT 'é€€å‡ºåŸå› ',\n  `isallianceforceeescape` BIGINT COMMENT 'é€ƒè·‘æ—¶æ˜¯å¦å®‰å…¨çš„ å¦:0/æ˜¯:1',\n  `escapebantype` BIGINT COMMENT 'æœ¬æ¬¡é€€å‡ºæ˜¯å¦è§¦å‘ç¦èµ›é™åˆ¶ï¼Œ0=æ²¡æœ‰è§¦å‘ï¼›1=è§¦å‘é™åˆ¶ä¸€ï¼›2=è§¦å‘é™åˆ¶äºŒï¼›3=è§¦å‘é™åˆ¶ä¸‰',\n  `gamestate` TEXT COMMENT 'é€€å‡ºæ—¶å¯¹å±€çŠ¶æ€ï¼šActiveæ˜¯åœ¨å‡ºç”Ÿå²›ä¹‹å‰ï¼ŒReadyæ˜¯åœ¨å‡ºç”Ÿå²›ï¼ŒFightingæ˜¯åŒ…æ‹¬4äººé›†ç»“ã€ä¸Šé£æœºã€è·³ä¼æˆ˜æ–—è¿™äº›é˜¶æ®µï¼ŒFinish æ­»äº¡/èƒœåˆ©ç»“æŸ',\n  `submodegroup` BIGINT COMMENT 'æ¨¡å¼ç»„ID',\n  `lobbyexitreason` TEXT COMMENT 'å¤§å…è®°å½•çš„é€€å‡ºåŸå› ',\n  `mode` BIGINT COMMENT 'æ¨¡å¼ID',\n  `submode` BIGINT COMMENT 'å­æ¨¡å¼ID',\n  `roundtime` BIGINT COMMENT 'å¯¹å±€æ—¶é•¿'\n);\nCREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` TEXT COMMENT 'ç»Ÿè®¡æ—¥æœŸæ ¼å¼YYYYMMDD',\n  `vgameappid` TEXT COMMENT 'è´¦å·ä½“ç³»ï¼šwx:å¾®ä¿¡ï¼Œqqï¼šæ‰‹Q',\n  `platid` BIGINT COMMENT 'ç³»ç»Ÿå¹³å°ï¼š0:IOS,1:Android',\n  `vplayerid` TEXT COMMENT 'ç©å®¶ID',\n  `mode` BIGINT COMMENT 'æ¨¡å¼ID',\n  `modename` TEXT COMMENT 'æ¨¡å¼åç§°',\n  `submode` BIGINT COMMENT 'å­æ¨¡å¼ID',\n  `submodename` TEXT COMMENT 'å­æ¨¡å¼åç§°',\n  `map` BIGINT COMMENT 'åœ°å›¾ID',\n  `mapname` TEXT COMMENT 'åœ°å›¾åç§°',\n  `seasonid` BIGINT COMMENT 'èµ›å­£ID',\n  `seasonname` TEXT COMMENT 'èµ›å­£åç§°',\n  `roundcnt` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ•°',\n  `roundtime` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ—¶é•¿(ç§’)',\n  `survivaltime` BIGINT COMMENT 'å½“æ—¥å­˜æ´»æ—¶é•¿(ç§’)',\n  `firstroundtime` TEXT COMMENT 'å½“æ—¥é¦–æ¬¡å¯¹å±€æ—¶é—´',\n  `device_type` BIGINT COMMENT 'è®¾å¤‡ç±»å‹'\n);\n\nã€å‚è€ƒä¿¡æ¯ã€‘\nä¸»ç©å®šä¹‰ï¼šç”¨æˆ·ç´¯è®¡å¯¹å±€æ—¶é•¿æœ€å¤šçš„ç©æ³•ï¼›\n\nç©æ³•ï¼šä»dws_jordass_mode_roundrecord_diå–\nä»ä¸Šå¾€ä¸‹åŒ¹é…ï¼Œå¦‚æœæ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶ï¼Œåˆ™è¿”å›å¯¹åº”çš„åç§°ï¼Œå¦åˆ™è¿”å›â€œå…¶ä»–æ¨¡å¼â€ã€‚\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ï¼Œä¸”å­æ¨¡å¼åç§°ä»¥â€œCGâ€å¼€å¤´ï¼Œä¸”åœ°å›¾ä¸ºâ€œç¾¤å±¿â€ï¼Œåˆ™è¿”å›â€œä¸»é¢˜ç¾¤å±¿â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œç¾¤å±¿â€ï¼Œåˆ™è¿”å›â€œä¼ ç»Ÿç¾¤å±¿â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œå‡æ—¥ç¾¤å²›â€ï¼Œåˆ™è¿”å›â€œå‡æ—¥ç¾¤å²›â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œè£è€€ä¹‹åŸâ€ï¼Œåˆ™è¿”å›â€œè£è€€ä¹‹åŸâ€ï¼›\nå¦‚æœå­æ¨¡å¼æ˜¯â€œå¹¿åŸŸæˆ˜åœºæ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œå¹¿åŸŸæˆ˜åœºâ€ï¼›\nå¦‚æœå­æ¨¡å¼æ˜¯â€œæèƒ½å½¢æ€æ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œæèƒ½å½¢æ€â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œç»„é˜Ÿç«æŠ€â€ï¼Œåˆ™è¿”å›â€œç»„ç«â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œä¼‘é—²æ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œä¼‘é—²â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œä¹å›­â€ï¼Œåˆ™è¿”å›â€œä¹å›­â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œé¢†åœ°â€ï¼Œåˆ™è¿”å›â€œé¢†åœ°â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œå¹¿é˜”å¤©åœ°â€ï¼Œåˆ™è¿”å›â€œå¹¿é˜”å¤©åœ°â€\n\næ³¨æ„ï¼Œå‚ä¸éš§é“æ¨¡å¼çš„ç”¨æˆ·æ•°æ®ä»dwd_jordass_playerexitgamerecord_hiå–ï¼Œæ—¶é—´é™åˆ¶ 2024.6.18-2025.3.30ï¼Œmode in (3001, 3002, 3003)\n\n",
  "chosen": "with main_user as (\n    select substr(dtstatdate, 1, 6) mons,\n        case\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and submodename like 'CG%' and mapname = 'ç¾¤å±¿' then 'ä¸»é¢˜ç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'ç¾¤å±¿' then 'ä¼ ç»Ÿç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'å‡æ—¥ç¾¤å²›' then 'å‡æ—¥ç¾¤å²›'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'è£è€€ä¹‹åŸ' then 'è£è€€ä¹‹åŸ'\n            when submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' then 'å¹¿åŸŸæˆ˜åœº'\n            when submodename = 'æèƒ½å½¢æ€æ¨¡å¼' then 'æèƒ½å½¢æ€'\n            when modename = 'ç»„é˜Ÿç«æŠ€' then 'ç»„ç«'\n            when modename = 'ä¹å›­' then 'ä¹å›­'\n            when modename = 'é¢†åœ°' then 'é¢†åœ°'\n            when modename = 'å¹¿é˜”å¤©åœ°' then 'å¹¿é˜”å¤©åœ°'\n            else 'å…¶ä»–æ¨¡å¼'\n        end imodename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        sum(roundcnt) roundcnt\n   from dws_jordass_mode_roundrecord_di\n   where dtstatdate between '20190508' and '20250330'\n   group by vplayerid, substr(dtstatdate, 1, 6),\n        case\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and submodename like 'CG%' and mapname = 'ç¾¤å±¿' then 'ä¸»é¢˜ç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'ç¾¤å±¿' then 'ä¼ ç»Ÿç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'å‡æ—¥ç¾¤å²›' then 'å‡æ—¥ç¾¤å²›'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'è£è€€ä¹‹åŸ' then 'è£è€€ä¹‹åŸ'\n            when submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' then 'å¹¿åŸŸæˆ˜åœº'\n            when submodename = 'æèƒ½å½¢æ€æ¨¡å¼' then 'æèƒ½å½¢æ€'\n            when modename = 'ç»„é˜Ÿç«æŠ€' then 'ç»„ç«'\n            when modename = 'ä¹å›­' then 'ä¹å›­'\n            when modename = 'é¢†åœ°' then 'é¢†åœ°'\n            when modename = 'å¹¿é˜”å¤©åœ°' then 'å¹¿é˜”å¤©åœ°'\n            else 'å…¶ä»–æ¨¡å¼'\n        end\n\n   union all\n   \n   select substr (tdbank_imp_date, 1, 6) mons,\n        'éš§é“' as modename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        count(distinct gameid) roundcnt\n   from dwd_jordass_playerexitgamerecord_hi\n   where tdbank_imp_date between '2024061800' and '2025033023'\n     and mode in (3001, 3002, 3003)\n   group by substr (tdbank_imp_date, 1, 6), vplayerid\n)\n\nselect a.mons,\n       a.imodename,\n       a.iusernum,\n       b.iusernumall\nfrom (\n    select mons,\n          imodename,\n          count(vplayerid) iusernum\n    from (\n        select mons, vplayerid, imodename\n        from (\n            select mons,\n                vplayerid,\n                imodename,\n                roundtime,\n                row_number() over (partition by mons, vplayerid order by roundtime desc) as rn\n            from main_user\n        )ff1\n        where rn = 1\n    )f1\n   group by mons, imodename\n) a\nleft join (\n    select mons,\n        imodename,\n        count(vplayerid) iusernumall\n   from main_user\n   group by mons, imodename\n) b \non a.imodename = b.imodename and a.mons = b.mons\norder by a.mons, a.imodename\n;",
  "rejected": "æˆ‘ä»¬å°†é€æ­¥åˆ†æéœ€æ±‚ï¼Œå¹¶æ„å»ºå‡ºç¬¦åˆè¦æ±‚çš„ SQL æŸ¥è¯¢è¯­å¥ã€‚\n\n---\n\n## âœ… **ç¬¬ä¸€æ­¥ï¼šç†è§£ç”¨æˆ·é—®é¢˜**\n\næˆ‘ä»¬è¦ç»Ÿè®¡çš„æ˜¯ï¼š\n- æ—¶é—´èŒƒå›´ï¼š**2019å¹´5æœˆ8æ—¥ è‡³ 2025å¹´3æœˆ30æ—¥**\n- æŒ‰ç…§**æœˆä»½ï¼ˆæ ¼å¼å¦‚ 201905ï¼‰**è¿›è¡Œåˆ†ç»„\n- è¾“å‡ºå­—æ®µï¼š\n  - æœˆä»½ï¼ˆæ ¼å¼ï¼šYYYYMMï¼‰\n  - ä¸»ç©ç©æ³•ï¼ˆç”¨æˆ·åœ¨è¯¥æœˆç´¯è®¡å¯¹å±€æ—¶é•¿æœ€å¤šçš„ç©æ³•ï¼‰\n  - ä¸»ç©äººæ•°ï¼ˆç©è¯¥ç©æ³•çš„äººæ•°ï¼‰\n  - æ€»å‚ä¸äººæ•°ï¼ˆè¯¥æœˆæ‰€æœ‰å‚ä¸è¿‡æ¸¸æˆçš„ç”¨æˆ·æ•°ï¼‰\n\n---\n\n## âœ… **ç¬¬äºŒæ­¥ï¼šç†è§£è¡¨ç»“æ„å’Œå­—æ®µå«ä¹‰**\n\n### è¡¨1ï¼š`dwd_jordass_playerexitgamerecord_hi`\n- è®°å½•äº†ç©å®¶é€€å‡ºæ¸¸æˆçš„è¡Œä¸ºï¼ŒåŒ…å«ï¼š\n  - `dteventtime`: æ¸¸æˆäº‹ä»¶æ—¶é—´\n  - `vplayerid`: ç”¨æˆ· ID\n  - `mode`: æ¨¡å¼ ID\n  - `roundtime`: å¯¹å±€æ—¶é•¿ï¼ˆç§’ï¼‰\n  - åªæœ‰éƒ¨åˆ†æ¨¡å¼ï¼ˆ3001, 3002, 3003ï¼‰çš„æ•°æ®éœ€è¦å¤„ç†ï¼ˆéš§é“æ¨¡å¼ï¼‰\n\n### è¡¨2ï¼š`dws_jordass_mode_roundrecord_di`\n- ç»Ÿè®¡äº†ç©å®¶çš„æ¯æ—¥å¯¹å±€æ•°æ®ï¼ŒåŒ…å«ï¼š\n  - `dtstatdate`: ç»Ÿè®¡æ—¥æœŸï¼ˆYYYYMMDDï¼‰\n  - `vplayerid`: ç©å®¶ ID\n  - `mode`, `submode`, `map`, `modename`, `submodename`, `mapname`: ç©æ³•ç›¸å…³ä¿¡æ¯\n  - `roundtime`: å½“å¤©å¯¹å±€æ—¶é•¿ï¼ˆç§’ï¼‰\n\n---\n\n## âœ… **ç¬¬ä¸‰æ­¥ï¼šç¡®å®šä¸»ç©ç©æ³•çš„é€»è¾‘**\n\næ ¹æ®é¢˜ç›®ä¸­çš„è§„åˆ™ï¼Œæˆ‘ä»¬å¯¹ç©æ³•è¿›è¡Œæ˜ å°„ï¼š\n\n```sql\nCASE \n    WHEN mode = 1 AND submodename LIKE 'CG%' AND mapname = 'ç¾¤å±¿' THEN 'ä¸»é¢˜ç¾¤å±¿'\n    WHEN mode = 1 AND mapname = 'ç¾¤å±¿' THEN 'ä¼ ç»Ÿç¾¤å±¿'\n    WHEN mode = 1 AND mapname = 'å‡æ—¥ç¾¤å²›' THEN 'å‡æ—¥ç¾¤å²›'\n    WHEN mode = 1 AND mapname = 'è£è€€ä¹‹åŸ' THEN 'è£è€€ä¹‹åŸ'\n    WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n    WHEN submodename = 'æèƒ½å½¢æ€æ¨¡å¼' THEN 'æèƒ½å½¢æ€'\n    WHEN mode = 2 THEN 'ç»„ç«'\n    WHEN mode = 3 THEN 'ä¼‘é—²'\n    WHEN mode = 4 THEN 'ä¹å›­'\n    WHEN mode = 5 THEN 'é¢†åœ°'\n    WHEN mode = 6 THEN 'å¹¿é˜”å¤©åœ°'\n    ELSE 'å…¶ä»–æ¨¡å¼'\nEND AS play_mode\n```\n\n---\n\n## âœ… **ç¬¬å››æ­¥ï¼šå¤„ç†ä¸¤ä¸ªæ•°æ®æºçš„æ—¶é—´èŒƒå›´**\n\n### 1. `dws_jordass_mode_roundrecord_di`ï¼š\n- æ•°æ®æ—¶é—´èŒƒå›´ï¼š**2019.5.8 åˆ° 2025.3.30**\n- ä½¿ç”¨ `dtstatdate` å­—æ®µç­›é€‰æ—¥æœŸèŒƒå›´\n\n### 2. `dwd_jordass_playerexitgamerecord_hi`ï¼š\n- æ•°æ®æ—¶é—´èŒƒå›´ï¼š**2024.6.18 åˆ° 2025.3.30**\n- ä¸” `mode IN (3001, 3002, 3003)`ï¼ˆéš§é“æ¨¡å¼ï¼‰\n\n---\n\n## âœ… **ç¬¬äº”æ­¥ï¼šåˆå¹¶ä¸¤ä¸ªæ•°æ®æº**\n\nç”±äºä¸¤ä¸ªè¡¨çš„ç©æ³•å®šä¹‰æ–¹å¼ä¸åŒï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒä»¬ç»Ÿä¸€å¤„ç†æˆç›¸åŒçš„ç©æ³•åˆ†ç±»å­—æ®µã€‚\n\n### ğŸ§  å¤„ç†æ­¥éª¤å¦‚ä¸‹ï¼š\n\n1. **ä» `dws_jordass_mode_roundrecord_di` ä¸­æå–ç©æ³•ä¿¡æ¯å¹¶æŒ‰æœˆä»½èšåˆ**\n2. **ä» `dwd_jordass_playerexitgamerecord_hi` ä¸­æå–éš§é“æ¨¡å¼æ•°æ®å¹¶æŒ‰æœˆä»½èšåˆ**\n3. **åˆå¹¶ä¸¤éƒ¨åˆ†æ•°æ®**\n4. **æŒ‰æœˆä»½åˆ†ç»„ï¼Œè®¡ç®—æ¯ä¸ªç©æ³•çš„æ€»æ—¶é•¿ï¼Œæ‰¾å‡ºä¸»ç©ç©æ³•**\n5. **ç»Ÿè®¡æ¯ç§ç©æ³•çš„ä¸»ç©äººæ•°å’Œæ€»å‚ä¸äººæ•°**\n\n---\n\n## âœ… **ç¬¬å…­æ­¥ï¼šç¼–å†™ SQL**\n\n### ğŸ”¢ ç¬¬ä¸€æ­¥ï¼šæ„å»ºç©æ³•æ˜ å°„ + æœˆåº¦æ±‡æ€»\n\n```sql\nWITH mode_mapping AS (\n    SELECT\n        dtstatdate,\n        vplayerid,\n        CASE \n            WHEN mode = 1 AND submodename LIKE 'CG%' AND mapname = 'ç¾¤å±¿' THEN 'ä¸»é¢˜ç¾¤å±¿'\n            WHEN mode = 1 AND mapname = 'ç¾¤å±¿' THEN 'ä¼ ç»Ÿç¾¤å±¿'\n            WHEN mode = 1 AND mapname = 'å‡æ—¥ç¾¤å²›' THEN 'å‡æ—¥ç¾¤å²›'\n            WHEN mode = 1 AND mapname = 'è£è€€ä¹‹åŸ' THEN 'è£è€€ä¹‹åŸ'\n            WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n            WHEN submodename = 'æèƒ½å½¢æ€æ¨¡å¼' THEN 'æèƒ½å½¢æ€'\n            WHEN mode = 2 THEN 'ç»„ç«'\n            WHEN mode = 3 THEN 'ä¼‘é—²'\n            WHEN mode = 4 THEN 'ä¹å›­'\n            WHEN mode = 5 THEN 'é¢†åœ°'\n            WHEN mode = 6 THEN 'å¹¿é˜”å¤©åœ°'\n            ELSE 'å…¶ä»–æ¨¡å¼'\n        END AS play_mode,\n        roundtime\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE dtstatdate BETWEEN '20190508' AND '20250330'\n),\n\ntunnel_data AS (\n    SELECT\n        DATE_FORMAT(STR_TO_DATE(dteventtime, '%Y-%m-%d %H:%i:%s'), '%Y%m') AS month,\n        vplayerid,\n        'éš§é“æ¨¡å¼' AS play_mode,\n        roundtime\n    FROM dwd_jordass_playerexitgamerecord_hi\n    WHERE dteventtime >= '2024-06-18' AND dteventtime < '2025-03-31'\n      AND mode IN (3001, 3002, 3003)\n),\n\ncombined_data AS (\n    SELECT * FROM mode_mapping\n    UNION ALL\n    SELECT * FROM tunnel_data\n),\n\nmonthly_play_time AS (\n    SELECT\n        dtstatdate,\n        vplayerid,\n        play_mode,\n        SUM(roundtime) AS total_time\n    FROM combined_data\n    GROUP BY dtstatdate, vplayerid, play_mode\n),\n\nmonthly_user_mode AS (\n    SELECT\n        LEFT(dtstatdate, 6) AS month,\n        play_mode,\n        vplayerid,\n        SUM(total_time) AS user_total_time\n    FROM monthly_play_time\n    GROUP BY LEFT(dtstatdate, 6), play_mode, vplayerid\n),\n\ntop_modes_per_month AS (\n    SELECT\n        month,\n        play_mode,\n        COUNT(DISTINCT vplayerid) AS player_count,\n        SUM(user_total_time) AS total_time\n    FROM monthly_user_mode\n    GROUP BY month, play_mode\n),\n\nranked_modes AS (\n    SELECT\n        month,\n        play_mode,\n        player_count,\n        total_time,\n        ROW_NUMBER() OVER (PARTITION BY month ORDER BY total_time DESC) AS rn\n    FROM top_modes_per_month\n)\n\nSELECT\n    month AS æœˆä»½,\n    play_mode AS ä¸»ç©ç©æ³•,\n    player_count AS ä¸»ç©äººæ•°,\n    (\n        SELECT COUNT(DISTINCT vplayerid)\n        FROM monthly_user_mode\n        WHERE LEFT(dtstatdate, 6) = ranked_modes.month\n    ) AS æ€»å‚ä¸äººæ•°\nFROM ranked_modes\nWHERE rn = 1\nORDER BY month;\n```\n\n---\n\n## âœ… **ç¬¬ä¸ƒæ­¥ï¼šè¯´æ˜ SQL æ‰§è¡Œé€»è¾‘**\n\n1. **`mode_mapping`**: å°† `dws_jordass_mode_roundrecord_di` ä¸­çš„ç©æ³•æŒ‰è§„åˆ™æ˜ å°„ä¸ºç»Ÿä¸€åç§°\n2. **`tunnel_data`**: æå– `dwd_jordass_playerexitgamerecord_hi` ä¸­éš§é“æ¨¡å¼æ•°æ®ï¼ŒæŒ‰æœˆåˆ†ç»„\n3. **`combined_data`**: åˆå¹¶ä¸¤ç§ç©æ³•æ¥æº\n4. **`monthly_play_time`**: æŒ‰æ—¥æœŸã€ç”¨æˆ·ã€ç©æ³•èšåˆå¯¹å±€æ—¶é•¿\n5. **`monthly_user_mode`**: å†æŒ‰æœˆã€ç©æ³•ã€ç”¨æˆ·èšåˆæ€»æ—¶é•¿\n6. **`top_modes_per_month`**: æ¯ä¸ªæœˆä¸­å„ç©æ³•çš„æ€»æ—¶é•¿ä¸ç”¨æˆ·æ•°\n7. **`ranked_modes`**: ä½¿ç”¨çª—å£å‡½æ•°é€‰å‡ºæ¯æœˆä¸»ç©ç©æ³•ï¼ˆæ—¶é•¿æœ€å¤šï¼‰\n8. **æœ€ç»ˆ SELECT**: è¾“å‡ºæ‰€éœ€å­—æ®µï¼ŒåŠ ä¸Šæ€»å‚ä¸äººæ•°ï¼ˆé€šè¿‡å­æŸ¥è¯¢ç»Ÿè®¡ï¼‰\n\n---\n\n## âœ… **ç¬¬å…«æ­¥ï¼šè¾“å‡ºæ ¼å¼**\n\n| æœˆä»½   | ä¸»ç©ç©æ³•     | ä¸»ç©äººæ•° | æ€»å‚ä¸äººæ•° |\n|--------|--------------|----------|------------|\n| 201905 | ä¼ ç»Ÿç¾¤å±¿     | 1200     | 2500       |\n| 201906 | å¹¿åŸŸæˆ˜åœº     | 980      | 2100       |\n| ...    | ...          | ...      | ...        |\n\n---\n\nå¦‚æœ‰è¿›ä¸€æ­¥éœ€æ±‚ï¼Œæ¯”å¦‚å¢åŠ æ›´å¤šç©æ³•ç»´åº¦æˆ–æ”¯æŒæ›´å¤æ‚çš„ç»Ÿè®¡ï¼Œå¯ä»¥ç»§ç»­æ‰©å±•ã€‚"
},
{
  "instruction": "è¯·ä½ æ¥ä¸‹æ¥ä¸€æ­¥æ­¥æ€è€ƒï¼Œå†™å‡ºæ­£ç¡®çš„SQLæŸ¥è¯¢è¯­å¥ä»¥æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚",
  "input": "ä½ æ˜¯ä¸€åMySQLä¸“å®¶ï¼Œç°åœ¨éœ€è¦é˜…è¯»å¹¶ç†è§£ä¸‹é¢çš„ã€æ•°æ®åº“schemaã€‘æè¿°ï¼Œä»¥åŠå¯èƒ½ç”¨åˆ°çš„ã€å‚è€ƒä¿¡æ¯ã€‘ï¼Œå¹¶è¿ç”¨MySQLçŸ¥è¯†ç”Ÿæˆsqlè¯­å¥å›ç­”ã€ç”¨æˆ·é—®é¢˜ã€‘ã€‚\nã€ç”¨æˆ·é—®é¢˜ã€‘\nç»Ÿè®¡2019.5.8è‡³2025.3.30 åˆ†æœˆçš„ç©æ³•ä¸»ç©æƒ…å†µ\nè¾“å‡ºï¼šæœˆä»½(201905ã€201906ã€...ã€202503)ã€ä¸»ç©ç©æ³•ã€ä¸»ç©äººæ•°ã€æ€»å‚ä¸äººæ•°\n\nã€æ•°æ®åº“schemaã€‘\nCREATE TABLE `dwd_jordass_playerexitgamerecord_hi` (\n  `tdbank_imp_date` TEXT,\n  `gamesvrid` TEXT COMMENT 'ç™»å½•çš„æ¸¸æˆæœåŠ¡å™¨ç¼–å·',\n  `dteventtime` TEXT COMMENT 'æ¸¸æˆäº‹ä»¶çš„æ—¶é—´, æ ¼å¼ YYYY-MM-DD HH:MM:SS',\n  `vgameappid` TEXT COMMENT 'æ¸¸æˆAPPID',\n  `platid` BIGINT COMMENT 'ios 0/android 1',\n  `izoneareaid` BIGINT COMMENT 'é’ˆå¯¹åˆ†åŒºåˆ†æœçš„æ¸¸æˆå¡«å†™åˆ†åŒºidï¼Œç”¨æ¥å”¯ä¸€æ ‡ç¤ºä¸€ä¸ªåŒºï¼›éåˆ†åŒºåˆ†æœæ¸¸æˆè¯·å¡«å†™0',\n  `vplayerid` TEXT COMMENT 'ç”¨æˆ·playeridå·',\n  `uid` TEXT COMMENT 'è§’è‰²UID',\n  `gameid` TEXT COMMENT 'æœ¬å±€æ¸¸æˆID',\n  `exitreason` TEXT COMMENT 'é€€å‡ºåŸå› ',\n  `isallianceforceeescape` BIGINT COMMENT 'é€ƒè·‘æ—¶æ˜¯å¦å®‰å…¨çš„ å¦:0/æ˜¯:1',\n  `escapebantype` BIGINT COMMENT 'æœ¬æ¬¡é€€å‡ºæ˜¯å¦è§¦å‘ç¦èµ›é™åˆ¶ï¼Œ0=æ²¡æœ‰è§¦å‘ï¼›1=è§¦å‘é™åˆ¶ä¸€ï¼›2=è§¦å‘é™åˆ¶äºŒï¼›3=è§¦å‘é™åˆ¶ä¸‰',\n  `gamestate` TEXT COMMENT 'é€€å‡ºæ—¶å¯¹å±€çŠ¶æ€ï¼šActiveæ˜¯åœ¨å‡ºç”Ÿå²›ä¹‹å‰ï¼ŒReadyæ˜¯åœ¨å‡ºç”Ÿå²›ï¼ŒFightingæ˜¯åŒ…æ‹¬4äººé›†ç»“ã€ä¸Šé£æœºã€è·³ä¼æˆ˜æ–—è¿™äº›é˜¶æ®µï¼ŒFinish æ­»äº¡/èƒœåˆ©ç»“æŸ',\n  `submodegroup` BIGINT COMMENT 'æ¨¡å¼ç»„ID',\n  `lobbyexitreason` TEXT COMMENT 'å¤§å…è®°å½•çš„é€€å‡ºåŸå› ',\n  `mode` BIGINT COMMENT 'æ¨¡å¼ID',\n  `submode` BIGINT COMMENT 'å­æ¨¡å¼ID',\n  `roundtime` BIGINT COMMENT 'å¯¹å±€æ—¶é•¿'\n);\nCREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` TEXT COMMENT 'ç»Ÿè®¡æ—¥æœŸæ ¼å¼YYYYMMDD',\n  `vgameappid` TEXT COMMENT 'è´¦å·ä½“ç³»ï¼šwx:å¾®ä¿¡ï¼Œqqï¼šæ‰‹Q',\n  `platid` BIGINT COMMENT 'ç³»ç»Ÿå¹³å°ï¼š0:IOS,1:Android',\n  `vplayerid` TEXT COMMENT 'ç©å®¶ID',\n  `mode` BIGINT COMMENT 'æ¨¡å¼ID',\n  `modename` TEXT COMMENT 'æ¨¡å¼åç§°',\n  `submode` BIGINT COMMENT 'å­æ¨¡å¼ID',\n  `submodename` TEXT COMMENT 'å­æ¨¡å¼åç§°',\n  `map` BIGINT COMMENT 'åœ°å›¾ID',\n  `mapname` TEXT COMMENT 'åœ°å›¾åç§°',\n  `seasonid` BIGINT COMMENT 'èµ›å­£ID',\n  `seasonname` TEXT COMMENT 'èµ›å­£åç§°',\n  `roundcnt` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ•°',\n  `roundtime` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ—¶é•¿(ç§’)',\n  `survivaltime` BIGINT COMMENT 'å½“æ—¥å­˜æ´»æ—¶é•¿(ç§’)',\n  `firstroundtime` TEXT COMMENT 'å½“æ—¥é¦–æ¬¡å¯¹å±€æ—¶é—´',\n  `device_type` BIGINT COMMENT 'è®¾å¤‡ç±»å‹'\n);\n\nã€å‚è€ƒä¿¡æ¯ã€‘\nä¸»ç©å®šä¹‰ï¼šç”¨æˆ·ç´¯è®¡å¯¹å±€æ—¶é•¿æœ€å¤šçš„ç©æ³•ï¼›\n\nç©æ³•ï¼šä»dws_jordass_mode_roundrecord_diå–\nä»ä¸Šå¾€ä¸‹åŒ¹é…ï¼Œå¦‚æœæ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶ï¼Œåˆ™è¿”å›å¯¹åº”çš„åç§°ï¼Œå¦åˆ™è¿”å›â€œå…¶ä»–æ¨¡å¼â€ã€‚\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ï¼Œä¸”å­æ¨¡å¼åç§°ä»¥â€œCGâ€å¼€å¤´ï¼Œä¸”åœ°å›¾ä¸ºâ€œç¾¤å±¿â€ï¼Œåˆ™è¿”å›â€œä¸»é¢˜ç¾¤å±¿â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œç¾¤å±¿â€ï¼Œåˆ™è¿”å›â€œä¼ ç»Ÿç¾¤å±¿â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œå‡æ—¥ç¾¤å²›â€ï¼Œåˆ™è¿”å›â€œå‡æ—¥ç¾¤å²›â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œè£è€€ä¹‹åŸâ€ï¼Œåˆ™è¿”å›â€œè£è€€ä¹‹åŸâ€ï¼›\nå¦‚æœå­æ¨¡å¼æ˜¯â€œå¹¿åŸŸæˆ˜åœºæ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œå¹¿åŸŸæˆ˜åœºâ€ï¼›\nå¦‚æœå­æ¨¡å¼æ˜¯â€œæèƒ½å½¢æ€æ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œæèƒ½å½¢æ€â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œç»„é˜Ÿç«æŠ€â€ï¼Œåˆ™è¿”å›â€œç»„ç«â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œä¼‘é—²æ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œä¼‘é—²â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œä¹å›­â€ï¼Œåˆ™è¿”å›â€œä¹å›­â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œé¢†åœ°â€ï¼Œåˆ™è¿”å›â€œé¢†åœ°â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œå¹¿é˜”å¤©åœ°â€ï¼Œåˆ™è¿”å›â€œå¹¿é˜”å¤©åœ°â€\n\næ³¨æ„ï¼Œå‚ä¸éš§é“æ¨¡å¼çš„ç”¨æˆ·æ•°æ®ä»dwd_jordass_playerexitgamerecord_hiå–ï¼Œæ—¶é—´é™åˆ¶ 2024.6.18-2025.3.30ï¼Œmode in (3001, 3002, 3003)\n\n",
  "chosen": "with main_user as (\n    select substr(dtstatdate, 1, 6) mons,\n        case\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and submodename like 'CG%' and mapname = 'ç¾¤å±¿' then 'ä¸»é¢˜ç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'ç¾¤å±¿' then 'ä¼ ç»Ÿç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'å‡æ—¥ç¾¤å²›' then 'å‡æ—¥ç¾¤å²›'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'è£è€€ä¹‹åŸ' then 'è£è€€ä¹‹åŸ'\n            when submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' then 'å¹¿åŸŸæˆ˜åœº'\n            when submodename = 'æèƒ½å½¢æ€æ¨¡å¼' then 'æèƒ½å½¢æ€'\n            when modename = 'ç»„é˜Ÿç«æŠ€' then 'ç»„ç«'\n            when modename = 'ä¹å›­' then 'ä¹å›­'\n            when modename = 'é¢†åœ°' then 'é¢†åœ°'\n            when modename = 'å¹¿é˜”å¤©åœ°' then 'å¹¿é˜”å¤©åœ°'\n            else 'å…¶ä»–æ¨¡å¼'\n        end imodename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        sum(roundcnt) roundcnt\n   from dws_jordass_mode_roundrecord_di\n   where dtstatdate between '20190508' and '20250330'\n   group by vplayerid, substr(dtstatdate, 1, 6),\n        case\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and submodename like 'CG%' and mapname = 'ç¾¤å±¿' then 'ä¸»é¢˜ç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'ç¾¤å±¿' then 'ä¼ ç»Ÿç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'å‡æ—¥ç¾¤å²›' then 'å‡æ—¥ç¾¤å²›'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'è£è€€ä¹‹åŸ' then 'è£è€€ä¹‹åŸ'\n            when submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' then 'å¹¿åŸŸæˆ˜åœº'\n            when submodename = 'æèƒ½å½¢æ€æ¨¡å¼' then 'æèƒ½å½¢æ€'\n            when modename = 'ç»„é˜Ÿç«æŠ€' then 'ç»„ç«'\n            when modename = 'ä¹å›­' then 'ä¹å›­'\n            when modename = 'é¢†åœ°' then 'é¢†åœ°'\n            when modename = 'å¹¿é˜”å¤©åœ°' then 'å¹¿é˜”å¤©åœ°'\n            else 'å…¶ä»–æ¨¡å¼'\n        end\n\n   union all\n   \n   select substr (tdbank_imp_date, 1, 6) mons,\n        'éš§é“' as modename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        count(distinct gameid) roundcnt\n   from dwd_jordass_playerexitgamerecord_hi\n   where tdbank_imp_date between '2024061800' and '2025033023'\n     and mode in (3001, 3002, 3003)\n   group by substr (tdbank_imp_date, 1, 6), vplayerid\n)\n\nselect a.mons,\n       a.imodename,\n       a.iusernum,\n       b.iusernumall\nfrom (\n    select mons,\n          imodename,\n          count(vplayerid) iusernum\n    from (\n        select mons, vplayerid, imodename\n        from (\n            select mons,\n                vplayerid,\n                imodename,\n                roundtime,\n                row_number() over (partition by mons, vplayerid order by roundtime desc) as rn\n            from main_user\n        )ff1\n        where rn = 1\n    )f1\n   group by mons, imodename\n) a\nleft join (\n    select mons,\n        imodename,\n        count(vplayerid) iusernumall\n   from main_user\n   group by mons, imodename\n) b \non a.imodename = b.imodename and a.mons = b.mons\norder by a.mons, a.imodename\n;",
  "rejected": "æˆ‘ä»¬æ¥ä¸€æ­¥ä¸€æ­¥åˆ†æå’Œæ„å»ºè¿™ä¸ª SQL æŸ¥è¯¢è¯­å¥ã€‚\n\n---\n\n## âœ… **ç›®æ ‡**\nç»Ÿè®¡ä» **2019å¹´5æœˆ8æ—¥ åˆ° 2025å¹´3æœˆ30æ—¥** æ¯ä¸ªæœˆä»½ï¼ˆæ ¼å¼ä¸º `YYYYMM`ï¼‰çš„ï¼š\n- ä¸»ç©ç©æ³•ï¼ˆæ ¹æ®ç´¯è®¡å¯¹å±€æ—¶é•¿ï¼‰\n- ä¸»ç©äººæ•°\n- æ€»å‚ä¸äººæ•°\n\n---\n\n## ğŸ§  **ç†è§£éœ€æ±‚**\n\n### æ•°æ®æ¥æº\n1. `dws_jordass_mode_roundrecord_di` è¡¨æä¾›å¸¸è§„ç©æ³•çš„æ•°æ®ã€‚\n2. éš§é“æ¨¡å¼ (`mode IN (3001, 3002, 3003)`) çš„æ•°æ®æ¥è‡ªï¼š\n   - `dwd_jordass_playerexitgamerecord_hi`\n   - æ—¶é—´èŒƒå›´ï¼š2024å¹´6æœˆ18æ—¥ è‡³ 2025å¹´3æœˆ30æ—¥\n\n---\n\n## ğŸ” **å…³é”®æ­¥éª¤**\n\n### ç¬¬ä¸€æ­¥ï¼šå¤„ç†ä¸»ç©ç©æ³•é€»è¾‘\næˆ‘ä»¬è¦å¯¹æ¯ä¸ªç©å®¶åœ¨æ¯ä¸ªæœˆçš„ç©æ³•è¿›è¡Œç»Ÿè®¡ï¼Œå¹¶æ‰¾å‡ºå…¶ç´¯è®¡å¯¹å±€æ—¶é•¿æœ€å¤šçš„ä¸€ä¸ªç©æ³•ä½œä¸ºâ€œä¸»ç©â€ã€‚\n\n#### å¯¹äº `dws_jordass_mode_roundrecord_di` ä¸­çš„æ•°æ®ï¼š\n\næˆ‘ä»¬éœ€è¦æŒ‰æœˆã€ç©å®¶ã€ç©æ³•ï¼ˆmode + submode + mapï¼‰èšåˆå¯¹å±€æ—¶é•¿ã€‚\n\nç„¶åä½¿ç”¨çª—å£å‡½æ•°é€‰å‡ºæ¯ä¸ªç©å®¶æ¯æœˆçš„ä¸»ç©ç©æ³•ã€‚\n\n#### å¤„ç†è§„åˆ™å¦‚ä¸‹ï¼š\n\n```sql\nCASE \n    WHEN mode = 1 AND submodename LIKE 'CG%' AND mapname = 'ç¾¤å±¿' THEN 'ä¸»é¢˜ç¾¤å±¿'\n    WHEN mode = 1 AND mapname = 'ç¾¤å±¿' THEN 'ä¼ ç»Ÿç¾¤å±¿'\n    WHEN mode = 1 AND mapname = 'å‡æ—¥ç¾¤å²›' THEN 'å‡æ—¥ç¾¤å²›'\n    WHEN mode = 1 AND mapname = 'è£è€€ä¹‹åŸ' THEN 'è£è€€ä¹‹åŸ'\n    WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n    WHEN submodename = 'æèƒ½å½¢æ€æ¨¡å¼' THEN 'æèƒ½å½¢æ€'\n    WHEN mode = 10 THEN 'ç»„ç«'\n    WHEN mode = 11 THEN 'ä¼‘é—²'\n    WHEN mode = 12 THEN 'ä¹å›­'\n    WHEN mode = 13 THEN 'é¢†åœ°'\n    WHEN mode = 14 THEN 'å¹¿é˜”å¤©åœ°'\n    ELSE 'å…¶ä»–æ¨¡å¼'\nEND AS playtype\n```\n\n> æ³¨æ„ï¼šè¿™é‡Œçš„ `mode`, `submodename`, `mapname` å­—æ®µéƒ½æ¥è‡ª `dws_jordass_mode_roundrecord_di`\n\n---\n\n### ç¬¬äºŒæ­¥ï¼šå¤„ç†éš§é“æ¨¡å¼ï¼ˆæ¥è‡ª `dwd_jordass_playerexitgamerecord_hi`ï¼‰\n\n- æ—¶é—´èŒƒå›´ï¼š`2024-06-18` ~ `2025-03-30`\n- mode in (3001, 3002, 3003)\n- ä½¿ç”¨ `roundtime` ä½œä¸ºå¯¹å±€æ—¶é•¿\n- ç©æ³•ç»Ÿä¸€æ ‡è®°ä¸º â€œéš§é“æ¨¡å¼â€\n- ä¹Ÿè¦æŒ‰ç…§æœˆä»½åˆ†ç»„\n\n---\n\n### ç¬¬ä¸‰æ­¥ï¼šåˆå¹¶ä¸¤ä¸ªè¡¨çš„ç»“æœ\n\nå°†ä¸¤éƒ¨åˆ†æ•°æ®åˆå¹¶åï¼Œå†æŒ‰æœˆä»½åˆ†ç»„ï¼Œè®¡ç®—ï¼š\n- æ¯ä¸ªç©æ³•çš„æ€»å¯¹å±€æ—¶é•¿\n- ä¸»ç©ç©æ³•æ˜¯è°ï¼ˆå³ç´¯è®¡æ—¶é•¿æœ€å¤§çš„é‚£ä¸ªï¼‰\n- ç»Ÿè®¡ä¸»ç©äººæ•°\n- æ€»å‚ä¸äººæ•°\n\n---\n\n## ğŸ› ï¸ **æœ€ç»ˆ SQL å®ç°**\n\n```sql\nWITH base_data AS (\n    -- å¸¸è§„ç©æ³•\n    SELECT \n        DATE_FORMAT(STR_TO_DATE(dtstatdate, '%Y%m%d'), '%Y%m') AS month,\n        vplayerid,\n        CASE \n            WHEN mode = 1 AND submodename LIKE 'CG%' AND mapname = 'ç¾¤å±¿' THEN 'ä¸»é¢˜ç¾¤å±¿'\n            WHEN mode = 1 AND mapname = 'ç¾¤å±¿' THEN 'ä¼ ç»Ÿç¾¤å±¿'\n            WHEN mode = 1 AND mapname = 'å‡æ—¥ç¾¤å²›' THEN 'å‡æ—¥ç¾¤å²›'\n            WHEN mode = 1 AND mapname = 'è£è€€ä¹‹åŸ' THEN 'è£è€€ä¹‹åŸ'\n            WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n            WHEN submodename = 'æèƒ½å½¢æ€æ¨¡å¼' THEN 'æèƒ½å½¢æ€'\n            WHEN mode = 10 THEN 'ç»„ç«'\n            WHEN mode = 11 THEN 'ä¼‘é—²'\n            WHEN mode = 12 THEN 'ä¹å›­'\n            WHEN mode = 13 THEN 'é¢†åœ°'\n            WHEN mode = 14 THEN 'å¹¿é˜”å¤©åœ°'\n            ELSE 'å…¶ä»–æ¨¡å¼'\n        END AS playtype,\n        roundtime AS duration\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE STR_TO_DATE(dtstatdate, '%Y%m%d') BETWEEN '2019-05-08' AND '2025-03-30'\n\n    UNION ALL\n\n    -- éš§é“æ¨¡å¼\n    SELECT \n        DATE_FORMAT(STR_TO_DATE(tdbank_imp_date, '%Y-%m-%d'), '%Y%m') AS month,\n        vplayerid,\n        'éš§é“æ¨¡å¼' AS playtype,\n        roundtime AS duration\n    FROM dwd_jordass_playerexitgamerecord_hi\n    WHERE tdbank_imp_date BETWEEN '2024-06-18' AND '2025-03-30'\n      AND mode IN (3001, 3002, 3003)\n),\n\nmonthly_play_duration AS (\n    SELECT \n        month,\n        playtype,\n        SUM(duration) AS total_duration,\n        COUNT(DISTINCT vplayerid) AS player_count\n    FROM base_data\n    GROUP BY month, playtype\n),\n\ntop_play_per_month AS (\n    SELECT \n        month,\n        playtype,\n        total_duration,\n        player_count,\n        ROW_NUMBER() OVER (PARTITION BY month ORDER BY total_duration DESC) AS rn\n    FROM monthly_play_duration\n)\n\nSELECT \n    month,\n    playtype AS ä¸»ç©ç©æ³•,\n    player_count AS ä¸»ç©äººæ•°,\n    SUM(player_count) OVER (PARTITION BY month) AS æ€»å‚ä¸äººæ•°\nFROM top_play_per_month\nWHERE rn = 1\nORDER BY month;\n```\n\n---\n\n## ğŸ“Œ è¾“å‡ºå­—æ®µè¯´æ˜\n\n| å­—æ®µå       | å«ä¹‰                 |\n|--------------|----------------------|\n| `month`      | åˆ†æœˆï¼ˆå¦‚ 201905ï¼‰     |\n| `ä¸»ç©ç©æ³•`   | å½“æœˆä¸»ç©ç©æ³•         |\n| `ä¸»ç©äººæ•°`   | è¯¥ç©æ³•ä¸‹ä¸»ç©çš„äººæ•°   |\n| `æ€»å‚ä¸äººæ•°` | å½“æœˆæ‰€æœ‰ç©æ³•çš„å‚ä¸äººæ•°ä¹‹å’Œ |\n\n---\n\n## ğŸ§ª ç¤ºä¾‹è¾“å‡º\n\n| month  | ä¸»ç©ç©æ³•   | ä¸»ç©äººæ•° | æ€»å‚ä¸äººæ•° |\n|--------|------------|----------|-------------|\n| 201905 | å¹¿åŸŸæˆ˜åœº   | 1200     | 2500        |\n| 201906 | ç»„ç«       | 1800     | 3200        |\n| ...    | ...        | ...      | ...         |\n\n---\n\nå¦‚æœä½ æœ‰æ›´å¤šå…·ä½“è¦æ±‚æˆ–å¸Œæœ›ä¼˜åŒ–æ€§èƒ½ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼"
},
{
  "instruction": "è¯·ä½ æ¥ä¸‹æ¥ä¸€æ­¥æ­¥æ€è€ƒï¼Œå†™å‡ºæ­£ç¡®çš„SQLæŸ¥è¯¢è¯­å¥ä»¥æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚",
  "input": "ä½ æ˜¯ä¸€åMySQLä¸“å®¶ï¼Œç°åœ¨éœ€è¦é˜…è¯»å¹¶ç†è§£ä¸‹é¢çš„ã€æ•°æ®åº“schemaã€‘æè¿°ï¼Œä»¥åŠå¯èƒ½ç”¨åˆ°çš„ã€å‚è€ƒä¿¡æ¯ã€‘ï¼Œå¹¶è¿ç”¨MySQLçŸ¥è¯†ç”Ÿæˆsqlè¯­å¥å›ç­”ã€ç”¨æˆ·é—®é¢˜ã€‘ã€‚\nã€ç”¨æˆ·é—®é¢˜ã€‘\nç»Ÿè®¡2019.5.8è‡³2025.3.30 åˆ†æœˆçš„ç©æ³•ä¸»ç©æƒ…å†µ\nè¾“å‡ºï¼šæœˆä»½(201905ã€201906ã€...ã€202503)ã€ä¸»ç©ç©æ³•ã€ä¸»ç©äººæ•°ã€æ€»å‚ä¸äººæ•°\n\nã€æ•°æ®åº“schemaã€‘\nCREATE TABLE `dwd_jordass_playerexitgamerecord_hi` (\n  `tdbank_imp_date` TEXT,\n  `gamesvrid` TEXT COMMENT 'ç™»å½•çš„æ¸¸æˆæœåŠ¡å™¨ç¼–å·',\n  `dteventtime` TEXT COMMENT 'æ¸¸æˆäº‹ä»¶çš„æ—¶é—´, æ ¼å¼ YYYY-MM-DD HH:MM:SS',\n  `vgameappid` TEXT COMMENT 'æ¸¸æˆAPPID',\n  `platid` BIGINT COMMENT 'ios 0/android 1',\n  `izoneareaid` BIGINT COMMENT 'é’ˆå¯¹åˆ†åŒºåˆ†æœçš„æ¸¸æˆå¡«å†™åˆ†åŒºidï¼Œç”¨æ¥å”¯ä¸€æ ‡ç¤ºä¸€ä¸ªåŒºï¼›éåˆ†åŒºåˆ†æœæ¸¸æˆè¯·å¡«å†™0',\n  `vplayerid` TEXT COMMENT 'ç”¨æˆ·playeridå·',\n  `uid` TEXT COMMENT 'è§’è‰²UID',\n  `gameid` TEXT COMMENT 'æœ¬å±€æ¸¸æˆID',\n  `exitreason` TEXT COMMENT 'é€€å‡ºåŸå› ',\n  `isallianceforceeescape` BIGINT COMMENT 'é€ƒè·‘æ—¶æ˜¯å¦å®‰å…¨çš„ å¦:0/æ˜¯:1',\n  `escapebantype` BIGINT COMMENT 'æœ¬æ¬¡é€€å‡ºæ˜¯å¦è§¦å‘ç¦èµ›é™åˆ¶ï¼Œ0=æ²¡æœ‰è§¦å‘ï¼›1=è§¦å‘é™åˆ¶ä¸€ï¼›2=è§¦å‘é™åˆ¶äºŒï¼›3=è§¦å‘é™åˆ¶ä¸‰',\n  `gamestate` TEXT COMMENT 'é€€å‡ºæ—¶å¯¹å±€çŠ¶æ€ï¼šActiveæ˜¯åœ¨å‡ºç”Ÿå²›ä¹‹å‰ï¼ŒReadyæ˜¯åœ¨å‡ºç”Ÿå²›ï¼ŒFightingæ˜¯åŒ…æ‹¬4äººé›†ç»“ã€ä¸Šé£æœºã€è·³ä¼æˆ˜æ–—è¿™äº›é˜¶æ®µï¼ŒFinish æ­»äº¡/èƒœåˆ©ç»“æŸ',\n  `submodegroup` BIGINT COMMENT 'æ¨¡å¼ç»„ID',\n  `lobbyexitreason` TEXT COMMENT 'å¤§å…è®°å½•çš„é€€å‡ºåŸå› ',\n  `mode` BIGINT COMMENT 'æ¨¡å¼ID',\n  `submode` BIGINT COMMENT 'å­æ¨¡å¼ID',\n  `roundtime` BIGINT COMMENT 'å¯¹å±€æ—¶é•¿'\n);\nCREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` TEXT COMMENT 'ç»Ÿè®¡æ—¥æœŸæ ¼å¼YYYYMMDD',\n  `vgameappid` TEXT COMMENT 'è´¦å·ä½“ç³»ï¼šwx:å¾®ä¿¡ï¼Œqqï¼šæ‰‹Q',\n  `platid` BIGINT COMMENT 'ç³»ç»Ÿå¹³å°ï¼š0:IOS,1:Android',\n  `vplayerid` TEXT COMMENT 'ç©å®¶ID',\n  `mode` BIGINT COMMENT 'æ¨¡å¼ID',\n  `modename` TEXT COMMENT 'æ¨¡å¼åç§°',\n  `submode` BIGINT COMMENT 'å­æ¨¡å¼ID',\n  `submodename` TEXT COMMENT 'å­æ¨¡å¼åç§°',\n  `map` BIGINT COMMENT 'åœ°å›¾ID',\n  `mapname` TEXT COMMENT 'åœ°å›¾åç§°',\n  `seasonid` BIGINT COMMENT 'èµ›å­£ID',\n  `seasonname` TEXT COMMENT 'èµ›å­£åç§°',\n  `roundcnt` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ•°',\n  `roundtime` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ—¶é•¿(ç§’)',\n  `survivaltime` BIGINT COMMENT 'å½“æ—¥å­˜æ´»æ—¶é•¿(ç§’)',\n  `firstroundtime` TEXT COMMENT 'å½“æ—¥é¦–æ¬¡å¯¹å±€æ—¶é—´',\n  `device_type` BIGINT COMMENT 'è®¾å¤‡ç±»å‹'\n);\n\nã€å‚è€ƒä¿¡æ¯ã€‘\nä¸»ç©å®šä¹‰ï¼šç”¨æˆ·ç´¯è®¡å¯¹å±€æ—¶é•¿æœ€å¤šçš„ç©æ³•ï¼›\n\nç©æ³•ï¼šä»dws_jordass_mode_roundrecord_diå–\nä»ä¸Šå¾€ä¸‹åŒ¹é…ï¼Œå¦‚æœæ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶ï¼Œåˆ™è¿”å›å¯¹åº”çš„åç§°ï¼Œå¦åˆ™è¿”å›â€œå…¶ä»–æ¨¡å¼â€ã€‚\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ï¼Œä¸”å­æ¨¡å¼åç§°ä»¥â€œCGâ€å¼€å¤´ï¼Œä¸”åœ°å›¾ä¸ºâ€œç¾¤å±¿â€ï¼Œåˆ™è¿”å›â€œä¸»é¢˜ç¾¤å±¿â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œç¾¤å±¿â€ï¼Œåˆ™è¿”å›â€œä¼ ç»Ÿç¾¤å±¿â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œå‡æ—¥ç¾¤å²›â€ï¼Œåˆ™è¿”å›â€œå‡æ—¥ç¾¤å²›â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œè£è€€ä¹‹åŸâ€ï¼Œåˆ™è¿”å›â€œè£è€€ä¹‹åŸâ€ï¼›\nå¦‚æœå­æ¨¡å¼æ˜¯â€œå¹¿åŸŸæˆ˜åœºæ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œå¹¿åŸŸæˆ˜åœºâ€ï¼›\nå¦‚æœå­æ¨¡å¼æ˜¯â€œæèƒ½å½¢æ€æ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œæèƒ½å½¢æ€â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œç»„é˜Ÿç«æŠ€â€ï¼Œåˆ™è¿”å›â€œç»„ç«â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œä¼‘é—²æ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œä¼‘é—²â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œä¹å›­â€ï¼Œåˆ™è¿”å›â€œä¹å›­â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œé¢†åœ°â€ï¼Œåˆ™è¿”å›â€œé¢†åœ°â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œå¹¿é˜”å¤©åœ°â€ï¼Œåˆ™è¿”å›â€œå¹¿é˜”å¤©åœ°â€\n\næ³¨æ„ï¼Œå‚ä¸éš§é“æ¨¡å¼çš„ç”¨æˆ·æ•°æ®ä»dwd_jordass_playerexitgamerecord_hiå–ï¼Œæ—¶é—´é™åˆ¶ 2024.6.18-2025.3.30ï¼Œmode in (3001, 3002, 3003)\n\n",
  "chosen": "with main_user as (\n    select substr(dtstatdate, 1, 6) mons,\n        case\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and submodename like 'CG%' and mapname = 'ç¾¤å±¿' then 'ä¸»é¢˜ç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'ç¾¤å±¿' then 'ä¼ ç»Ÿç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'å‡æ—¥ç¾¤å²›' then 'å‡æ—¥ç¾¤å²›'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'è£è€€ä¹‹åŸ' then 'è£è€€ä¹‹åŸ'\n            when submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' then 'å¹¿åŸŸæˆ˜åœº'\n            when submodename = 'æèƒ½å½¢æ€æ¨¡å¼' then 'æèƒ½å½¢æ€'\n            when modename = 'ç»„é˜Ÿç«æŠ€' then 'ç»„ç«'\n            when modename = 'ä¹å›­' then 'ä¹å›­'\n            when modename = 'é¢†åœ°' then 'é¢†åœ°'\n            when modename = 'å¹¿é˜”å¤©åœ°' then 'å¹¿é˜”å¤©åœ°'\n            else 'å…¶ä»–æ¨¡å¼'\n        end imodename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        sum(roundcnt) roundcnt\n   from dws_jordass_mode_roundrecord_di\n   where dtstatdate between '20190508' and '20250330'\n   group by vplayerid, substr(dtstatdate, 1, 6),\n        case\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and submodename like 'CG%' and mapname = 'ç¾¤å±¿' then 'ä¸»é¢˜ç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'ç¾¤å±¿' then 'ä¼ ç»Ÿç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'å‡æ—¥ç¾¤å²›' then 'å‡æ—¥ç¾¤å²›'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'è£è€€ä¹‹åŸ' then 'è£è€€ä¹‹åŸ'\n            when submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' then 'å¹¿åŸŸæˆ˜åœº'\n            when submodename = 'æèƒ½å½¢æ€æ¨¡å¼' then 'æèƒ½å½¢æ€'\n            when modename = 'ç»„é˜Ÿç«æŠ€' then 'ç»„ç«'\n            when modename = 'ä¹å›­' then 'ä¹å›­'\n            when modename = 'é¢†åœ°' then 'é¢†åœ°'\n            when modename = 'å¹¿é˜”å¤©åœ°' then 'å¹¿é˜”å¤©åœ°'\n            else 'å…¶ä»–æ¨¡å¼'\n        end\n\n   union all\n   \n   select substr (tdbank_imp_date, 1, 6) mons,\n        'éš§é“' as modename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        count(distinct gameid) roundcnt\n   from dwd_jordass_playerexitgamerecord_hi\n   where tdbank_imp_date between '2024061800' and '2025033023'\n     and mode in (3001, 3002, 3003)\n   group by substr (tdbank_imp_date, 1, 6), vplayerid\n)\n\nselect a.mons,\n       a.imodename,\n       a.iusernum,\n       b.iusernumall\nfrom (\n    select mons,\n          imodename,\n          count(vplayerid) iusernum\n    from (\n        select mons, vplayerid, imodename\n        from (\n            select mons,\n                vplayerid,\n                imodename,\n                roundtime,\n                row_number() over (partition by mons, vplayerid order by roundtime desc) as rn\n            from main_user\n        )ff1\n        where rn = 1\n    )f1\n   group by mons, imodename\n) a\nleft join (\n    select mons,\n        imodename,\n        count(vplayerid) iusernumall\n   from main_user\n   group by mons, imodename\n) b \non a.imodename = b.imodename and a.mons = b.mons\norder by a.mons, a.imodename\n;",
  "rejected": "æˆ‘ä»¬æ¥ä¸€æ­¥ä¸€æ­¥åˆ†æè¿™ä¸ªéœ€æ±‚ï¼Œå¹¶æ„é€ å‡ºæ­£ç¡®çš„ SQL æŸ¥è¯¢è¯­å¥ã€‚\n\n---\n\n## ğŸ§  **ç¬¬ä¸€æ­¥ï¼šç†è§£ç”¨æˆ·é—®é¢˜**\n\næˆ‘ä»¬è¦ç»Ÿè®¡çš„æ˜¯ï¼š\n\n> **ä» 2019.5.8 åˆ° 2025.3.30 æ¯ä¸ªæœˆä»½çš„ç©æ³•ä¸»ç©æƒ…å†µ**\n>\n> è¾“å‡ºå­—æ®µï¼š\n- æœˆä»½ï¼ˆæ ¼å¼ï¼š`YYYYMM`ï¼‰\n- ä¸»ç©ç©æ³•ï¼ˆå³è¯¥æœˆç´¯è®¡å¯¹å±€æ—¶é•¿æœ€å¤šçš„ç©æ³•ï¼‰\n- ä¸»ç©äººæ•°ï¼ˆè¯¥ç©æ³•çš„ç”¨æˆ·æ•°ï¼‰\n- æ€»å‚ä¸äººæ•°ï¼ˆè¯¥æœˆæ‰€æœ‰ç”¨æˆ·çš„æ•°é‡ï¼‰\n\n---\n\n## ğŸ§± **ç¬¬äºŒæ­¥ï¼šç†è§£æ•°æ®åº“ç»“æ„ä¸æ•°æ®æ¥æº**\n\n### æ•°æ®è¡¨è¯´æ˜ï¼š\n\n#### è¡¨1ï¼š`dwd_jordass_playerexitgamerecord_hi`\n- åŒ…å«ç©å®¶é€€å‡ºæ¸¸æˆè®°å½•\n- æ—¶é—´èŒƒå›´ï¼š**2024.6.18 è‡³ 2025.3.30**\n- åªå¤„ç† mode in (3001, 3002, 3003)\n- å­—æ®µä¸­åŒ…å« `dteventtime`, `vplayerid`, `mode`\n\n#### è¡¨2ï¼š`dws_jordass_mode_roundrecord_di`\n- åŒ…å«æ¯æ—¥æ¯ä¸ªç©å®¶åœ¨ä¸åŒç©æ³•ä¸‹çš„å¯¹å±€æ•°æ®\n- åŒ…å« `dtstatdate`, `vplayerid`, `mode`, `modename`, `roundtime`\n- æ—¶é—´èŒƒå›´ï¼š**2019.5.8 åˆ° 2024.6.17**\n- ç”¨äºè·å–ä¸»ç©ç©æ³•é€»è¾‘å’Œå¯¹å±€æ—¶é•¿\n\n---\n\n## ğŸ“Œ **ç¬¬ä¸‰æ­¥ï¼šæ˜ç¡®ä¸»ç©ç©æ³•å®šä¹‰**\n\næ ¹æ®é¢˜ç›®æè¿°ï¼Œâ€œä¸»ç©ç©æ³•â€æ˜¯**ç”¨æˆ·ç´¯è®¡å¯¹å±€æ—¶é•¿æœ€å¤šçš„ç©æ³•**ã€‚  \nä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦ï¼š\n\n1. å¯¹æ¯ä¸ªç”¨æˆ·ï¼Œåœ¨æ¯ä¸ªæœˆå†…ï¼ŒæŒ‰ç©æ³•ç»Ÿè®¡å…¶å¯¹å±€æ—¶é•¿ï¼ˆsum(roundtime)ï¼‰\n2. æ‰¾å‡ºæ¯ä¸ªç”¨æˆ·åœ¨è¯¥æœˆä¸­çš„ä¸»ç©ç©æ³•ï¼ˆå³å¯¹å±€æ—¶é•¿æœ€å¤§è€…ï¼‰\n3. ç»Ÿè®¡æ¯ä¸ªç©æ³•çš„ä¸»ç©äººæ•°ï¼ˆå³æœ‰å¤šå°‘ä¸ªç”¨æˆ·å°†æ­¤ç©æ³•ä½œä¸ºä¸»ç©ï¼‰\n4. ç»Ÿè®¡è¯¥æœˆæ€»å‚ä¸äººæ•°ï¼ˆå»é‡åçš„ vplayerid æ•°é‡ï¼‰\n\n---\n\n## ğŸ” **ç¬¬å››æ­¥ï¼šæ‹†è§£ä»»åŠ¡**\n\n### âœ… ä»»åŠ¡1ï¼šæ„å»ºæ¯æœˆçš„æ•°æ®æºï¼ˆ2019.5.8 ~ 2025.3.30ï¼‰\n\næˆ‘ä»¬éœ€è¦ä¸¤ä¸ªæ•°æ®æºåˆå¹¶ï¼š\n\n- ä» `dws_jordass_mode_roundrecord_di` ä¸­æå– 2019.5.8 ~ 2024.6.17 çš„æ•°æ®\n- ä» `dwd_jordass_playerexitgamerecord_hi` ä¸­æå– 2024.6.18 ~ 2025.3.30 çš„æ•°æ®ï¼ˆmode in (3001, 3002, 3003)ï¼‰\n\nç„¶åç»Ÿä¸€å¤„ç†æˆç»Ÿä¸€æ ¼å¼ï¼š\n\n```sql\nSELECT \n    DATE_FORMAT(dteventtime, '%Y%m') AS month,\n    vplayerid,\n    mode,\n    roundtime\nFROM dwd_jordass_playerexitgamerecord_hi\nWHERE dteventtime >= '2024-06-18' AND dteventtime <= '2025-03-30'\nAND mode IN (3001, 3002, 3003)\n\nUNION ALL\n\nSELECT \n    dtstatdate AS month,\n    vplayerid,\n    mode,\n    roundtime\nFROM dws_jordass_mode_roundrecord_di\nWHERE dtstatdate >= '20190508' AND dtstatdate <= '20240617'\n```\n\n> âš ï¸ æ³¨æ„ï¼šä¸Šé¢çš„ `roundtime` æ˜¯å¯¹å±€æ—¶é•¿ï¼Œå•ä½ä¸ºç§’ï¼Œéœ€è¦åš sum\n\n---\n\n## ğŸ§® **ç¬¬äº”æ­¥ï¼šå®šä¹‰ç©æ³•æ˜ å°„è§„åˆ™**\n\næˆ‘ä»¬éœ€è¦æ ¹æ® `mode` å’Œ `submode` ç­‰å­—æ®µæ¥åˆ¤æ–­ç©æ³•åç§°ï¼Œä½¿ç”¨ CASE WHEN å®ç°ï¼š\n\n```sql\nCASE\n    WHEN mode = 1 AND submodename LIKE 'CG%' AND mapname = 'ç¾¤å±¿' THEN 'ä¸»é¢˜ç¾¤å±¿'\n    WHEN mode = 1 AND mapname = 'ç¾¤å±¿' THEN 'ä¼ ç»Ÿç¾¤å±¿'\n    WHEN mode = 1 AND mapname = 'å‡æ—¥ç¾¤å²›' THEN 'å‡æ—¥ç¾¤å²›'\n    WHEN mode = 1 AND mapname = 'è£è€€ä¹‹åŸ' THEN 'è£è€€ä¹‹åŸ'\n    WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n    WHEN submodename = 'æèƒ½å½¢æ€æ¨¡å¼' THEN 'æèƒ½å½¢æ€'\n    WHEN mode = 2 THEN 'ç»„ç«'\n    WHEN mode = 3 THEN 'ä¼‘é—²'\n    WHEN mode = 4 THEN 'ä¹å›­'\n    WHEN mode = 5 THEN 'é¢†åœ°'\n    WHEN mode = 6 THEN 'å¹¿é˜”å¤©åœ°'\n    ELSE 'å…¶ä»–æ¨¡å¼'\nEND AS play_mode\n```\n\n---\n\n## ğŸ§© **ç¬¬å…­æ­¥ï¼šæ•´åˆé€»è¾‘**\n\næˆ‘ä»¬å°†ä¸Šè¿°å†…å®¹æ•´åˆä¸ºå®Œæ•´çš„ SQL æŸ¥è¯¢æµç¨‹å¦‚ä¸‹ï¼š\n\n---\n\n## âœ… æœ€ç»ˆ SQL æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š\n\n```sql\nWITH monthly_data AS (\n    -- ç¬¬ä¸€éƒ¨åˆ†ï¼š2019.5.8 ~ 2024.6.17 çš„æ•°æ®ï¼ˆæ¥è‡ª dws_jordass_mode_roundrecord_diï¼‰\n    SELECT \n        dtstatdate AS month,\n        vplayerid,\n        mode,\n        modename,\n        roundtime\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE dtstatdate >= '20190508' AND dtstatdate <= '20240617'\n\n    UNION ALL\n\n    -- ç¬¬äºŒéƒ¨åˆ†ï¼š2024.6.18 ~ 2025.3.30 çš„æ•°æ®ï¼ˆæ¥è‡ª dwd_jordass_playerexitgamerecord_hiï¼‰\n    SELECT \n        DATE_FORMAT(dteventtime, '%Y%m') AS month,\n        vplayerid,\n        mode,\n        NULL AS modename,\n        roundtime\n    FROM dwd_jordass_playerexitgamerecord_hi\n    WHERE dteventtime >= '2024-06-18' AND dteventtime <= '2025-03-30'\n      AND mode IN (3001, 3002, 3003)\n),\n\n-- æ˜ å°„ç©æ³•åç§°\nmapped_modes AS (\n    SELECT \n        month,\n        vplayerid,\n        CASE\n            WHEN mode = 1 AND submodename LIKE 'CG%' AND mapname = 'ç¾¤å±¿' THEN 'ä¸»é¢˜ç¾¤å±¿'\n            WHEN mode = 1 AND mapname = 'ç¾¤å±¿' THEN 'ä¼ ç»Ÿç¾¤å±¿'\n            WHEN mode = 1 AND mapname = 'å‡æ—¥ç¾¤å²›' THEN 'å‡æ—¥ç¾¤å²›'\n            WHEN mode = 1 AND mapname = 'è£è€€ä¹‹åŸ' THEN 'è£è€€ä¹‹åŸ'\n            WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n            WHEN submodename = 'æèƒ½å½¢æ€æ¨¡å¼' THEN 'æèƒ½å½¢æ€'\n            WHEN mode = 2 THEN 'ç»„ç«'\n            WHEN mode = 3 THEN 'ä¼‘é—²'\n            WHEN mode = 4 THEN 'ä¹å›­'\n            WHEN mode = 5 THEN 'é¢†åœ°'\n            WHEN mode = 6 THEN 'å¹¿é˜”å¤©åœ°'\n            ELSE 'å…¶ä»–æ¨¡å¼'\n        END AS play_mode,\n        roundtime\n    FROM monthly_data m\n    LEFT JOIN dws_jordass_mode_roundrecord_di d\n        ON m.vplayerid = d.vplayerid\n        AND m.month = d.dtstatdate\n        AND m.mode = d.mode\n),\n\n-- è®¡ç®—æ¯ä½ç”¨æˆ·åœ¨æ¯æœˆçš„ç©æ³•ç´¯è®¡æ—¶é•¿\nuser_monthly_playtime AS (\n    SELECT \n        month,\n        vplayerid,\n        play_mode,\n        SUM(roundtime) AS total_time\n    FROM mapped_modes\n    GROUP BY month, vplayerid, play_mode\n),\n\n-- æ‰¾å‡ºæ¯ä¸ªç”¨æˆ·æ¯æœˆçš„ä¸»ç©ç©æ³•ï¼ˆç´¯è®¡æ—¶é•¿æœ€å¤šï¼‰\ntop_modes_per_user AS (\n    SELECT \n        month,\n        vplayerid,\n        play_mode,\n        total_time,\n        ROW_NUMBER() OVER (PARTITION BY month, vplayerid ORDER BY total_time DESC) AS rn\n    FROM user_monthly_playtime\n),\n\n-- ç­›é€‰å‡ºä¸»ç©ç©æ³•\nmain_modes AS (\n    SELECT \n        month,\n        play_mode,\n        vplayerid\n    FROM top_modes_per_user\n    WHERE rn = 1\n),\n\n-- ç»Ÿè®¡ä¸»ç©äººæ•° & æ€»å‚ä¸äººæ•°\nfinal_stats AS (\n    SELECT \n        month,\n        play_mode,\n        COUNT(DISTINCT vplayerid) AS main_players,\n        COUNT(DISTINCT vplayerid) OVER (PARTITION BY month) AS total_players\n    FROM main_modes\n    GROUP BY month, play_mode\n)\n\n-- æœ€ç»ˆè¾“å‡ºç»“æœ\nSELECT \n    month,\n    play_mode AS ä¸»ç©ç©æ³•,\n    main_players AS ä¸»ç©äººæ•°,\n    total_players AS æ€»å‚ä¸äººæ•°\nFROM final_stats\nORDER BY month;\n```\n\n---\n\n## ğŸ§¾ **è¾“å‡ºå­—æ®µè§£é‡Š**\n\n| å­—æ®µå | å«ä¹‰ |\n|--------|------|\n| month | æœˆä»½ï¼ˆå¦‚ 201905ï¼‰ |\n| ä¸»ç©ç©æ³• | ç”¨æˆ·åœ¨è¯¥æœˆç´¯è®¡å¯¹å±€æ—¶é—´æœ€é•¿çš„ç©æ³• |\n| ä¸»ç©äººæ•° | ä½¿ç”¨è¯¥ç©æ³•ä½œä¸ºä¸»ç©çš„äººæ•° |\n| æ€»å‚ä¸äººæ•° | è¯¥æœˆæ‰€æœ‰å‚ä¸æ¸¸æˆçš„ç”¨æˆ·æ•° |\n\n---\n\nå¦‚æœä½ è¿˜éœ€è¦å°† `play_mode` æ˜ å°„ä¸ºä¸­æ–‡åç§°æˆ–è¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼"
},
{
  "instruction": "è¯·ä½ æ¥ä¸‹æ¥ä¸€æ­¥æ­¥æ€è€ƒï¼Œå†™å‡ºæ­£ç¡®çš„SQLæŸ¥è¯¢è¯­å¥ä»¥æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚",
  "input": "ä½ æ˜¯ä¸€åMySQLä¸“å®¶ï¼Œç°åœ¨éœ€è¦é˜…è¯»å¹¶ç†è§£ä¸‹é¢çš„ã€æ•°æ®åº“schemaã€‘æè¿°ï¼Œä»¥åŠå¯èƒ½ç”¨åˆ°çš„ã€å‚è€ƒä¿¡æ¯ã€‘ï¼Œå¹¶è¿ç”¨MySQLçŸ¥è¯†ç”Ÿæˆsqlè¯­å¥å›ç­”ã€ç”¨æˆ·é—®é¢˜ã€‘ã€‚\nã€ç”¨æˆ·é—®é¢˜ã€‘\nç»Ÿè®¡2019.5.8è‡³2025.3.30 åˆ†æœˆçš„ç©æ³•ä¸»ç©æƒ…å†µ\nè¾“å‡ºï¼šæœˆä»½(201905ã€201906ã€...ã€202503)ã€ä¸»ç©ç©æ³•ã€ä¸»ç©äººæ•°ã€æ€»å‚ä¸äººæ•°\n\nã€æ•°æ®åº“schemaã€‘\nCREATE TABLE `dwd_jordass_playerexitgamerecord_hi` (\n  `tdbank_imp_date` TEXT,\n  `gamesvrid` TEXT COMMENT 'ç™»å½•çš„æ¸¸æˆæœåŠ¡å™¨ç¼–å·',\n  `dteventtime` TEXT COMMENT 'æ¸¸æˆäº‹ä»¶çš„æ—¶é—´, æ ¼å¼ YYYY-MM-DD HH:MM:SS',\n  `vgameappid` TEXT COMMENT 'æ¸¸æˆAPPID',\n  `platid` BIGINT COMMENT 'ios 0/android 1',\n  `izoneareaid` BIGINT COMMENT 'é’ˆå¯¹åˆ†åŒºåˆ†æœçš„æ¸¸æˆå¡«å†™åˆ†åŒºidï¼Œç”¨æ¥å”¯ä¸€æ ‡ç¤ºä¸€ä¸ªåŒºï¼›éåˆ†åŒºåˆ†æœæ¸¸æˆè¯·å¡«å†™0',\n  `vplayerid` TEXT COMMENT 'ç”¨æˆ·playeridå·',\n  `uid` TEXT COMMENT 'è§’è‰²UID',\n  `gameid` TEXT COMMENT 'æœ¬å±€æ¸¸æˆID',\n  `exitreason` TEXT COMMENT 'é€€å‡ºåŸå› ',\n  `isallianceforceeescape` BIGINT COMMENT 'é€ƒè·‘æ—¶æ˜¯å¦å®‰å…¨çš„ å¦:0/æ˜¯:1',\n  `escapebantype` BIGINT COMMENT 'æœ¬æ¬¡é€€å‡ºæ˜¯å¦è§¦å‘ç¦èµ›é™åˆ¶ï¼Œ0=æ²¡æœ‰è§¦å‘ï¼›1=è§¦å‘é™åˆ¶ä¸€ï¼›2=è§¦å‘é™åˆ¶äºŒï¼›3=è§¦å‘é™åˆ¶ä¸‰',\n  `gamestate` TEXT COMMENT 'é€€å‡ºæ—¶å¯¹å±€çŠ¶æ€ï¼šActiveæ˜¯åœ¨å‡ºç”Ÿå²›ä¹‹å‰ï¼ŒReadyæ˜¯åœ¨å‡ºç”Ÿå²›ï¼ŒFightingæ˜¯åŒ…æ‹¬4äººé›†ç»“ã€ä¸Šé£æœºã€è·³ä¼æˆ˜æ–—è¿™äº›é˜¶æ®µï¼ŒFinish æ­»äº¡/èƒœåˆ©ç»“æŸ',\n  `submodegroup` BIGINT COMMENT 'æ¨¡å¼ç»„ID',\n  `lobbyexitreason` TEXT COMMENT 'å¤§å…è®°å½•çš„é€€å‡ºåŸå› ',\n  `mode` BIGINT COMMENT 'æ¨¡å¼ID',\n  `submode` BIGINT COMMENT 'å­æ¨¡å¼ID',\n  `roundtime` BIGINT COMMENT 'å¯¹å±€æ—¶é•¿'\n);\nCREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` TEXT COMMENT 'ç»Ÿè®¡æ—¥æœŸæ ¼å¼YYYYMMDD',\n  `vgameappid` TEXT COMMENT 'è´¦å·ä½“ç³»ï¼šwx:å¾®ä¿¡ï¼Œqqï¼šæ‰‹Q',\n  `platid` BIGINT COMMENT 'ç³»ç»Ÿå¹³å°ï¼š0:IOS,1:Android',\n  `vplayerid` TEXT COMMENT 'ç©å®¶ID',\n  `mode` BIGINT COMMENT 'æ¨¡å¼ID',\n  `modename` TEXT COMMENT 'æ¨¡å¼åç§°',\n  `submode` BIGINT COMMENT 'å­æ¨¡å¼ID',\n  `submodename` TEXT COMMENT 'å­æ¨¡å¼åç§°',\n  `map` BIGINT COMMENT 'åœ°å›¾ID',\n  `mapname` TEXT COMMENT 'åœ°å›¾åç§°',\n  `seasonid` BIGINT COMMENT 'èµ›å­£ID',\n  `seasonname` TEXT COMMENT 'èµ›å­£åç§°',\n  `roundcnt` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ•°',\n  `roundtime` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ—¶é•¿(ç§’)',\n  `survivaltime` BIGINT COMMENT 'å½“æ—¥å­˜æ´»æ—¶é•¿(ç§’)',\n  `firstroundtime` TEXT COMMENT 'å½“æ—¥é¦–æ¬¡å¯¹å±€æ—¶é—´',\n  `device_type` BIGINT COMMENT 'è®¾å¤‡ç±»å‹'\n);\n\nã€å‚è€ƒä¿¡æ¯ã€‘\nä¸»ç©å®šä¹‰ï¼šç”¨æˆ·ç´¯è®¡å¯¹å±€æ—¶é•¿æœ€å¤šçš„ç©æ³•ï¼›\n\nç©æ³•ï¼šä»dws_jordass_mode_roundrecord_diå–\nä»ä¸Šå¾€ä¸‹åŒ¹é…ï¼Œå¦‚æœæ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶ï¼Œåˆ™è¿”å›å¯¹åº”çš„åç§°ï¼Œå¦åˆ™è¿”å›â€œå…¶ä»–æ¨¡å¼â€ã€‚\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ï¼Œä¸”å­æ¨¡å¼åç§°ä»¥â€œCGâ€å¼€å¤´ï¼Œä¸”åœ°å›¾ä¸ºâ€œç¾¤å±¿â€ï¼Œåˆ™è¿”å›â€œä¸»é¢˜ç¾¤å±¿â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œç¾¤å±¿â€ï¼Œåˆ™è¿”å›â€œä¼ ç»Ÿç¾¤å±¿â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œå‡æ—¥ç¾¤å²›â€ï¼Œåˆ™è¿”å›â€œå‡æ—¥ç¾¤å²›â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œè£è€€ä¹‹åŸâ€ï¼Œåˆ™è¿”å›â€œè£è€€ä¹‹åŸâ€ï¼›\nå¦‚æœå­æ¨¡å¼æ˜¯â€œå¹¿åŸŸæˆ˜åœºæ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œå¹¿åŸŸæˆ˜åœºâ€ï¼›\nå¦‚æœå­æ¨¡å¼æ˜¯â€œæèƒ½å½¢æ€æ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œæèƒ½å½¢æ€â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œç»„é˜Ÿç«æŠ€â€ï¼Œåˆ™è¿”å›â€œç»„ç«â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œä¼‘é—²æ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œä¼‘é—²â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œä¹å›­â€ï¼Œåˆ™è¿”å›â€œä¹å›­â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œé¢†åœ°â€ï¼Œåˆ™è¿”å›â€œé¢†åœ°â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œå¹¿é˜”å¤©åœ°â€ï¼Œåˆ™è¿”å›â€œå¹¿é˜”å¤©åœ°â€\n\næ³¨æ„ï¼Œå‚ä¸éš§é“æ¨¡å¼çš„ç”¨æˆ·æ•°æ®ä»dwd_jordass_playerexitgamerecord_hiå–ï¼Œæ—¶é—´é™åˆ¶ 2024.6.18-2025.3.30ï¼Œmode in (3001, 3002, 3003)\n\n",
  "chosen": "with main_user as (\n    select substr(dtstatdate, 1, 6) mons,\n        case\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and submodename like 'CG%' and mapname = 'ç¾¤å±¿' then 'ä¸»é¢˜ç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'ç¾¤å±¿' then 'ä¼ ç»Ÿç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'å‡æ—¥ç¾¤å²›' then 'å‡æ—¥ç¾¤å²›'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'è£è€€ä¹‹åŸ' then 'è£è€€ä¹‹åŸ'\n            when submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' then 'å¹¿åŸŸæˆ˜åœº'\n            when submodename = 'æèƒ½å½¢æ€æ¨¡å¼' then 'æèƒ½å½¢æ€'\n            when modename = 'ç»„é˜Ÿç«æŠ€' then 'ç»„ç«'\n            when modename = 'ä¹å›­' then 'ä¹å›­'\n            when modename = 'é¢†åœ°' then 'é¢†åœ°'\n            when modename = 'å¹¿é˜”å¤©åœ°' then 'å¹¿é˜”å¤©åœ°'\n            else 'å…¶ä»–æ¨¡å¼'\n        end imodename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        sum(roundcnt) roundcnt\n   from dws_jordass_mode_roundrecord_di\n   where dtstatdate between '20190508' and '20250330'\n   group by vplayerid, substr(dtstatdate, 1, 6),\n        case\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and submodename like 'CG%' and mapname = 'ç¾¤å±¿' then 'ä¸»é¢˜ç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'ç¾¤å±¿' then 'ä¼ ç»Ÿç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'å‡æ—¥ç¾¤å²›' then 'å‡æ—¥ç¾¤å²›'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'è£è€€ä¹‹åŸ' then 'è£è€€ä¹‹åŸ'\n            when submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' then 'å¹¿åŸŸæˆ˜åœº'\n            when submodename = 'æèƒ½å½¢æ€æ¨¡å¼' then 'æèƒ½å½¢æ€'\n            when modename = 'ç»„é˜Ÿç«æŠ€' then 'ç»„ç«'\n            when modename = 'ä¹å›­' then 'ä¹å›­'\n            when modename = 'é¢†åœ°' then 'é¢†åœ°'\n            when modename = 'å¹¿é˜”å¤©åœ°' then 'å¹¿é˜”å¤©åœ°'\n            else 'å…¶ä»–æ¨¡å¼'\n        end\n\n   union all\n   \n   select substr (tdbank_imp_date, 1, 6) mons,\n        'éš§é“' as modename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        count(distinct gameid) roundcnt\n   from dwd_jordass_playerexitgamerecord_hi\n   where tdbank_imp_date between '2024061800' and '2025033023'\n     and mode in (3001, 3002, 3003)\n   group by substr (tdbank_imp_date, 1, 6), vplayerid\n)\n\nselect a.mons,\n       a.imodename,\n       a.iusernum,\n       b.iusernumall\nfrom (\n    select mons,\n          imodename,\n          count(vplayerid) iusernum\n    from (\n        select mons, vplayerid, imodename\n        from (\n            select mons,\n                vplayerid,\n                imodename,\n                roundtime,\n                row_number() over (partition by mons, vplayerid order by roundtime desc) as rn\n            from main_user\n        )ff1\n        where rn = 1\n    )f1\n   group by mons, imodename\n) a\nleft join (\n    select mons,\n        imodename,\n        count(vplayerid) iusernumall\n   from main_user\n   group by mons, imodename\n) b \non a.imodename = b.imodename and a.mons = b.mons\norder by a.mons, a.imodename\n;",
  "rejected": "æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥åˆ†æè¿™ä¸ªé—®é¢˜ï¼Œå¹¶æ„é€ å‡ºç¬¦åˆè¦æ±‚çš„ SQL æŸ¥è¯¢è¯­å¥ã€‚\n\n---\n\n## ğŸ§  **ç¬¬ä¸€æ­¥ï¼šç†è§£éœ€æ±‚**\n\n### ã€ç›®æ ‡ã€‘\nç»Ÿè®¡ä» **2019å¹´5æœˆ8æ—¥** åˆ° **2025å¹´3æœˆ30æ—¥** æ¯ä¸ªæœˆä»½ï¼ˆæ ¼å¼ä¸º `YYYYMM`ï¼‰çš„ï¼š\n- ä¸»ç©ç©æ³•ï¼ˆå³è¯¥æœˆç´¯è®¡å¯¹å±€æ—¶é•¿æœ€å¤šçš„ç©æ³•ï¼‰\n- ä¸»ç©äººæ•°ï¼ˆç©è¿™ä¸ªç©æ³•çš„äººæ•°ï¼‰\n- æ€»å‚ä¸äººæ•°ï¼ˆæ‰€æœ‰å‚ä¸æ¸¸æˆçš„ç”¨æˆ·æ•°ï¼‰\n\n> æ³¨æ„ï¼š\n- ç©æ³•çš„å®šä¹‰æ¥è‡ª `dws_jordass_mode_roundrecord_di`\n- å¯¹äº **éš§é“æ¨¡å¼ï¼ˆmode in (3001, 3002, 3003)ï¼‰** çš„ç”¨æˆ·æ•°æ®éœ€ä» `dwd_jordass_playerexitgamerecord_hi` ä¸­æå–ï¼Œæ—¶é—´ä¸º **2024å¹´6æœˆ18æ—¥è‡³2025å¹´3æœˆ30æ—¥**\n- å…¶ä»–ç©æ³•çš„æ•°æ®æ¥è‡ª `dws_jordass_mode_roundrecord_di`\n\n---\n\n## ğŸ“Š **ç¬¬äºŒæ­¥ï¼šç¡®å®šæ•°æ®æ¥æºä¸å­—æ®µ**\n\n### è¡¨1ï¼š`dws_jordass_mode_roundrecord_di`\n- ç”¨äºè·å–å¤§éƒ¨åˆ†ç©æ³•çš„æ•°æ®\n- å­—æ®µï¼š\n  - `dtstatdate`: ç»Ÿè®¡æ—¥æœŸï¼ˆæ ¼å¼ä¸º `YYYYMMDD`ï¼‰\n  - `vplayerid`: ç”¨æˆ· ID\n  - `mode`, `submode`, `map`, `modename`, `submodename`, `mapname`: ç©æ³•ä¿¡æ¯\n  - `roundtime`: å½“å¤©å¯¹å±€æ—¶é•¿ï¼ˆå•ä½ç§’ï¼‰\n\n### è¡¨2ï¼š`dwd_jordass_playerexitgamerecord_hi`\n- ä»…ç”¨äºéš§é“æ¨¡å¼ï¼ˆmode in (3001, 3002, 3003)ï¼‰\n- æ—¶é—´èŒƒå›´ï¼š2024-06-18 è‡³ 2025-03-30\n- å­—æ®µï¼š\n  - `dteventtime`: æ¸¸æˆäº‹ä»¶æ—¶é—´\n  - `vplayerid`: ç”¨æˆ· ID\n  - `mode`: æ¨¡å¼ ID\n  - `roundtime`: å¯¹å±€æ—¶é•¿ï¼ˆå•ä½ç§’ï¼‰\n\n---\n\n## ğŸ” **ç¬¬ä¸‰æ­¥ï¼šç©æ³•æ˜ å°„é€»è¾‘**\n\næ ¹æ®é¢˜ç›®ä¸­ç»™å‡ºçš„è§„åˆ™ï¼Œæˆ‘ä»¬éœ€è¦å°† `mode` + `submode` + `map` æ˜ å°„æˆæ–°çš„ç©æ³•åç§°ï¼š\n\n```sql\nCASE \n    WHEN mode = 1 AND submodename LIKE 'CG%' AND mapname = 'ç¾¤å±¿' THEN 'ä¸»é¢˜ç¾¤å±¿'\n    WHEN mode = 1 AND mapname = 'ç¾¤å±¿' THEN 'ä¼ ç»Ÿç¾¤å±¿'\n    WHEN mode = 1 AND mapname = 'å‡æ—¥ç¾¤å²›' THEN 'å‡æ—¥ç¾¤å²›'\n    WHEN mode = 1 AND mapname = 'è£è€€ä¹‹åŸ' THEN 'è£è€€ä¹‹åŸ'\n    WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n    WHEN submodename = 'æèƒ½å½¢æ€æ¨¡å¼' THEN 'æèƒ½å½¢æ€'\n    WHEN mode = 2 THEN 'ç»„ç«'\n    WHEN mode = 3 THEN 'ä¼‘é—²'\n    WHEN mode = 4 THEN 'ä¹å›­'\n    WHEN mode = 5 THEN 'é¢†åœ°'\n    WHEN mode = 6 THEN 'å¹¿é˜”å¤©åœ°'\n    ELSE 'å…¶ä»–æ¨¡å¼'\nEND AS play_mode\n```\n\n---\n\n## â±ï¸ **ç¬¬å››æ­¥ï¼šæ—¶é—´ç­›é€‰å’Œåˆ†æœˆå¤„ç†**\n\næˆ‘ä»¬è¦ç»Ÿè®¡çš„æ˜¯ï¼š\n- èµ·å§‹æ—¶é—´ï¼š2019-05-08\n- ç»“æŸæ—¶é—´ï¼š2025-03-30\n\nå› æ­¤ï¼š\n- ä½¿ç”¨ `dtstatdate` æˆ– `dteventtime` æ¥è¿‡æ»¤æ—¶é—´\n- å°†æ—¥æœŸè½¬æ¢ä¸º `YYYYMM` æ ¼å¼ä½œä¸ºæœˆä»½å­—æ®µ\n\n---\n\n## ğŸ§® **ç¬¬äº”æ­¥ï¼šä¸»ç©ç©æ³•å®šä¹‰**\n\nä¸»ç©ç©æ³•æ˜¯æŒ‡ï¼š**æŸä¸ªç”¨æˆ·åœ¨æŸä¸ªæœˆä»½å†…ï¼Œç´¯è®¡å¯¹å±€æ—¶é•¿æœ€å¤šçš„ä¸€ç§ç©æ³•**\n\næˆ‘ä»¬å¯ä»¥æŒ‰å¦‚ä¸‹æ­¥éª¤å®ç°ï¼š\n1. æŒ‰ç…§æœˆä»½ã€ç©æ³•åˆ†ç±»ç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„æ€»å¯¹å±€æ—¶é•¿\n2. å¯¹æ¯ä¸ªæœˆä»½ï¼Œæ‰¾å‡ºæ€»æ—¶é•¿æœ€å¤§çš„ç©æ³•\n3. è®¡ç®—è¯¥ç©æ³•ä¸‹çš„ç”¨æˆ·æ•°é‡ï¼ˆä¸»ç©äººæ•°ï¼‰\n4. ç»Ÿè®¡è¯¥æœˆæ‰€æœ‰å‚ä¸ç”¨æˆ·çš„æ•°é‡ï¼ˆæ€»å‚ä¸äººæ•°ï¼‰\n\n---\n\n## âœ… **ç¬¬å…­æ­¥ï¼šæœ€ç»ˆ SQL æ„é€ **\n\næˆ‘ä»¬å°†ä½¿ç”¨ä¸¤ä¸ªéƒ¨åˆ†åˆå¹¶å¤„ç†ï¼š\n\n### ç¬¬ä¸€éƒ¨åˆ†ï¼šå¸¸è§„ç©æ³•ï¼ˆæ¥è‡ª `dws_jordass_mode_roundrecord_di`ï¼‰\n\n```sql\nWITH normal_modes AS (\n    SELECT\n        DATE_FORMAT(STR_TO_DATE(dtstatdate, '%Y%m%d'), '%Y%m') AS month,\n        CASE \n            WHEN mode = 1 AND submodename LIKE 'CG%' AND mapname = 'ç¾¤å±¿' THEN 'ä¸»é¢˜ç¾¤å±¿'\n            WHEN mode = 1 AND mapname = 'ç¾¤å±¿' THEN 'ä¼ ç»Ÿç¾¤å±¿'\n            WHEN mode = 1 AND mapname = 'å‡æ—¥ç¾¤å²›' THEN 'å‡æ—¥ç¾¤å²›'\n            WHEN mode = 1 AND mapname = 'è£è€€ä¹‹åŸ' THEN 'è£è€€ä¹‹åŸ'\n            WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n            WHEN submodename = 'æèƒ½å½¢æ€æ¨¡å¼' THEN 'æèƒ½å½¢æ€'\n            WHEN mode = 2 THEN 'ç»„ç«'\n            WHEN mode = 3 THEN 'ä¼‘é—²'\n            WHEN mode = 4 THEN 'ä¹å›­'\n            WHEN mode = 5 THEN 'é¢†åœ°'\n            WHEN mode = 6 THEN 'å¹¿é˜”å¤©åœ°'\n            ELSE 'å…¶ä»–æ¨¡å¼'\n        END AS play_mode,\n        vplayerid,\n        SUM(roundtime) AS total_time\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE STR_TO_DATE(dtstatdate, '%Y%m%d') BETWEEN '2019-05-08' AND '2025-03-30'\n      AND mode NOT IN (3001, 3002, 3003)\n    GROUP BY month, play_mode, vplayerid\n),\nmonthly_totals AS (\n    SELECT\n        month,\n        play_mode,\n        SUM(total_time) AS total_time_per_mode,\n        COUNT(DISTINCT vplayerid) AS player_count\n    FROM normal_modes\n    GROUP BY month, play_mode\n),\ntop_modes AS (\n    SELECT\n        month,\n        play_mode,\n        player_count,\n        ROW_NUMBER() OVER (PARTITION BY month ORDER BY total_time_per_mode DESC) AS rn\n    FROM monthly_totals\n)\n```\n\n---\n\n### ç¬¬äºŒéƒ¨åˆ†ï¼šéš§é“æ¨¡å¼ï¼ˆæ¥è‡ª `dwd_jordass_playerexitgamerecord_hi`ï¼‰\n\n```sql\n, tunnel_modes AS (\n    SELECT\n        DATE_FORMAT(STR_TO_DATE(dteventtime, '%Y-%m-%d %H:%i:%s'), '%Y%m') AS month,\n        'éš§é“æ¨¡å¼' AS play_mode,\n        vplayerid,\n        SUM(roundtime) AS total_time\n    FROM dwd_jordass_playerexitgamerecord_hi\n    WHERE dteventtime >= '2024-06-18'\n      AND dteventtime < '2025-03-31'\n      AND mode IN (3001, 3002, 3003)\n    GROUP BY month, play_mode, vplayerid\n),\ntunnel_monthly_totals AS (\n    SELECT\n        month,\n        play_mode,\n        SUM(total_time) AS total_time_per_mode,\n        COUNT(DISTINCT vplayerid) AS player_count\n    FROM tunnel_modes\n    GROUP BY month, play_mode\n),\ntunnel_top_modes AS (\n    SELECT\n        month,\n        play_mode,\n        player_count,\n        ROW_NUMBER() OVER (PARTITION BY month ORDER BY total_time_per_mode DESC) AS rn\n    FROM tunnel_monthly_totals\n)\n```\n\n---\n\n### ç¬¬ä¸‰éƒ¨åˆ†ï¼šåˆå¹¶ä¸¤ç§ç©æ³•ï¼Œé€‰å‡ºæ¯ç»„ä¸»ç©ç©æ³•\n\n```sql\n, all_modes AS (\n    SELECT * FROM top_modes WHERE rn = 1\n    UNION ALL\n    SELECT * FROM tunnel_top_modes WHERE rn = 1\n),\nfinal_summary AS (\n    SELECT\n        a.month,\n        a.play_mode,\n        a.player_count AS main_player_count,\n        COUNT(DISTINCT b.vplayerid) AS total_participants\n    FROM all_modes a\n    LEFT JOIN (\n        SELECT DISTINCT\n            DATE_FORMAT(STR_TO_DATE(dtstatdate, '%Y%m%d'), '%Y%m') AS month,\n            vplayerid\n        FROM dws_jordass_mode_roundrecord_di\n        WHERE STR_TO_DATE(dtstatdate, '%Y%m%d') BETWEEN '2019-05-08' AND '2025-03-30'\n          AND mode NOT IN (3001, 3002, 3003)\n\n        UNION\n\n        SELECT DISTINCT\n            DATE_FORMAT(STR_TO_DATE(dteventtime, '%Y-%m-%d %H:%i:%s'), '%Y%m') AS month,\n            vplayerid\n        FROM dwd_jordass_playerexitgamerecord_hi\n        WHERE dteventtime >= '2024-06-18'\n          AND dteventtime < '2025-03-31'\n          AND mode IN (3001, 3002, 3003)\n    ) b ON a.month = b.month\n    GROUP BY a.month, a.play_mode, a.player_count\n)\nSELECT\n    month,\n    play_mode,\n    main_player_count,\n    total_participants\nFROM final_summary\nORDER BY month;\n```\n\n---\n\n## ğŸ§¾ **æœ€ç»ˆ SQL æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š**\n\n```sql\nWITH normal_modes AS (\n    SELECT\n        DATE_FORMAT(STR_TO_DATE(dtstatdate, '%Y%m%d'), '%Y%m') AS month,\n        CASE \n            WHEN mode = 1 AND submodename LIKE 'CG%' AND mapname = 'ç¾¤å±¿' THEN 'ä¸»é¢˜ç¾¤å±¿'\n            WHEN mode = 1 AND mapname = 'ç¾¤å±¿' THEN 'ä¼ ç»Ÿç¾¤å±¿'\n            WHEN mode = 1 AND mapname = 'å‡æ—¥ç¾¤å²›' THEN 'å‡æ—¥ç¾¤å²›'\n            WHEN mode = 1 AND mapname = 'è£è€€ä¹‹åŸ' THEN 'è£è€€ä¹‹åŸ'\n            WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n            WHEN submodename = 'æèƒ½å½¢æ€æ¨¡å¼' THEN 'æèƒ½å½¢æ€'\n            WHEN mode = 2 THEN 'ç»„ç«'\n            WHEN mode = 3 THEN 'ä¼‘é—²'\n            WHEN mode = 4 THEN 'ä¹å›­'\n            WHEN mode = 5 THEN 'é¢†åœ°'\n            WHEN mode = 6 THEN 'å¹¿é˜”å¤©åœ°'\n            ELSE 'å…¶ä»–æ¨¡å¼'\n        END AS play_mode,\n        vplayerid,\n        SUM(roundtime) AS total_time\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE STR_TO_DATE(dtstatdate, '%Y%m%d') BETWEEN '2019-05-08' AND '2025-03-30'\n      AND mode NOT IN (3001, 3002, 3003)\n    GROUP BY month, play_mode, vplayerid\n),\nmonthly_totals AS (\n    SELECT\n        month,\n        play_mode,\n        SUM(total_time) AS total_time_per_mode,\n        COUNT(DISTINCT vplayerid) AS player_count\n    FROM normal_modes\n    GROUP BY month, play_mode\n),\ntop_modes AS (\n    SELECT\n        month,\n        play_mode,\n        player_count,\n        ROW_NUMBER() OVER (PARTITION BY month ORDER BY total_time_per_mode DESC) AS rn\n    FROM monthly_totals\n),\ntunnel_modes AS (\n    SELECT\n        DATE_FORMAT(STR_TO_DATE(dteventtime, '%Y-%m-%d %H:%i:%s'), '%Y%m') AS month,\n        'éš§é“æ¨¡å¼' AS play_mode,\n        vplayerid,\n        SUM(roundtime) AS total_time\n    FROM dwd_jordass_playerexitgamerecord_hi\n    WHERE dteventtime >= '2024-06-18'\n      AND dteventtime < '2025-03-31'\n      AND mode IN (3001, 3002, 3003)\n    GROUP BY month, play_mode, vplayerid\n),\ntunnel_monthly_totals AS (\n    SELECT\n        month,\n        play_mode,\n        SUM(total_time) AS total_time_per_mode,\n        COUNT(DISTINCT vplayerid) AS player_count\n    FROM tunnel_modes\n    GROUP BY month, play_mode\n),\ntunnel_top_modes AS (\n    SELECT\n        month,\n        play_mode,\n        player_count,\n        ROW_NUMBER() OVER (PARTITION BY month ORDER BY total_time_per_mode DESC) AS rn\n    FROM tunnel_monthly_totals\n),\nall_modes AS (\n    SELECT * FROM top_modes WHERE rn = 1\n    UNION ALL\n    SELECT * FROM tunnel_top_modes WHERE rn = 1\n),\nfinal_summary AS (\n    SELECT\n        a.month,\n        a.play_mode,\n        a.player_count AS main_player_count,\n        COUNT(DISTINCT b.vplayerid) AS total_participants\n    FROM all_modes a\n    LEFT JOIN (\n        SELECT DISTINCT\n            DATE_FORMAT(STR_TO_DATE(dtstatdate, '%Y%m%d'), '%Y%m') AS month,\n            vplayerid\n        FROM dws_jordass_mode_roundrecord_di\n        WHERE STR_TO_DATE(dtstatdate, '%Y%m%d') BETWEEN '2019-05-08' AND '2025-03-30'\n          AND mode NOT IN (3001, 3002, 3003)\n\n        UNION\n\n        SELECT DISTINCT\n            DATE_FORMAT(STR_TO_DATE(dteventtime, '%Y-%m-%d %H:%i:%s'), '%Y%m') AS month,\n            vplayerid\n        FROM dwd_jordass_playerexitgamerecord_hi\n        WHERE dteventtime >= '2024-06-18'\n          AND dteventtime < '2025-03-31'\n          AND mode IN (3001, 3002, 3003)\n    ) b ON a.month = b.month\n    GROUP BY a.month, a.play_mode, a.player_count\n)\nSELECT\n    month,\n    play_mode,\n    main_player_count,\n    total_participants\nFROM final_summary\nORDER BY month;\n```\n\n---\n\nå¦‚éœ€è¿›ä¸€æ­¥ä¼˜åŒ–æˆ–æ·»åŠ æ³¨é‡Šï¼Œè¯·å‘Šè¯‰æˆ‘ï¼"
},
{
  "instruction": "è¯·ä½ æ¥ä¸‹æ¥ä¸€æ­¥æ­¥æ€è€ƒï¼Œå†™å‡ºæ­£ç¡®çš„SQLæŸ¥è¯¢è¯­å¥ä»¥æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚",
  "input": "ä½ æ˜¯ä¸€åMySQLä¸“å®¶ï¼Œç°åœ¨éœ€è¦é˜…è¯»å¹¶ç†è§£ä¸‹é¢çš„ã€æ•°æ®åº“schemaã€‘æè¿°ï¼Œä»¥åŠå¯èƒ½ç”¨åˆ°çš„ã€å‚è€ƒä¿¡æ¯ã€‘ï¼Œå¹¶è¿ç”¨MySQLçŸ¥è¯†ç”Ÿæˆsqlè¯­å¥å›ç­”ã€ç”¨æˆ·é—®é¢˜ã€‘ã€‚\nã€ç”¨æˆ·é—®é¢˜ã€‘\nç»Ÿè®¡2019.5.8è‡³2025.3.30 åˆ†æœˆçš„ç©æ³•ä¸»ç©æƒ…å†µ\nè¾“å‡ºï¼šæœˆä»½(201905ã€201906ã€...ã€202503)ã€ä¸»ç©ç©æ³•ã€ä¸»ç©äººæ•°ã€æ€»å‚ä¸äººæ•°\n\nã€æ•°æ®åº“schemaã€‘\nCREATE TABLE `dwd_jordass_playerexitgamerecord_hi` (\n  `tdbank_imp_date` TEXT,\n  `gamesvrid` TEXT COMMENT 'ç™»å½•çš„æ¸¸æˆæœåŠ¡å™¨ç¼–å·',\n  `dteventtime` TEXT COMMENT 'æ¸¸æˆäº‹ä»¶çš„æ—¶é—´, æ ¼å¼ YYYY-MM-DD HH:MM:SS',\n  `vgameappid` TEXT COMMENT 'æ¸¸æˆAPPID',\n  `platid` BIGINT COMMENT 'ios 0/android 1',\n  `izoneareaid` BIGINT COMMENT 'é’ˆå¯¹åˆ†åŒºåˆ†æœçš„æ¸¸æˆå¡«å†™åˆ†åŒºidï¼Œç”¨æ¥å”¯ä¸€æ ‡ç¤ºä¸€ä¸ªåŒºï¼›éåˆ†åŒºåˆ†æœæ¸¸æˆè¯·å¡«å†™0',\n  `vplayerid` TEXT COMMENT 'ç”¨æˆ·playeridå·',\n  `uid` TEXT COMMENT 'è§’è‰²UID',\n  `gameid` TEXT COMMENT 'æœ¬å±€æ¸¸æˆID',\n  `exitreason` TEXT COMMENT 'é€€å‡ºåŸå› ',\n  `isallianceforceeescape` BIGINT COMMENT 'é€ƒè·‘æ—¶æ˜¯å¦å®‰å…¨çš„ å¦:0/æ˜¯:1',\n  `escapebantype` BIGINT COMMENT 'æœ¬æ¬¡é€€å‡ºæ˜¯å¦è§¦å‘ç¦èµ›é™åˆ¶ï¼Œ0=æ²¡æœ‰è§¦å‘ï¼›1=è§¦å‘é™åˆ¶ä¸€ï¼›2=è§¦å‘é™åˆ¶äºŒï¼›3=è§¦å‘é™åˆ¶ä¸‰',\n  `gamestate` TEXT COMMENT 'é€€å‡ºæ—¶å¯¹å±€çŠ¶æ€ï¼šActiveæ˜¯åœ¨å‡ºç”Ÿå²›ä¹‹å‰ï¼ŒReadyæ˜¯åœ¨å‡ºç”Ÿå²›ï¼ŒFightingæ˜¯åŒ…æ‹¬4äººé›†ç»“ã€ä¸Šé£æœºã€è·³ä¼æˆ˜æ–—è¿™äº›é˜¶æ®µï¼ŒFinish æ­»äº¡/èƒœåˆ©ç»“æŸ',\n  `submodegroup` BIGINT COMMENT 'æ¨¡å¼ç»„ID',\n  `lobbyexitreason` TEXT COMMENT 'å¤§å…è®°å½•çš„é€€å‡ºåŸå› ',\n  `mode` BIGINT COMMENT 'æ¨¡å¼ID',\n  `submode` BIGINT COMMENT 'å­æ¨¡å¼ID',\n  `roundtime` BIGINT COMMENT 'å¯¹å±€æ—¶é•¿'\n);\nCREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` TEXT COMMENT 'ç»Ÿè®¡æ—¥æœŸæ ¼å¼YYYYMMDD',\n  `vgameappid` TEXT COMMENT 'è´¦å·ä½“ç³»ï¼šwx:å¾®ä¿¡ï¼Œqqï¼šæ‰‹Q',\n  `platid` BIGINT COMMENT 'ç³»ç»Ÿå¹³å°ï¼š0:IOS,1:Android',\n  `vplayerid` TEXT COMMENT 'ç©å®¶ID',\n  `mode` BIGINT COMMENT 'æ¨¡å¼ID',\n  `modename` TEXT COMMENT 'æ¨¡å¼åç§°',\n  `submode` BIGINT COMMENT 'å­æ¨¡å¼ID',\n  `submodename` TEXT COMMENT 'å­æ¨¡å¼åç§°',\n  `map` BIGINT COMMENT 'åœ°å›¾ID',\n  `mapname` TEXT COMMENT 'åœ°å›¾åç§°',\n  `seasonid` BIGINT COMMENT 'èµ›å­£ID',\n  `seasonname` TEXT COMMENT 'èµ›å­£åç§°',\n  `roundcnt` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ•°',\n  `roundtime` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ—¶é•¿(ç§’)',\n  `survivaltime` BIGINT COMMENT 'å½“æ—¥å­˜æ´»æ—¶é•¿(ç§’)',\n  `firstroundtime` TEXT COMMENT 'å½“æ—¥é¦–æ¬¡å¯¹å±€æ—¶é—´',\n  `device_type` BIGINT COMMENT 'è®¾å¤‡ç±»å‹'\n);\n\nã€å‚è€ƒä¿¡æ¯ã€‘\nä¸»ç©å®šä¹‰ï¼šç”¨æˆ·ç´¯è®¡å¯¹å±€æ—¶é•¿æœ€å¤šçš„ç©æ³•ï¼›\n\nç©æ³•ï¼šä»dws_jordass_mode_roundrecord_diå–\nä»ä¸Šå¾€ä¸‹åŒ¹é…ï¼Œå¦‚æœæ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶ï¼Œåˆ™è¿”å›å¯¹åº”çš„åç§°ï¼Œå¦åˆ™è¿”å›â€œå…¶ä»–æ¨¡å¼â€ã€‚\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ï¼Œä¸”å­æ¨¡å¼åç§°ä»¥â€œCGâ€å¼€å¤´ï¼Œä¸”åœ°å›¾ä¸ºâ€œç¾¤å±¿â€ï¼Œåˆ™è¿”å›â€œä¸»é¢˜ç¾¤å±¿â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œç¾¤å±¿â€ï¼Œåˆ™è¿”å›â€œä¼ ç»Ÿç¾¤å±¿â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œå‡æ—¥ç¾¤å²›â€ï¼Œåˆ™è¿”å›â€œå‡æ—¥ç¾¤å²›â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œè£è€€ä¹‹åŸâ€ï¼Œåˆ™è¿”å›â€œè£è€€ä¹‹åŸâ€ï¼›\nå¦‚æœå­æ¨¡å¼æ˜¯â€œå¹¿åŸŸæˆ˜åœºæ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œå¹¿åŸŸæˆ˜åœºâ€ï¼›\nå¦‚æœå­æ¨¡å¼æ˜¯â€œæèƒ½å½¢æ€æ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œæèƒ½å½¢æ€â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œç»„é˜Ÿç«æŠ€â€ï¼Œåˆ™è¿”å›â€œç»„ç«â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œä¼‘é—²æ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œä¼‘é—²â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œä¹å›­â€ï¼Œåˆ™è¿”å›â€œä¹å›­â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œé¢†åœ°â€ï¼Œåˆ™è¿”å›â€œé¢†åœ°â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œå¹¿é˜”å¤©åœ°â€ï¼Œåˆ™è¿”å›â€œå¹¿é˜”å¤©åœ°â€\n\næ³¨æ„ï¼Œå‚ä¸éš§é“æ¨¡å¼çš„ç”¨æˆ·æ•°æ®ä»dwd_jordass_playerexitgamerecord_hiå–ï¼Œæ—¶é—´é™åˆ¶ 2024.6.18-2025.3.30ï¼Œmode in (3001, 3002, 3003)\n\n",
  "chosen": "with main_user as (\n    select substr(dtstatdate, 1, 6) mons,\n        case\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and submodename like 'CG%' and mapname = 'ç¾¤å±¿' then 'ä¸»é¢˜ç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'ç¾¤å±¿' then 'ä¼ ç»Ÿç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'å‡æ—¥ç¾¤å²›' then 'å‡æ—¥ç¾¤å²›'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'è£è€€ä¹‹åŸ' then 'è£è€€ä¹‹åŸ'\n            when submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' then 'å¹¿åŸŸæˆ˜åœº'\n            when submodename = 'æèƒ½å½¢æ€æ¨¡å¼' then 'æèƒ½å½¢æ€'\n            when modename = 'ç»„é˜Ÿç«æŠ€' then 'ç»„ç«'\n            when modename = 'ä¹å›­' then 'ä¹å›­'\n            when modename = 'é¢†åœ°' then 'é¢†åœ°'\n            when modename = 'å¹¿é˜”å¤©åœ°' then 'å¹¿é˜”å¤©åœ°'\n            else 'å…¶ä»–æ¨¡å¼'\n        end imodename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        sum(roundcnt) roundcnt\n   from dws_jordass_mode_roundrecord_di\n   where dtstatdate between '20190508' and '20250330'\n   group by vplayerid, substr(dtstatdate, 1, 6),\n        case\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and submodename like 'CG%' and mapname = 'ç¾¤å±¿' then 'ä¸»é¢˜ç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'ç¾¤å±¿' then 'ä¼ ç»Ÿç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'å‡æ—¥ç¾¤å²›' then 'å‡æ—¥ç¾¤å²›'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'è£è€€ä¹‹åŸ' then 'è£è€€ä¹‹åŸ'\n            when submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' then 'å¹¿åŸŸæˆ˜åœº'\n            when submodename = 'æèƒ½å½¢æ€æ¨¡å¼' then 'æèƒ½å½¢æ€'\n            when modename = 'ç»„é˜Ÿç«æŠ€' then 'ç»„ç«'\n            when modename = 'ä¹å›­' then 'ä¹å›­'\n            when modename = 'é¢†åœ°' then 'é¢†åœ°'\n            when modename = 'å¹¿é˜”å¤©åœ°' then 'å¹¿é˜”å¤©åœ°'\n            else 'å…¶ä»–æ¨¡å¼'\n        end\n\n   union all\n   \n   select substr (tdbank_imp_date, 1, 6) mons,\n        'éš§é“' as modename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        count(distinct gameid) roundcnt\n   from dwd_jordass_playerexitgamerecord_hi\n   where tdbank_imp_date between '2024061800' and '2025033023'\n     and mode in (3001, 3002, 3003)\n   group by substr (tdbank_imp_date, 1, 6), vplayerid\n)\n\nselect a.mons,\n       a.imodename,\n       a.iusernum,\n       b.iusernumall\nfrom (\n    select mons,\n          imodename,\n          count(vplayerid) iusernum\n    from (\n        select mons, vplayerid, imodename\n        from (\n            select mons,\n                vplayerid,\n                imodename,\n                roundtime,\n                row_number() over (partition by mons, vplayerid order by roundtime desc) as rn\n            from main_user\n        )ff1\n        where rn = 1\n    )f1\n   group by mons, imodename\n) a\nleft join (\n    select mons,\n        imodename,\n        count(vplayerid) iusernumall\n   from main_user\n   group by mons, imodename\n) b \non a.imodename = b.imodename and a.mons = b.mons\norder by a.mons, a.imodename\n;",
  "rejected": "æˆ‘ä»¬å°†é€æ­¥åˆ†æå¹¶æ„å»ºSQLæŸ¥è¯¢è¯­å¥æ¥æ»¡è¶³ç”¨æˆ·éœ€æ±‚ï¼š\n\n---\n\n## ğŸ§  **ç›®æ ‡å›é¡¾**\n\næˆ‘ä»¬éœ€è¦ç»Ÿè®¡ **ä»2019å¹´5æœˆ8æ—¥åˆ°2025å¹´3æœˆ30æ—¥** æ¯ä¸ªæœˆä»½ï¼ˆæ ¼å¼ä¸º `YYYYMM`ï¼‰ä¸­ï¼š\n- ä¸»ç©ç©æ³•ï¼ˆå³è¯¥æœˆç´¯è®¡å¯¹å±€æ—¶é•¿æœ€å¤šçš„ç©æ³•ï¼‰\n- ä¸»ç©äººæ•°ï¼ˆè¯¥ç©æ³•çš„ç©å®¶æ•°é‡ï¼‰\n- æ€»å‚ä¸äººæ•°ï¼ˆè¯¥æœˆæ‰€æœ‰å‚ä¸ç©æ³•çš„ç©å®¶æ€»æ•°ï¼‰\n\n> æ³¨æ„ï¼š  \n> - ç©æ³•å®šä¹‰æ¥è‡ª `dws_jordass_mode_roundrecord_di` è¡¨  \n> - éš§é“æ¨¡å¼æ•°æ®éœ€ä» `dwd_jordass_playerexitgamerecord_hi` ä¸­æå–ï¼Œæ—¶é—´èŒƒå›´æ˜¯ **2024.6.18 è‡³ 2025.3.30**ï¼Œä¸” mode in (3001, 3002, 3003)\n\n---\n\n## ğŸ” ç¬¬ä¸€æ­¥ï¼šå¤„ç†ç©æ³•æ˜ å°„é€»è¾‘\n\næˆ‘ä»¬è¦æ ¹æ®è§„åˆ™å°†åŸå§‹æ¨¡å¼è½¬æ¢æˆæˆ‘ä»¬æƒ³è¦çš„ç©æ³•åç§°ã€‚å¯ä»¥ä½¿ç”¨ CASE WHEN æ„å»ºä¸€ä¸ªå­—æ®µã€‚\n\n```sql\nCASE \n    WHEN mode = 1 AND submodename LIKE 'CG%' AND mapname = 'ç¾¤å±¿' THEN 'ä¸»é¢˜ç¾¤å±¿'\n    WHEN mode = 1 AND mapname = 'ç¾¤å±¿' THEN 'ä¼ ç»Ÿç¾¤å±¿'\n    WHEN mode = 1 AND mapname = 'å‡æ—¥ç¾¤å²›' THEN 'å‡æ—¥ç¾¤å²›'\n    WHEN mode = 1 AND mapname = 'è£è€€ä¹‹åŸ' THEN 'è£è€€ä¹‹åŸ'\n    WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n    WHEN submodename = 'æèƒ½å½¢æ€æ¨¡å¼' THEN 'æèƒ½å½¢æ€'\n    WHEN mode = 2 THEN 'ç»„ç«'\n    WHEN mode = 3 THEN 'ä¼‘é—²'\n    WHEN mode = 4 THEN 'ä¹å›­'\n    WHEN mode = 5 THEN 'é¢†åœ°'\n    WHEN mode = 6 THEN 'å¹¿é˜”å¤©åœ°'\n    ELSE 'å…¶ä»–æ¨¡å¼'\nEND AS play_mode\n```\n\n---\n\n## ğŸ—“ï¸ ç¬¬äºŒæ­¥ï¼šç­›é€‰æ—¶é—´æ®µå’Œåˆå¹¶ä¸¤ä¸ªè¡¨çš„æ•°æ®\n\n### å¯¹äº `dws_jordass_mode_roundrecord_di` è¡¨ï¼š\n- æ—¶é—´èŒƒå›´ï¼š`dtstatdate BETWEEN '20190508' AND '20250330'`\n- ä½¿ç”¨ `dtstatdate` å­—æ®µåšæœˆä»½åˆ‡åˆ†ï¼ˆå¦‚ï¼š20190508 â†’ 201905ï¼‰\n\n### å¯¹äº `dwd_jordass_playerexitgamerecord_hi` è¡¨ï¼š\n- æ—¶é—´èŒƒå›´ï¼š`dteventtime >= '2024-06-18' AND dteventtime <= '2025-03-30'`\n- mode in (3001, 3002, 3003)\n- è¿™éƒ¨åˆ†éœ€è¦æ„é€ å‡ºç±»ä¼¼ `dws_jordass_mode_roundrecord_di` çš„ç»“æ„ç”¨äºç»Ÿä¸€å¤„ç†\n\næˆ‘ä»¬å¯ä»¥å°†ä¸¤ä¸ªæ¥æºçš„æ•°æ®ç»Ÿä¸€æ ¼å¼åè¿›è¡Œ UNION ALL å¤„ç†ã€‚\n\n---\n\n## ğŸ§± ç¬¬ä¸‰æ­¥ï¼šæ„é€ ç»Ÿä¸€æ•°æ®æº\n\n### âœ… ä» `dws_jordass_mode_roundrecord_di` æå–æ•°æ®\n\n```sql\nSELECT \n    LEFT(dtstatdate, 6) AS month,\n    CASE \n        WHEN mode = 1 AND submodename LIKE 'CG%' AND mapname = 'ç¾¤å±¿' THEN 'ä¸»é¢˜ç¾¤å±¿'\n        WHEN mode = 1 AND mapname = 'ç¾¤å±¿' THEN 'ä¼ ç»Ÿç¾¤å±¿'\n        WHEN mode = 1 AND mapname = 'å‡æ—¥ç¾¤å²›' THEN 'å‡æ—¥ç¾¤å²›'\n        WHEN mode = 1 AND mapname = 'è£è€€ä¹‹åŸ' THEN 'è£è€€ä¹‹åŸ'\n        WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n        WHEN submodename = 'æèƒ½å½¢æ€æ¨¡å¼' THEN 'æèƒ½å½¢æ€'\n        WHEN mode = 2 THEN 'ç»„ç«'\n        WHEN mode = 3 THEN 'ä¼‘é—²'\n        WHEN mode = 4 THEN 'ä¹å›­'\n        WHEN mode = 5 THEN 'é¢†åœ°'\n        WHEN mode = 6 THEN 'å¹¿é˜”å¤©åœ°'\n        ELSE 'å…¶ä»–æ¨¡å¼'\n    END AS play_mode,\n    vplayerid,\n    roundtime\nFROM dws_jordass_mode_roundrecord_di\nWHERE dtstatdate BETWEEN '20190508' AND '20250330'\n```\n\n### âœ… ä» `dwd_jordass_playerexitgamerecord_hi` æå–éš§é“æ¨¡å¼æ•°æ®\n\n```sql\nSELECT \n    DATE_FORMAT(dteventtime, '%Y%m') AS month,\n    'éš§é“æ¨¡å¼' AS play_mode,\n    vplayerid,\n    roundtime -- æ³¨æ„è¿™é‡Œ roundtime æ˜¯åœ¨ exit è®°å½•é‡Œï¼Œå¯èƒ½ä¸å‡†ç¡®ï¼Œä½†æš‚å®šç”¨å®ƒæ›¿ä»£\nFROM dwd_jordass_playerexitgamerecord_hi\nWHERE dteventtime >= '2024-06-18' \n  AND dteventtime <= '2025-03-30'\n  AND mode IN (3001, 3002, 3003)\n```\n\n> âš ï¸ æ³¨æ„ï¼š`roundtime` åœ¨ `dwd_jordass_playerexitgamerecord_hi` ä¸­å«ä¹‰ä¸åŒï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯å•æ¬¡å¯¹å±€æ—¶é•¿ï¼Œè€Œ `dws_jordass_mode_roundrecord_di` æ˜¯ç´¯è®¡æ—¶é•¿ã€‚æ‰€ä»¥è¿™ä¸ªå­—æ®µéœ€è¦è°¨æ…ä½¿ç”¨ï¼Œè‹¥æ— åˆé€‚å­—æ®µå¯è€ƒè™‘åªæŒ‰ç©å®¶æ•°ç»Ÿè®¡ã€‚\n\nå› æ­¤æˆ‘ä»¬å‡è®¾ï¼š**éš§é“æ¨¡å¼ä¹Ÿä½¿ç”¨ roundtime æ¥è®¡ç®—å¯¹å±€æ—¶é•¿**ï¼Œå¹¶ç»Ÿä¸€ä½¿ç”¨ `month`, `play_mode`, `vplayerid`, `roundtime` å››åˆ—ã€‚\n\n---\n\n## ğŸ§® ç¬¬å››æ­¥ï¼šèšåˆæ¯ä¸ªç©æ³•çš„æ€»æ—¶é•¿ï¼Œå¹¶æ‰¾å‡ºä¸»ç©ç©æ³•\n\n```sql\nWITH unified_data AS (\n    SELECT \n        LEFT(dtstatdate, 6) AS month,\n        CASE \n            WHEN mode = 1 AND submodename LIKE 'CG%' AND mapname = 'ç¾¤å±¿' THEN 'ä¸»é¢˜ç¾¤å±¿'\n            WHEN mode = 1 AND mapname = 'ç¾¤å±¿' THEN 'ä¼ ç»Ÿç¾¤å±¿'\n            WHEN mode = 1 AND mapname = 'å‡æ—¥ç¾¤å²›' THEN 'å‡æ—¥ç¾¤å²›'\n            WHEN mode = 1 AND mapname = 'è£è€€ä¹‹åŸ' THEN 'è£è€€ä¹‹åŸ'\n            WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n            WHEN submodename = 'æèƒ½å½¢æ€æ¨¡å¼' THEN 'æèƒ½å½¢æ€'\n            WHEN mode = 2 THEN 'ç»„ç«'\n            WHEN mode = 3 THEN 'ä¼‘é—²'\n            WHEN mode = 4 THEN 'ä¹å›­'\n            WHEN mode = 5 THEN 'é¢†åœ°'\n            WHEN mode = 6 THEN 'å¹¿é˜”å¤©åœ°'\n            ELSE 'å…¶ä»–æ¨¡å¼'\n        END AS play_mode,\n        vplayerid,\n        roundtime\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE dtstatdate BETWEEN '20190508' AND '20250330'\n\n    UNION ALL\n\n    SELECT \n        DATE_FORMAT(dteventtime, '%Y%m') AS month,\n        'éš§é“æ¨¡å¼' AS play_mode,\n        vplayerid,\n        roundtime\n    FROM dwd_jordass_playerexitgamerecord_hi\n    WHERE dteventtime >= '2024-06-18' \n      AND dteventtime <= '2025-03-30'\n      AND mode IN (3001, 3002, 3003)\n),\nmonthly_totals AS (\n    SELECT \n        month,\n        play_mode,\n        SUM(roundtime) AS total_time,\n        COUNT(DISTINCT vplayerid) AS player_count\n    FROM unified_data\n    GROUP BY month, play_mode\n),\nranked_modes AS (\n    SELECT \n        month,\n        play_mode,\n        total_time,\n        player_count,\n        ROW_NUMBER() OVER (PARTITION BY month ORDER BY total_time DESC) AS rn\n    FROM monthly_totals\n)\nSELECT \n    month,\n    play_mode AS ä¸»ç©ç©æ³•,\n    player_count AS ä¸»ç©äººæ•°,\n    SUM(player_count) OVER (PARTITION BY month) AS æ€»å‚ä¸äººæ•°\nFROM ranked_modes\nWHERE rn = 1;\n```\n\n---\n\n## âœ… æœ€ç»ˆ SQL æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š\n\n```sql\nWITH unified_data AS (\n    SELECT \n        LEFT(dtstatdate, 6) AS month,\n        CASE \n            WHEN mode = 1 AND submodename LIKE 'CG%' AND mapname = 'ç¾¤å±¿' THEN 'ä¸»é¢˜ç¾¤å±¿'\n            WHEN mode = 1 AND mapname = 'ç¾¤å±¿' THEN 'ä¼ ç»Ÿç¾¤å±¿'\n            WHEN mode = 1 AND mapname = 'å‡æ—¥ç¾¤å²›' THEN 'å‡æ—¥ç¾¤å²›'\n            WHEN mode = 1 AND mapname = 'è£è€€ä¹‹åŸ' THEN 'è£è€€ä¹‹åŸ'\n            WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n            WHEN submodename = 'æèƒ½å½¢æ€æ¨¡å¼' THEN 'æèƒ½å½¢æ€'\n            WHEN mode = 2 THEN 'ç»„ç«'\n            WHEN mode = 3 THEN 'ä¼‘é—²'\n            WHEN mode = 4 THEN 'ä¹å›­'\n            WHEN mode = 5 THEN 'é¢†åœ°'\n            WHEN mode = 6 THEN 'å¹¿é˜”å¤©åœ°'\n            ELSE 'å…¶ä»–æ¨¡å¼'\n        END AS play_mode,\n        vplayerid,\n        roundtime\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE dtstatdate BETWEEN '20190508' AND '20250330'\n\n    UNION ALL\n\n    SELECT \n        DATE_FORMAT(dteventtime, '%Y%m') AS month,\n        'éš§é“æ¨¡å¼' AS play_mode,\n        vplayerid,\n        roundtime\n    FROM dwd_jordass_playerexitgamerecord_hi\n    WHERE dteventtime >= '2024-06-18' \n      AND dteventtime <= '2025-03-30'\n      AND mode IN (3001, 3002, 3003)\n),\nmonthly_totals AS (\n    SELECT \n        month,\n        play_mode,\n        SUM(roundtime) AS total_time,\n        COUNT(DISTINCT vplayerid) AS player_count\n    FROM unified_data\n    GROUP BY month, play_mode\n),\nranked_modes AS (\n    SELECT \n        month,\n        play_mode,\n        total_time,\n        player_count,\n        ROW_NUMBER() OVER (PARTITION BY month ORDER BY total_time DESC) AS rn\n    FROM monthly_totals\n)\nSELECT \n    month,\n    play_mode AS ä¸»ç©ç©æ³•,\n    player_count AS ä¸»ç©äººæ•°,\n    SUM(player_count) OVER (PARTITION BY month) AS æ€»å‚ä¸äººæ•°\nFROM ranked_modes\nWHERE rn = 1\nORDER BY month;\n```\n\n---\n\n## ğŸ“Œ è¾“å‡ºè¯´æ˜\n\n| month | ä¸»ç©ç©æ³•     | ä¸»ç©äººæ•° | æ€»å‚ä¸äººæ•° |\n|-------|--------------|----------|------------|\n| 201905| ä¼ ç»Ÿç¾¤å±¿     | 1234     | 2345       |\n| ...   | ...          | ...      | ...        |\n\n---\n\nå¦‚æœä½ æœ‰æ›´å¤šå…·ä½“å­—æ®µæˆ–è¦æ±‚ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼"
},
{
  "instruction": "è¯·ä½ æ¥ä¸‹æ¥ä¸€æ­¥æ­¥æ€è€ƒï¼Œå†™å‡ºæ­£ç¡®çš„SQLæŸ¥è¯¢è¯­å¥ä»¥æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚",
  "input": "ä½ æ˜¯ä¸€åMySQLä¸“å®¶ï¼Œç°åœ¨éœ€è¦é˜…è¯»å¹¶ç†è§£ä¸‹é¢çš„ã€æ•°æ®åº“schemaã€‘æè¿°ï¼Œä»¥åŠå¯èƒ½ç”¨åˆ°çš„ã€å‚è€ƒä¿¡æ¯ã€‘ï¼Œå¹¶è¿ç”¨MySQLçŸ¥è¯†ç”Ÿæˆsqlè¯­å¥å›ç­”ã€ç”¨æˆ·é—®é¢˜ã€‘ã€‚\nã€ç”¨æˆ·é—®é¢˜ã€‘\nç»Ÿè®¡2019.5.8è‡³2025.3.30 åˆ†æœˆçš„ç©æ³•ä¸»ç©æƒ…å†µ\nè¾“å‡ºï¼šæœˆä»½(201905ã€201906ã€...ã€202503)ã€ä¸»ç©ç©æ³•ã€ä¸»ç©äººæ•°ã€æ€»å‚ä¸äººæ•°\n\nã€æ•°æ®åº“schemaã€‘\nCREATE TABLE `dwd_jordass_playerexitgamerecord_hi` (\n  `tdbank_imp_date` TEXT,\n  `gamesvrid` TEXT COMMENT 'ç™»å½•çš„æ¸¸æˆæœåŠ¡å™¨ç¼–å·',\n  `dteventtime` TEXT COMMENT 'æ¸¸æˆäº‹ä»¶çš„æ—¶é—´, æ ¼å¼ YYYY-MM-DD HH:MM:SS',\n  `vgameappid` TEXT COMMENT 'æ¸¸æˆAPPID',\n  `platid` BIGINT COMMENT 'ios 0/android 1',\n  `izoneareaid` BIGINT COMMENT 'é’ˆå¯¹åˆ†åŒºåˆ†æœçš„æ¸¸æˆå¡«å†™åˆ†åŒºidï¼Œç”¨æ¥å”¯ä¸€æ ‡ç¤ºä¸€ä¸ªåŒºï¼›éåˆ†åŒºåˆ†æœæ¸¸æˆè¯·å¡«å†™0',\n  `vplayerid` TEXT COMMENT 'ç”¨æˆ·playeridå·',\n  `uid` TEXT COMMENT 'è§’è‰²UID',\n  `gameid` TEXT COMMENT 'æœ¬å±€æ¸¸æˆID',\n  `exitreason` TEXT COMMENT 'é€€å‡ºåŸå› ',\n  `isallianceforceeescape` BIGINT COMMENT 'é€ƒè·‘æ—¶æ˜¯å¦å®‰å…¨çš„ å¦:0/æ˜¯:1',\n  `escapebantype` BIGINT COMMENT 'æœ¬æ¬¡é€€å‡ºæ˜¯å¦è§¦å‘ç¦èµ›é™åˆ¶ï¼Œ0=æ²¡æœ‰è§¦å‘ï¼›1=è§¦å‘é™åˆ¶ä¸€ï¼›2=è§¦å‘é™åˆ¶äºŒï¼›3=è§¦å‘é™åˆ¶ä¸‰',\n  `gamestate` TEXT COMMENT 'é€€å‡ºæ—¶å¯¹å±€çŠ¶æ€ï¼šActiveæ˜¯åœ¨å‡ºç”Ÿå²›ä¹‹å‰ï¼ŒReadyæ˜¯åœ¨å‡ºç”Ÿå²›ï¼ŒFightingæ˜¯åŒ…æ‹¬4äººé›†ç»“ã€ä¸Šé£æœºã€è·³ä¼æˆ˜æ–—è¿™äº›é˜¶æ®µï¼ŒFinish æ­»äº¡/èƒœåˆ©ç»“æŸ',\n  `submodegroup` BIGINT COMMENT 'æ¨¡å¼ç»„ID',\n  `lobbyexitreason` TEXT COMMENT 'å¤§å…è®°å½•çš„é€€å‡ºåŸå› ',\n  `mode` BIGINT COMMENT 'æ¨¡å¼ID',\n  `submode` BIGINT COMMENT 'å­æ¨¡å¼ID',\n  `roundtime` BIGINT COMMENT 'å¯¹å±€æ—¶é•¿'\n);\nCREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` TEXT COMMENT 'ç»Ÿè®¡æ—¥æœŸæ ¼å¼YYYYMMDD',\n  `vgameappid` TEXT COMMENT 'è´¦å·ä½“ç³»ï¼šwx:å¾®ä¿¡ï¼Œqqï¼šæ‰‹Q',\n  `platid` BIGINT COMMENT 'ç³»ç»Ÿå¹³å°ï¼š0:IOS,1:Android',\n  `vplayerid` TEXT COMMENT 'ç©å®¶ID',\n  `mode` BIGINT COMMENT 'æ¨¡å¼ID',\n  `modename` TEXT COMMENT 'æ¨¡å¼åç§°',\n  `submode` BIGINT COMMENT 'å­æ¨¡å¼ID',\n  `submodename` TEXT COMMENT 'å­æ¨¡å¼åç§°',\n  `map` BIGINT COMMENT 'åœ°å›¾ID',\n  `mapname` TEXT COMMENT 'åœ°å›¾åç§°',\n  `seasonid` BIGINT COMMENT 'èµ›å­£ID',\n  `seasonname` TEXT COMMENT 'èµ›å­£åç§°',\n  `roundcnt` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ•°',\n  `roundtime` BIGINT COMMENT 'å½“æ—¥å¯¹å±€æ—¶é•¿(ç§’)',\n  `survivaltime` BIGINT COMMENT 'å½“æ—¥å­˜æ´»æ—¶é•¿(ç§’)',\n  `firstroundtime` TEXT COMMENT 'å½“æ—¥é¦–æ¬¡å¯¹å±€æ—¶é—´',\n  `device_type` BIGINT COMMENT 'è®¾å¤‡ç±»å‹'\n);\n\nã€å‚è€ƒä¿¡æ¯ã€‘\nä¸»ç©å®šä¹‰ï¼šç”¨æˆ·ç´¯è®¡å¯¹å±€æ—¶é•¿æœ€å¤šçš„ç©æ³•ï¼›\n\nç©æ³•ï¼šä»dws_jordass_mode_roundrecord_diå–\nä»ä¸Šå¾€ä¸‹åŒ¹é…ï¼Œå¦‚æœæ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶ï¼Œåˆ™è¿”å›å¯¹åº”çš„åç§°ï¼Œå¦åˆ™è¿”å›â€œå…¶ä»–æ¨¡å¼â€ã€‚\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ï¼Œä¸”å­æ¨¡å¼åç§°ä»¥â€œCGâ€å¼€å¤´ï¼Œä¸”åœ°å›¾ä¸ºâ€œç¾¤å±¿â€ï¼Œåˆ™è¿”å›â€œä¸»é¢˜ç¾¤å±¿â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œç¾¤å±¿â€ï¼Œåˆ™è¿”å›â€œä¼ ç»Ÿç¾¤å±¿â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œå‡æ—¥ç¾¤å²›â€ï¼Œåˆ™è¿”å›â€œå‡æ—¥ç¾¤å²›â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œè£è€€ä¹‹åŸâ€ï¼Œåˆ™è¿”å›â€œè£è€€ä¹‹åŸâ€ï¼›\nå¦‚æœå­æ¨¡å¼æ˜¯â€œå¹¿åŸŸæˆ˜åœºæ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œå¹¿åŸŸæˆ˜åœºâ€ï¼›\nå¦‚æœå­æ¨¡å¼æ˜¯â€œæèƒ½å½¢æ€æ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œæèƒ½å½¢æ€â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œç»„é˜Ÿç«æŠ€â€ï¼Œåˆ™è¿”å›â€œç»„ç«â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œä¼‘é—²æ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œä¼‘é—²â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œä¹å›­â€ï¼Œåˆ™è¿”å›â€œä¹å›­â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œé¢†åœ°â€ï¼Œåˆ™è¿”å›â€œé¢†åœ°â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œå¹¿é˜”å¤©åœ°â€ï¼Œåˆ™è¿”å›â€œå¹¿é˜”å¤©åœ°â€\n\næ³¨æ„ï¼Œå‚ä¸éš§é“æ¨¡å¼çš„ç”¨æˆ·æ•°æ®ä»dwd_jordass_playerexitgamerecord_hiå–ï¼Œæ—¶é—´é™åˆ¶ 2024.6.18-2025.3.30ï¼Œmode in (3001, 3002, 3003)\n\n",
  "chosen": "with main_user as (\n    select substr(dtstatdate, 1, 6) mons,\n        case\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and submodename like 'CG%' and mapname = 'ç¾¤å±¿' then 'ä¸»é¢˜ç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'ç¾¤å±¿' then 'ä¼ ç»Ÿç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'å‡æ—¥ç¾¤å²›' then 'å‡æ—¥ç¾¤å²›'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'è£è€€ä¹‹åŸ' then 'è£è€€ä¹‹åŸ'\n            when submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' then 'å¹¿åŸŸæˆ˜åœº'\n            when submodename = 'æèƒ½å½¢æ€æ¨¡å¼' then 'æèƒ½å½¢æ€'\n            when modename = 'ç»„é˜Ÿç«æŠ€' then 'ç»„ç«'\n            when modename = 'ä¹å›­' then 'ä¹å›­'\n            when modename = 'é¢†åœ°' then 'é¢†åœ°'\n            when modename = 'å¹¿é˜”å¤©åœ°' then 'å¹¿é˜”å¤©åœ°'\n            else 'å…¶ä»–æ¨¡å¼'\n        end imodename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        sum(roundcnt) roundcnt\n   from dws_jordass_mode_roundrecord_di\n   where dtstatdate between '20190508' and '20250330'\n   group by vplayerid, substr(dtstatdate, 1, 6),\n        case\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and submodename like 'CG%' and mapname = 'ç¾¤å±¿' then 'ä¸»é¢˜ç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'ç¾¤å±¿' then 'ä¼ ç»Ÿç¾¤å±¿'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'å‡æ—¥ç¾¤å²›' then 'å‡æ—¥ç¾¤å²›'\n            when modename = 'ä¼ ç»Ÿæ¨¡å¼' and mapname = 'è£è€€ä¹‹åŸ' then 'è£è€€ä¹‹åŸ'\n            when submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' then 'å¹¿åŸŸæˆ˜åœº'\n            when submodename = 'æèƒ½å½¢æ€æ¨¡å¼' then 'æèƒ½å½¢æ€'\n            when modename = 'ç»„é˜Ÿç«æŠ€' then 'ç»„ç«'\n            when modename = 'ä¹å›­' then 'ä¹å›­'\n            when modename = 'é¢†åœ°' then 'é¢†åœ°'\n            when modename = 'å¹¿é˜”å¤©åœ°' then 'å¹¿é˜”å¤©åœ°'\n            else 'å…¶ä»–æ¨¡å¼'\n        end\n\n   union all\n   \n   select substr (tdbank_imp_date, 1, 6) mons,\n        'éš§é“' as modename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        count(distinct gameid) roundcnt\n   from dwd_jordass_playerexitgamerecord_hi\n   where tdbank_imp_date between '2024061800' and '2025033023'\n     and mode in (3001, 3002, 3003)\n   group by substr (tdbank_imp_date, 1, 6), vplayerid\n)\n\nselect a.mons,\n       a.imodename,\n       a.iusernum,\n       b.iusernumall\nfrom (\n    select mons,\n          imodename,\n          count(vplayerid) iusernum\n    from (\n        select mons, vplayerid, imodename\n        from (\n            select mons,\n                vplayerid,\n                imodename,\n                roundtime,\n                row_number() over (partition by mons, vplayerid order by roundtime desc) as rn\n            from main_user\n        )ff1\n        where rn = 1\n    )f1\n   group by mons, imodename\n) a\nleft join (\n    select mons,\n        imodename,\n        count(vplayerid) iusernumall\n   from main_user\n   group by mons, imodename\n) b \non a.imodename = b.imodename and a.mons = b.mons\norder by a.mons, a.imodename\n;",
  "rejected": "æˆ‘ä»¬æ¥ä¸€æ­¥ä¸€æ­¥åˆ†æè¿™ä¸ªé—®é¢˜ï¼Œå¹¶æœ€ç»ˆå†™å‡ºç¬¦åˆè¦æ±‚çš„ SQL æŸ¥è¯¢è¯­å¥ã€‚\n\n---\n\n## ğŸ§  **ç›®æ ‡ç†è§£**\n\næˆ‘ä»¬è¦ç»Ÿè®¡çš„æ˜¯ï¼š\n> **ä» 2019å¹´5æœˆ8æ—¥ åˆ° 2025å¹´3æœˆ30æ—¥**ï¼ŒæŒ‰**æœˆä»½ï¼ˆæ ¼å¼ä¸ºYYYYMMï¼‰**åˆ’åˆ†çš„ç©æ³•ä¸»ç©æƒ…å†µã€‚  \nè¾“å‡ºå­—æ®µåŒ…æ‹¬ï¼š\n\n| å­—æ®µå | å«ä¹‰ |\n|--------|------|\n| month | æœˆä»½ï¼Œå¦‚ 201905ã€201906 ç­‰ |\n| ä¸»ç©ç©æ³• | ç”¨æˆ·ç´¯è®¡å¯¹å±€æ—¶é•¿æœ€å¤šçš„ç©æ³• |\n| ä¸»ç©äººæ•° | è¿™ä¸ªç©æ³•çš„ä¸»ç©äººæ•° |\n| æ€»å‚ä¸äººæ•° | æ‰€æœ‰ç©æ³•ä¸­å‚ä¸è¿‡çš„ç”¨æˆ·æ€»æ•° |\n\n---\n\n## ğŸ” **å…³é”®ç‚¹æ¢³ç†**\n\n### âœ… æ•°æ®æ¥æº\n1. **ä¸»è¦æ•°æ®è¡¨**ï¼š`dws_jordass_mode_roundrecord_di`\n   - åŒ…å«äº†æ¯ä¸ªç©å®¶åœ¨ä¸åŒæ¨¡å¼ä¸‹çš„å¯¹å±€è®°å½•å’Œæ—¶é•¿ä¿¡æ¯ã€‚\n2. **éš§é“æ¨¡å¼ç‰¹æ®Šå¤„ç†**ï¼š\n   - æ—¶é—´èŒƒå›´ï¼š2024.6.18 è‡³ 2025.3.30\n   - mode in (3001, 3002, 3003)\n   - æ¥è‡ª `dwd_jordass_playerexitgamerecord_hi`\n\n### âœ… ä¸»ç©å®šä¹‰\n- æ¯ä¸ªç”¨æˆ·åœ¨æŸä¸ªæ—¶é—´æ®µå†…ï¼Œå¯¹æ‰€æœ‰ç©æ³•çš„æ€»å¯¹å±€æ—¶é•¿ï¼ˆsurvivaltimeï¼‰æœ€å¤§çš„é‚£ä¸ªç©æ³•å³ä¸ºä¸»ç©ç©æ³•ã€‚\n\n### âœ… ç©æ³•æ˜ å°„è§„åˆ™ï¼ˆä¼˜å…ˆçº§ä»ä¸Šåˆ°ä¸‹ï¼‰\n```text\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ï¼Œä¸”å­æ¨¡å¼åç§°ä»¥â€œCGâ€å¼€å¤´ï¼Œä¸”åœ°å›¾ä¸ºâ€œç¾¤å±¿â€ï¼Œåˆ™è¿”å›â€œä¸»é¢˜ç¾¤å±¿â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œç¾¤å±¿â€ï¼Œåˆ™è¿”å›â€œä¼ ç»Ÿç¾¤å±¿â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œå‡æ—¥ç¾¤å²›â€ï¼Œåˆ™è¿”å›â€œå‡æ—¥ç¾¤å²›â€ï¼›\nå¦‚æœæ¨¡å¼ä¸ºâ€œä¼ ç»Ÿæ¨¡å¼â€ä¸”åœ°å›¾ä¸ºâ€œè£è€€ä¹‹åŸâ€ï¼Œåˆ™è¿”å›â€œè£è€€ä¹‹åŸâ€ï¼›\nå¦‚æœå­æ¨¡å¼æ˜¯â€œå¹¿åŸŸæˆ˜åœºæ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œå¹¿åŸŸæˆ˜åœºâ€ï¼›\nå¦‚æœå­æ¨¡å¼æ˜¯â€œæèƒ½å½¢æ€æ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œæèƒ½å½¢æ€â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œç»„é˜Ÿç«æŠ€â€ï¼Œåˆ™è¿”å›â€œç»„ç«â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œä¼‘é—²æ¨¡å¼â€ï¼Œåˆ™è¿”å›â€œä¼‘é—²â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œä¹å›­â€ï¼Œåˆ™è¿”å›â€œä¹å›­â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œé¢†åœ°â€ï¼Œåˆ™è¿”å›â€œé¢†åœ°â€ï¼›\nå¦‚æœæ¨¡å¼æ˜¯â€œå¹¿é˜”å¤©åœ°â€ï¼Œåˆ™è¿”å›â€œå¹¿é˜”å¤©åœ°â€\n```\n\n---\n\n## ğŸ“Œ **æ­¥éª¤æ‹†è§£**\n\n### Step 1ï¼šæ„å»ºåŸºç¡€ç©æ³•æ˜ å°„é€»è¾‘\n\nä½¿ç”¨ CASE WHEN æ„é€ ç©æ³•åç§°å­—æ®µã€‚\n\n```sql\nCASE \n    WHEN mode = 1 AND submodename LIKE 'CG%' AND mapname = 'ç¾¤å±¿' THEN 'ä¸»é¢˜ç¾¤å±¿'\n    WHEN mode = 1 AND mapname = 'ç¾¤å±¿' THEN 'ä¼ ç»Ÿç¾¤å±¿'\n    WHEN mode = 1 AND mapname = 'å‡æ—¥ç¾¤å²›' THEN 'å‡æ—¥ç¾¤å²›'\n    WHEN mode = 1 AND mapname = 'è£è€€ä¹‹åŸ' THEN 'è£è€€ä¹‹åŸ'\n    WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n    WHEN submodename = 'æèƒ½å½¢æ€æ¨¡å¼' THEN 'æèƒ½å½¢æ€'\n    WHEN mode = 2 THEN 'ç»„ç«'\n    WHEN mode = 3 THEN 'ä¼‘é—²'\n    WHEN mode = 4 THEN 'ä¹å›­'\n    WHEN mode = 5 THEN 'é¢†åœ°'\n    WHEN mode = 6 THEN 'å¹¿é˜”å¤©åœ°'\n    ELSE 'å…¶ä»–æ¨¡å¼'\nEND AS play_mode\n```\n\n---\n\n### Step 2ï¼šè·å–æ­£å¸¸æ¨¡å¼çš„æ•°æ®ï¼ˆdws_jordass_mode_roundrecord_diï¼‰\n\nç­›é€‰æ—¶é—´èŒƒå›´ï¼š`dtstatdate BETWEEN '20190508' AND '20250330'`\n\næ„é€ æ¯ä¸ªæœˆä»½çš„è®°å½•ï¼Œå¹¶è®¡ç®—æ¯ä¸ªç”¨æˆ·çš„ç”Ÿå­˜æ—¶é—´æ€»å’Œã€‚\n\n---\n\n### Step 3ï¼šå¤„ç†éš§é“æ¨¡å¼æ•°æ®ï¼ˆdwd_jordass_playerexitgamerecord_hiï¼‰\n\n- æ—¶é—´èŒƒå›´ï¼š`dteventtime >= '2024-06-18' AND dteventtime <= '2025-03-30'`\n- mode in (3001, 3002, 3003)\n- éœ€è¦å°†è¯¥éƒ¨åˆ†æ•°æ®è½¬æ¢æˆç±»ä¼¼ `dws_jordass_mode_roundrecord_di` çš„ç»“æ„ï¼Œç”¨äºåˆå¹¶ç»Ÿè®¡ã€‚\n\næˆ‘ä»¬å¯ä»¥å‡è®¾ï¼š\n- tunnel æ¨¡å¼å¯¹åº” mode = 7ï¼ˆè‡ªå®šä¹‰ï¼‰\n- å­æ¨¡å¼ ID å¯ä»¥æ ¹æ® mode åšæ˜ å°„\n- åœ°å›¾å¯ä»¥ç»Ÿä¸€è®¾ä¸º â€œéš§é“æ¨¡å¼â€\n\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·æ„é€ ï¼š\n\n```sql\nSELECT \n    DATE_FORMAT(dteventtime, '%Y%m') AS month,\n    7 AS mode,\n    'éš§é“æ¨¡å¼' AS modename,\n    0 AS submode,\n    'éš§é“æ¨¡å¼' AS submodename,\n    0 AS map,\n    'éš§é“æ¨¡å¼' AS mapname,\n    vplayerid,\n    roundtime AS survivaltime -- æˆ–è€…éœ€è¦æ›´å¤æ‚çš„å¤„ç†\nFROM dwd_jordass_playerexitgamerecord_hi\nWHERE dteventtime >= '2024-06-18' AND dteventtime <= '2025-03-30'\nAND mode IN (3001, 3002, 3003)\n```\n\n---\n\n### Step 4ï¼šåˆå¹¶ä¸¤ç§æ•°æ®æº\n\nå°†ä¸¤éƒ¨åˆ†æ•°æ®åˆå¹¶ä¸ºç»Ÿä¸€ç»“æ„ï¼š\n\n```sql\nWITH merged_data AS (\n    SELECT \n        dtstatdate AS month,\n        mode,\n        modename,\n        submode,\n        submodename,\n        map,\n        mapname,\n        vplayerid,\n        survivaltime\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE dtstatdate BETWEEN '20190508' AND '20250330'\n\n    UNION ALL\n\n    SELECT \n        DATE_FORMAT(dteventtime, '%Y%m') AS month,\n        7 AS mode,\n        'éš§é“æ¨¡å¼' AS modename,\n        0 AS submode,\n        'éš§é“æ¨¡å¼' AS submodename,\n        0 AS map,\n        'éš§é“æ¨¡å¼' AS mapname,\n        vplayerid,\n        roundtime AS survivaltime\n    FROM dwd_jordass_playerexitgamerecord_hi\n    WHERE dteventtime >= '2024-06-18' AND dteventtime <= '2025-03-30'\n    AND mode IN (3001, 3002, 3003)\n),\n```\n\n---\n\n### Step 5ï¼šæ·»åŠ ç©æ³•åç§°å­—æ®µ\n\n```sql\nplay_mode_data AS (\n    SELECT \n        month,\n        vplayerid,\n        CASE \n            WHEN mode = 1 AND submodename LIKE 'CG%' AND mapname = 'ç¾¤å±¿' THEN 'ä¸»é¢˜ç¾¤å±¿'\n            WHEN mode = 1 AND mapname = 'ç¾¤å±¿' THEN 'ä¼ ç»Ÿç¾¤å±¿'\n            WHEN mode = 1 AND mapname = 'å‡æ—¥ç¾¤å²›' THEN 'å‡æ—¥ç¾¤å²›'\n            WHEN mode = 1 AND mapname = 'è£è€€ä¹‹åŸ' THEN 'è£è€€ä¹‹åŸ'\n            WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n            WHEN submodename = 'æèƒ½å½¢æ€æ¨¡å¼' THEN 'æèƒ½å½¢æ€'\n            WHEN mode = 2 THEN 'ç»„ç«'\n            WHEN mode = 3 THEN 'ä¼‘é—²'\n            WHEN mode = 4 THEN 'ä¹å›­'\n            WHEN mode = 5 THEN 'é¢†åœ°'\n            WHEN mode = 6 THEN 'å¹¿é˜”å¤©åœ°'\n            WHEN mode = 7 THEN 'éš§é“æ¨¡å¼'\n            ELSE 'å…¶ä»–æ¨¡å¼'\n        END AS play_mode,\n        survivaltime\n    FROM merged_data\n),\n```\n\n---\n\n### Step 6ï¼šæŒ‰æœˆã€ç©æ³•èšåˆç”¨æˆ·ç”Ÿå­˜æ—¶é—´\n\n```sql\nmonthly_user_survival AS (\n    SELECT \n        month,\n        play_mode,\n        vplayerid,\n        SUM(survivaltime) AS total_survival_time\n    FROM play_mode_data\n    GROUP BY month, play_mode, vplayerid\n),\n```\n\n---\n\n### Step 7ï¼šæ‰¾å‡ºæ¯ä¸ªç”¨æˆ·åœ¨æ¯æœˆçš„ä¸»ç©ç©æ³•ï¼ˆæœ€å¤§ç”Ÿå­˜æ—¶é—´ï¼‰\n\n```sql\nuser_main_play AS (\n    SELECT \n        month,\n        vplayerid,\n        play_mode,\n        total_survival_time,\n        ROW_NUMBER() OVER (PARTITION BY month, vplayerid ORDER BY total_survival_time DESC) AS rn\n    FROM monthly_user_survival\n),\nmain_play_per_month AS (\n    SELECT \n        month,\n        play_mode,\n        COUNT(DISTINCT vplayerid) AS main_players_count\n    FROM user_main_play\n    WHERE rn = 1\n    GROUP BY month, play_mode\n),\n```\n\n---\n\n### Step 8ï¼šç»Ÿè®¡æ€»å‚ä¸äººæ•°ï¼ˆå»é‡ï¼‰\n\n```sql\ntotal_participants AS (\n    SELECT \n        month,\n        COUNT(DISTINCT vplayerid) AS total_participants_count\n    FROM play_mode_data\n    GROUP BY month\n),\n```\n\n---\n\n### Step 9ï¼šå…³è”ç»“æœï¼Œè¾“å‡ºæœ€ç»ˆç»“æœ\n\n```sql\nSELECT \n    m.month,\n    m.play_mode,\n    m.main_players_count,\n    t.total_participants_count\nFROM main_play_per_month m\nJOIN total_participants t ON m.month = t.month\nORDER BY m.month;\n```\n\n---\n\n## âœ… æœ€ç»ˆå®Œæ•´ SQL æŸ¥è¯¢å¦‚ä¸‹ï¼š\n\n```sql\nWITH merged_data AS (\n    SELECT \n        dtstatdate AS month,\n        mode,\n        modename,\n        submode,\n        submodename,\n        map,\n        mapname,\n        vplayerid,\n        survivaltime\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE dtstatdate BETWEEN '20190508' AND '20250330'\n\n    UNION ALL\n\n    SELECT \n        DATE_FORMAT(dteventtime, '%Y%m') AS month,\n        7 AS mode,\n        'éš§é“æ¨¡å¼' AS modename,\n        0 AS submode,\n        'éš§é“æ¨¡å¼' AS submodename,\n        0 AS map,\n        'éš§é“æ¨¡å¼' AS mapname,\n        vplayerid,\n        roundtime AS survivaltime\n    FROM dwd_jordass_playerexitgamerecord_hi\n    WHERE dteventtime >= '2024-06-18' AND dteventtime <= '2025-03-30'\n    AND mode IN (3001, 3002, 3003)\n),\n\nplay_mode_data AS (\n    SELECT \n        month,\n        vplayerid,\n        CASE \n            WHEN mode = 1 AND submodename LIKE 'CG%' AND mapname = 'ç¾¤å±¿' THEN 'ä¸»é¢˜ç¾¤å±¿'\n            WHEN mode = 1 AND mapname = 'ç¾¤å±¿' THEN 'ä¼ ç»Ÿç¾¤å±¿'\n            WHEN mode = 1 AND mapname = 'å‡æ—¥ç¾¤å²›' THEN 'å‡æ—¥ç¾¤å²›'\n            WHEN mode = 1 AND mapname = 'è£è€€ä¹‹åŸ' THEN 'è£è€€ä¹‹åŸ'\n            WHEN submodename = 'å¹¿åŸŸæˆ˜åœºæ¨¡å¼' THEN 'å¹¿åŸŸæˆ˜åœº'\n            WHEN submodename = 'æèƒ½å½¢æ€æ¨¡å¼' THEN 'æèƒ½å½¢æ€'\n            WHEN mode = 2 THEN 'ç»„ç«'\n            WHEN mode = 3 THEN 'ä¼‘é—²'\n            WHEN mode = 4 THEN 'ä¹å›­'\n            WHEN mode = 5 THEN 'é¢†åœ°'\n            WHEN mode = 6 THEN 'å¹¿é˜”å¤©åœ°'\n            WHEN mode = 7 THEN 'éš§é“æ¨¡å¼'\n            ELSE 'å…¶ä»–æ¨¡å¼'\n        END AS play_mode,\n        survivaltime\n    FROM merged_data\n),\n\nmonthly_user_survival AS (\n    SELECT \n        month,\n        play_mode,\n        vplayerid,\n        SUM(survivaltime) AS total_survival_time\n    FROM play_mode_data\n    GROUP BY month, play_mode, vplayerid\n),\n\nuser_main_play AS (\n    SELECT \n        month,\n        vplayerid,\n        play_mode,\n        total_survival_time,\n        ROW_NUMBER() OVER (PARTITION BY month, vplayerid ORDER BY total_survival_time DESC) AS rn\n    FROM monthly_user_survival\n),\n\nmain_play_per_month AS (\n    SELECT \n        month,\n        play_mode,\n        COUNT(DISTINCT vplayerid) AS main_players_count\n    FROM user_main_play\n    WHERE rn = 1\n    GROUP BY month, play_mode\n),\n\ntotal_participants AS (\n    SELECT \n        month,\n        COUNT(DISTINCT vplayerid) AS total_participants_count\n    FROM play_mode_data\n    GROUP BY month\n)\n\nSELECT \n    m.month,\n    m.play_mode,\n    m.main_players_count,\n    t.total_participants_count\nFROM main_play_per_month m\nJOIN total_participants t ON m.month = t.month\nORDER BY m.month;\n```\n\n---\n\nå¦‚æœ‰æ›´å¤šç»†èŠ‚æˆ–æ€§èƒ½ä¼˜åŒ–éœ€æ±‚ï¼Œè¯·ç»§ç»­æä¾›ã€‚"
}